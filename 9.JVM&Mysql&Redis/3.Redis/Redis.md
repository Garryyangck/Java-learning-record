## Redisè§†é¢‘è¯¾

### 1.Redisé…ç½®

1. > ![image-20240427161035951](Redis.assets/image-20240427161035951.png)

2. ==daemonize è®¾ç½®ä¸º yes åŽï¼Œå¯åŠ¨çš„ redis ä¼šåœ¨åŽå°è¿è¡Œï¼Œä¸ä¼šå› ä¸ºå…³é—­ç»ˆç«¯è€Œå…³é—­==ã€‚

3. requirepass é»˜è®¤è¢«æ³¨é‡ŠæŽ‰ï¼Œè‡ªè¡Œè®¾ç½®åŽéœ€è¦åœ¨==å®¢æˆ·ç«¯è¾“å…¥ `auth [password]` ä»¥èŽ·å–æŽˆæƒæ‰èƒ½ä½¿ç”¨==ã€‚

	> ![image-20240427163717352](Redis.assets/image-20240427163717352.png)

---



### 2.Rediså¸¸ç”¨å‘½ä»¤

1. ã€ŠRediså¼€å‘ä¸Žè¿ç»´ã€‹é‡Œéƒ½æœ‰è®²è¿‡å¹¶æ¼”ç¤ºè¿‡è¿™äº›å‘½ä»¤ã€‚

	> ![image-20240427164619414](Redis.assets/image-20240427164619414.png)

---



### 3.æ•°æ®ç»“æž„çš„å‘½ä»¤

1. è¯¦æƒ…å¯ä»¥çœ‹ä¹¦ï¼Œæ³¨æ„äº‹é¡¹çœ‹ä¸“æ ã€‚

---



### 4.Javaçš„Rediså®¢æˆ·ç«¯ï¼šJedis

1. ==è¿œç¨‹è®¿é—®==æœåŠ¡å™¨ä¸Šçš„rediséœ€è¦==æ›´æ”¹ä¸¤ä¸ªé…ç½®å‚æ•°==ã€‚

	> ```bash
	> protected-mode no # æ˜¯å¦å¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œé»˜è®¤ä¸º yesï¼Œè¿™é‡Œä¸ºäº†å­¦ä¹ éœ€è¦æ”¹ä¸º no
	> # WARNING: çº¿ä¸Šéƒ¨ç½²æ—¶ä¸€å®šä¸è¦è¿™ä¹ˆå¹²ï¼Œå¯èƒ½ä¼šè¢«é»‘å®¢dosæ”»å‡»ï¼Œå¯¼è‡´ç¼“å­˜ç©¿é€ç­‰é—®é¢˜
	> ```
	>
	> ```bash
	> bind 127.0.0.1 -> bind 0.0.0.0 # æ‰€æœ‰åœ°å€çš„ä¸»æœºå‡å¯è®¿é—®
	> ```

2. ç„¶åŽ==è®¾ç½®é˜²ç«å¢™ï¼Œæ”¾è¡Œ6379ç«¯å£==ã€‚

	> ```bash
	> sudo firewall-cmd --zone=public --permenant --add-port=6379/tcp
	> ```

3. ä½¿ç”¨==mavenèŽ·å–==ï¼š

	> ```xml
	> <dependency>
	>     <groupId>redis.clients</groupId>
	>     <artifactId>jedis</artifactId>
	> </dependency>
	> ```

4. å…¶å®žæ„Ÿè§‰è‡ªå·±çš„é¡¹ç›®ä¸­ç”¨çš„SpringBoot-redis-starterä½¿ç”¨redisTemplateçš„æ–¹å¼ä¹Ÿèƒ½å®žçŽ°ã€‚

----



## Rediså¼€å‘ä¸Žè¿ç»´

### ç¬¬ä¸€ç« ï¼šåˆè¯†redis

#### 1.redisç‰¹æ€§

1. é€Ÿåº¦å¿«

	> æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œcè¯­è¨€ç¼–å†™ï¼Œä½¿ç”¨å•çº¿ç¨‹æž¶æž„ï¼Œæºç ç²¾æ‰“ç»†ç£¨

2. åŸºäºŽé”®å€¼å¯¹çš„æ•°æ®ç»“æž„æœåŠ¡å™¨

	> æä¾›å¤šç§æ•°æ®ç»“æž„ï¼Œè¿˜æœ‰HyperLogLogã€biMapã€GEOè¿™ä¸‰ä¸ªæœ‰è¶£çš„â€œæ•°æ®ç»“æž„â€

3. åŠŸèƒ½ä¸°å¯Œ

	> è¿‡æœŸï¼Œå‘å¸ƒè®¢é˜…ï¼ŒLuaè„šæœ¬ï¼Œç®€å•äº‹åŠ¡ï¼Œæµæ°´çº¿åŠŸèƒ½

4. ç®€å•ç¨³å®š

	> ä»£ç é‡å°‘ï¼Œä¸ä¾èµ–æ“ä½œç³»ç»Ÿä¸­çš„ç±»åº“

5. å®¢æˆ·ç«¯è¯­è¨€å¤š

6. æŒä¹…åŒ–

	> RDBå’ŒAOFä¸¤ç§ç­–ç•¥ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®å­˜åˆ°ç¡¬ç›˜ä¸­

7. ä¸»ä»Žå¤åˆ¶

8. é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼

---

#### 2.Redisä½¿ç”¨åœºæ™¯

1. ç¼“å­˜
2. æŽ’è¡Œæ¦œ
3. è®¡æ•°å™¨ï¼ˆæ’­æ”¾é‡ç­‰ï¼‰
4. ç¤¾äº¤ç½‘ç»œï¼ˆç‚¹èµžã€å…³æ³¨ï¼‰
5. æ¶ˆæ¯é˜Ÿåˆ—
6. redisä¸èƒ½åšï¼šå¤§è§„æ¨¡æ•°æ®å’Œå†·æ•°æ®ï¼Œå ç”¨å†…å­˜ï¼Œå½±å“CPUæ€§èƒ½

---



### ç¬¬äºŒç« ï¼šAPIçš„ç†è§£å’Œä½¿ç”¨

#### 1.å•çº¿ç¨‹æž¶æž„

1. å› ä¸ºRedisæ˜¯å•çº¿ç¨‹æ¥å¤„ç†å‘½ä»¤çš„ï¼Œæ‰€ä»¥==ä¸€æ¡å‘½ä»¤ä»Žå®¢æˆ·ç«¯è¾¾åˆ°æœåŠ¡ç«¯ä¸ä¼šç«‹åˆ»è¢«æ‰§è¡Œï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¿›å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç„¶åŽé€ä¸ªè¢«æ‰§è¡Œ==ã€‚

2. å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ

	> 1. çº¯å†…å­˜è®¿é—®
	> 2. éžé˜»å¡žIOï¼ŒRedisé‡‡ç”¨epollä½œä¸ºè‡ªèº«IOå¤šè·¯å¤ç”¨æŠ€æœ¯çš„å®žçŽ°
	> 3. å•çº¿ç¨‹é¿å…äº†çº¿ç¨‹åˆ‡æ¢å’Œç«žæ€äº§ç”Ÿçš„æ¶ˆè€—

---

#### 2.å­—ç¬¦ä¸²

1. keyä¸ºå­—ç¬¦ä¸²ï¼Œvalueå¯ä»¥æ˜¯JSONã€XMLã€æ•°å­—ï¼ˆæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼‰ã€äºŒè¿›åˆ¶ï¼Œä½†å¤§å°æœ€å¤šä¸º512MB

2. è®¾ç½®ï¼š

	```shell
	set key value [ex seconds(è¿‡æœŸæ—¶é—´)] [px milliseconds(è¿‡æœŸæ—¶é—´çš„æ¯«ç§’çº§)] [nx(keyå¿…é¡»ä¸å­˜åœ¨ï¼Œç”¨äºŽæ’å…¥)|xx(keyå¿…é¡»å­˜åœ¨ï¼Œç”¨äºŽæ›´æ–°)]
	```

3. ==mgetï¼šä¸€æ¬¡èŽ·å–å¤šä¸ªkeyçš„valueï¼Œå®ƒæ¯”å¤šæ¬¡èŽ·å–ä¸€ä¸ªkeyçš„valueæ•ˆçŽ‡é«˜==

	> å› ä¸º==åªä¼šæ‰§è¡Œä¸€æ¬¡getè¯·æ±‚ï¼ŒèŠ‚çº¦äº†ç½‘ç»œæ—¶é—´==ï¼ˆå¯¹äºŽå¼€å‘äººå‘˜è€Œè¨€ï¼Œç½‘ç»œå¯èƒ½æˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆï¼‰

4. å­—ç¬¦ä¸²ç±»åž‹çš„å†…éƒ¨ç¼–ç ï¼š

	> 1. intï¼Œ8ä¸ªå­—èŠ‚çš„é•¿æ•´åž‹
	> 2. embstrï¼Œ<=39å­—èŠ‚çš„å­—ç¬¦ä¸²
	> 3. rawï¼Œ>39å­—èŠ‚çš„å­—ç¬¦ä¸²

5. ä½¿ç”¨åœºæ™¯ï¼š

	> 1. ç¼“å­˜ï¼Œå‘½åè§„åˆ™ï¼šä¸šåŠ¡åï¼šå¯¹è±¡åï¼šidï¼š[å±žæ€§]
	> 2. è®¡æ•°
	> 3. å…±äº«sessionï¼Œåˆ†å¸ƒå¼webæœåŠ¡å®žçŽ°sessionå…±äº«
	> 4. é™é€Ÿï¼Œæ¯”å¦‚éªŒè¯ç ä¸€åˆ†é’Ÿä¸èƒ½è¶…è¿‡5æ¬¡

---

#### 3.å“ˆå¸Œ

1. å†…éƒ¨ç¼–ç ï¼š

	> 1. ziplistï¼Œfieldä¸ªæ•°<=512 && valueçš„é•¿åº¦<=64*8(64byte)ï¼Œä¼˜ç‚¹æ˜¯èŠ‚çœå†…å­˜
	> 2. hashtableï¼Œå¦‚æžœä¸æ»¡è¶³ç”Ÿæˆziplistçš„è¦æ±‚ï¼Œå°±ä¼šå˜æˆhashtableï¼Œå¼€é”€è¾ƒå¤§å†…å­˜

2. ä¸»è¦ç”¨äºŽå°†å¯¹è±¡çš„æ¯ä¸€ä¸ªå±žæ€§å¯¹åº”ä¸€ä¸ªfieldè¿›è¡Œå­˜å‚¨ï¼Œä½†æ˜¯å¦‚æžœè½¬æ¢æˆhashtableåŽåè€Œä¼šå ç”¨æ›´å¤šçš„ç©ºé—´

---

#### 4.åˆ—è¡¨

1. ç‰¹ç‚¹ï¼šåŒå‘pushå’Œpopï¼ˆç±»ä¼¼äºŽdequeï¼‰ï¼Œå†…éƒ¨å…ƒç´ æœ‰åºï¼Œå¯ä»¥é€šè¿‡indexæŸ¥è¯¢

2. å†…éƒ¨ç¼–ç ï¼š

	> 1. ziplist(åŽ‹ç¼©åˆ—è¡¨)
	> 2. linkedlist
	> 3. quicklist(Redis 3.2)ï¼Œæ˜¯ä¸€ä¸ªä»¥ziplistä¸ºç»“ç‚¹çš„é“¾è¡¨

3. ä½¿ç”¨åœºæ™¯ï¼š

	> 1. ==æ¶ˆæ¯é˜Ÿåˆ—==ï¼šRedisçš„lpush+brpopå‘½ä»¤ç»„åˆå³å¯å®žçŽ°é˜»å¡žé˜Ÿåˆ—ï¼Œ==ç”Ÿäº§è€…å®¢æˆ·ç«¯ä½¿ç”¨1rpushä»Žåˆ—è¡¨å·¦ä¾§æ’å…¥å…ƒç´ ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å®¢æˆ·ç«¯ä½¿ç”¨brpopå‘½ä»¤é˜»å¡žå¼çš„â€œæŠ¢â€åˆ—è¡¨å°¾éƒ¨çš„å…ƒç´ ==ï¼Œå¤šä¸ªå®¢æˆ·ç«¯ä¿è¯äº†æ¶ˆè´¹çš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚
	>
	> 	<img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240402220547.png" alt="å¾®ä¿¡æˆªå›¾_20240402220547" style="zoom:50%;" />
	>
	> 2. æ–‡ç« åˆ—è¡¨

---

#### 5.é›†åˆ

1. é›†åˆå’Œåˆ—è¡¨ä¸åŒï¼Œé›†åˆä¸æ”¯æŒé‡å¤å…ƒç´ ï¼Œå¹¶ä¸”æ— åºï¼Œå³ä¸èƒ½é€šè¿‡indexèŽ·å–å…ƒç´ 

2. é›†åˆé™¤äº†CRUDä»¥å¤–ï¼Œè¿˜æ”¯æŒäº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰é›†åˆè¿ç®—

3. å†…éƒ¨ç¼–ç 

	> 1. intsetï¼šé›†åˆçš„å…ƒç´ å‡ä¸ºæ•´æ•°ï¼Œä¸”æ•°é‡å°äºŽ512
	> 2. hashtableï¼šä¸èƒ½æ»¡è¶³intsetçš„åˆ›å»ºæ¡ä»¶

4. ä½¿ç”¨åœºæ™¯

	> 1. ç»™ç”¨æˆ·æ·»åŠ æ ‡ç­¾ï¼Œç»™æ ‡ç­¾æ·»åŠ ç”¨æˆ·ï¼ˆå’Œå…³æ³¨ä¸Žè¢«å…³æ³¨ï¼Œç‚¹èµžä¸Žè¢«ç‚¹èµžé€»è¾‘ä¸€è‡´ï¼‰

---

#### 6.æœ‰åºé›†åˆ

1. å†…éƒ¨å®žçŽ°

	> 1. ziplist
	> 2. skiplist(è·³è¡¨)ï¼Œziplistè¦æ±‚ä¸æ»¡è¶³æ—¶é‡‡ç”¨ï¼Œæ•ˆçŽ‡æœ‰æ‰€ä¸‹é™

---

#### 7.é”®ç®¡ç†

1. åœ¨ä½¿ç”¨é‡å‘½åå‘½ä»¤æ—¶ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„:

	> 1. ç”±äºŽé‡å‘½åé”®æœŸé—´ä¼šæ‰§è¡Œ de1å‘½ä»¤åˆ é™¤æ—§çš„é”®ï¼Œ==å¦‚æžœé”®å¯¹åº”çš„å€¼æ¯”è¾ƒå¤§ï¼Œä¼šå­˜åœ¨é˜»å¡žRedis çš„å¯èƒ½æ€§ï¼Œè¿™ç‚¹ä¸è¦å¿½è§†==ã€‚
	> 2. å¦‚æžœ rename å’Œ renamenxä¸­çš„ keyå’Œ newkey å¦‚æžœæ˜¯ç›¸åŒçš„ï¼Œè¿”å›žOK

2. å¯¹äºŽå­—ç¬¦ä¸²ç±»åž‹é”®ï¼Œæ‰§è¡Œ set å‘½ä»¤ä¼šåŽ»æŽ‰è¿‡æœŸæ—¶é—´

	> ```c
	> void setKey(redisDb *db,robj*keyï¼Œrobj*val){
	>     if(lookupKeyWrite(db,key)==ULL)(
	>     	dbAdd (db ,key,val);
	>     }else{
	>     	dbOverwrite(db,key,val);
	>     }
	>     incrRefCount(val);
	>     //åŽ»æŽ‰è¿‡æœŸæ—¶é—´
	>     removeExpire(db,key);
	>     signalModifiedKey(db,key);
	> }
	> ```

3. Redis==ä¸æ”¯æŒäºŒçº§æ•°æ®ç»“æž„ (ä¾‹å¦‚å“ˆå¸Œã€åˆ—è¡¨) å†…éƒ¨å…ƒç´ çš„è¿‡æœŸ==åŠŸèƒ½ï¼Œä¾‹å¦‚ä¸èƒ½å¯¹åˆ—è¡¨ç±»åž‹çš„ä¸€ä¸ªå…ƒç´ åšè¿‡æœŸæ—¶é—´è®¾ç½®

4. ==dump+restore==åœ¨æ•°æ®åº“é—´è½¬ç§»é”®

	> 1. åœ¨æºredisä¸Šæ‰§è¡Œdumpï¼ŒèŽ·å¾—valueçš„RDBæ ¼å¼
	>
	> 	```shell
	> 	redis-source>set hello worldOK
	> 	redis-source>dump hello"\x00\x05world\x06\x00\x8f<T\x04\xfCNO"
	> 	```
	>
	> 2. æŠŠå¾—åˆ°çš„RDBä¼ ç»™ç›®æ ‡redisï¼Œç„¶åŽå°†åºåˆ—åŒ–çš„valueè¿›è¡Œå¤åŽŸ
	>
	> 	```shell
	> 	redis-target>get hello
	> 	(nil)
	> 	redis-target>restore hello 0 "\x00\x05world\x06\x00\x8f<T\x04å·\xfcNQ"OK
	> 	redis-target> get hello"world"
	> 	```
	>
	> 3. ==dump+restoreä¸æ˜¯åŽŸå­æ€§çš„ï¼Œæ˜¯åˆ†å¸ƒå®Œæˆçš„ï¼›è¿ç§»è¿‡ç¨‹éœ€è¦å¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œç”±å®ƒä»¬åˆ†åˆ«æ‰§è¡Œdumpå’Œrestoreå‘½ä»¤==

5. ==migrateå‘½ä»¤ï¼šç»¼åˆdump+restore+del==

	> 1. ```shell
	> 	migrate host port key!"" destination-db timeout [copy] [replace] [keys key [key ...]]
	> 	```
	>
	> 2. å…·æœ‰åŽŸå­æ€§ï¼Œåªéœ€è¦åœ¨æºredisä¸Šæ‰§è¡Œå³å¯

6. > ![å¾®ä¿¡æˆªå›¾_20240403212945](Redis.assets/å¾®ä¿¡æˆªå›¾_20240403212945.png)

7. keyså‘½ä»¤éåŽ†æ”¯æŒglobé£Žæ ¼çš„é€šé…ç¬¦ï¼Œä½†æ˜¯å¦‚æžœå¾—åˆ°çš„é”®å¤ªå¤šå®¹æ˜“é€ æˆredisé˜»å¡ž

8. scané‡‡ç”¨æ¸è¿›å¼éåŽ†çš„æ–¹å¼æ¥è§£å†³keyså‘½ä»¤å¯èƒ½å¸¦æ¥çš„é˜»å¡žé—®é¢˜

	> 1. Rediså­˜å‚¨é”®å€¼å¯¹å®žé™…ä½¿ç”¨çš„æ˜¯hashtableçš„æ•°æ®ç»“æž„ã€‚
	>
	> 2. ```shell
	> 	scan cursor [match patternlcount numberl
	> 	```
	>
	> 3. cursoræ˜¯å¿…éœ€å‚æ•°ï¼Œ==å®žé™…ä¸Šcursoræ˜¯ä¸€ä¸ªæ¸¸æ ‡==ï¼Œç¬¬ä¸€æ¬¡éåŽ†ä»Ž0å¼€å§‹ï¼Œæ¯æ¬¡scanéåŽ†å®Œéƒ½ä¼šè¿”å›žå½“å‰æ¸¸æ ‡çš„å€¼ï¼Œç›´åˆ°æ¸¸æ ‡å€¼ä¸º0ï¼Œè¡¨ç¤ºéåŽ†ç»“æŸ

9. å¦‚æžœåœ¨ scan çš„è¿‡ç¨‹ä¸­å¦‚æžœæœ‰é”®çš„å˜åŒ–(å¢žåŠ ã€åˆ é™¤ã€ä¿®æ”¹)ï¼Œé‚£ä¹ˆéåŽ†æ•ˆæžœå¯èƒ½ä¼šç¢°åˆ°å¦‚ä¸‹é—®é¢˜ï¼šæ–°å¢žçš„é”®å¯èƒ½æ²¡æœ‰éåŽ†åˆ°ï¼ŒéåŽ†å‡ºäº†é‡å¤çš„é”®ç­‰æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´==scanå¹¶ä¸èƒ½ä¿è¯å®Œæ•´çš„éåŽ†å‡ºæ¥æ‰€æœ‰çš„é”®==

10. redisæœ‰å¤šä¸ªæ•°æ®åº“ï¼Œä½†æ˜¯è¿™ä¸ªè®¾è®¡å¹¶ä¸å¥½ï¼ŒåŽŸå› å¦‚ä¸‹ï¼š

	> 1. Redisæ˜¯å•çº¿ç¨‹çš„ã€‚å¦‚æžœä½¿ç”¨å¤šä¸ªæ•°æ®åº“ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®åº“ä»ç„¶æ˜¯ä½¿ç”¨ä¸€ä¸ªCPUï¼Œå½¼æ­¤ä¹‹é—´è¿˜æ˜¯ä¼šå—åˆ°å½±å“çš„ã€‚æ¯”å¦‚å‡ºçŽ°ä¸€ä¸ªæ…¢æŸ¥è¯¢ï¼Œå°±ä¼šæ‹–ç´¯å…¶å®ƒæ‰€æœ‰åº“
	> 2. éƒ¨åˆ† Redis çš„å®¢æˆ·ç«¯æ ¹æœ¬å°±ä¸æ”¯æŒè¿™ç§æ–¹å¼

	å› æ­¤å»ºè®®éƒ¨ç½²å¤šä¸ªredisæœåŠ¡åˆ°ä¸åŒçš„ç«¯å£ï¼Œå› ä¸ºCPUæ˜¯å¤šæ ¸çš„ï¼Œè¿™æ ·å¯ä»¥æå‡èµ„æºåˆ©ç”¨çŽ‡

---



### ç¬¬ä¸‰ç« ï¼šå°åŠŸèƒ½å¤§ç”¨å¤„

#### 1.æ…¢æŸ¥è¯¢

1. æ…¢æŸ¥è¯¢åŠŸèƒ½å¯ä»¥==æœ‰æ•ˆåœ°å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°Rediså¯èƒ½å­˜åœ¨çš„ç“¶é¢ˆï¼ˆæ‰§è¡Œåœ°æ¯”è¾ƒæ…¢çš„å‘½ä»¤ï¼‰==
2. æ…¢æŸ¥è¯¢==åªè®°å½•å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼Œå¹¶ä¸åŒ…æ‹¬å‘½ä»¤æŽ’é˜Ÿå’Œç½‘ç»œä¼ è¾“æ—¶é—´==ã€‚å› æ­¤å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤çš„æ—¶é—´ä¼šå¤§äºŽå‘½ä»¤å®žé™…æ‰§è¡Œæ—¶é—´ã€‚
3. ==å› ä¸ºå‘½ä»¤æ‰§è¡ŒæŽ’é˜Ÿæœºåˆ¶ï¼Œæ…¢æŸ¥è¯¢ä¼šå¯¼è‡´å…¶ä»–å‘½ä»¤çº§è”é˜»å¡ž==ï¼Œå› æ­¤å½“å®¢æˆ·ç«¯å‡ºçŽ°è¯·æ±‚è¶…æ—¶ï¼Œéœ€è¦æ£€æŸ¥è¯¥æ—¶é—´ç‚¹æ˜¯å¦æœ‰å¯¹åº”çš„æ…¢æŸ¥è¯¢ï¼Œä»Žè€Œåˆ†æžå‡ºæ˜¯å¦ä¸ºæ…¢æŸ¥è¯¢å¯¼è‡´çš„å‘½ä»¤çº§è”é˜»å¡žã€‚

#### 2.Redis shell

æ²¡å¿…è¦è®°ï¼Œéœ€è¦ç”¨åˆ°æ—¶æŸ¥æ‰‹å†Œ

#### 3.Pipeline

Pipelineèƒ½å°†ä¸€ç»„Rediså‘½ä»¤è¿›è¡Œç»„è£…ï¼Œé€šè¿‡ä¸€æ¬¡RTTï¼ˆå¾€è¿”æ—¶é—´ï¼‰ä¼ è¾“ç»™Redisã€‚

#### 4.äº‹åŠ¡ä¸ŽLua

==å°†ä¸€ç»„éœ€è¦ä¸€èµ·æ‰§è¡Œçš„å‘½ä»¤æ”¾åˆ°multiå’Œexec ä¸¤ä¸ªå‘½ä»¤ä¹‹é—´==

Rediså¹¶ä¸æ”¯æŒå›žæ»šçš„åŠŸèƒ½

> ![å¾®ä¿¡æˆªå›¾_20240404220623](Redis.assets/å¾®ä¿¡æˆªå›¾_20240404220623.png)

Luaæ²¡çœ‹

#### 5.BitMaps

1. å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ·idä»¥ä¸€ä¸ªæŒ‡å®šæ•°å­—(ä¾‹å¦‚10000)å¼€å¤´ï¼Œç›´æŽ¥å°†ç”¨æˆ·idå’ŒBitmapsçš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œé€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åšsetbitæ“ä½œæ—¶å°†ç”¨æˆ·idå‡åŽ»è¿™ä¸ªæŒ‡å®šæ•°å­—ã€‚

2. åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ– Bitmapsæ—¶ï¼Œ==å‡å¦‚åç§»é‡éžå¸¸å¤§ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œå¯èƒ½ä¼šé€ æˆ Redisçš„é˜»å¡ž==ã€‚

3. > ![å¾®ä¿¡æˆªå›¾_20240405210303](Redis.assets/å¾®ä¿¡æˆªå›¾_20240405210303.png)

#### 6.HyperLogLog

1. å®ƒå¹¶ä¸æ˜¯ä¸€ç§æ•°æ®ç»“æž„ï¼Œè€Œæ˜¯ä¸€ç§åŸºæ•°ç®—æ³•ï¼ŒåŒäºŽç»Ÿè®¡ç‹¬ç«‹è®¡æ•°
2. å†…å­˜15kå·¦å³ï¼Œä½†æ˜¯è¯¯å·®çŽ‡ä¸º0.81%

#### 7.å‘å¸ƒè®¢é˜…

1. > <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240405212201.png" alt="å¾®ä¿¡æˆªå›¾_20240405212201" style="zoom:50%;" />

#### 8.GEO

1. GEOåº•å±‚æ˜¯zsetï¼Œå­˜å‚¨ä½ç½®åï¼Œç»åº¦å’Œçº¬åº¦ï¼Œæä¾›è¯¸å¦‚è®¡ç®—ä½ç½®è·ç¦»ï¼ŒèŽ·å–æŸåœ°ç†èŒƒå›´å†…çš„ä½ç½®é›†åˆçš„apiï¼Œå¹¶èƒ½é€šè¿‡geohashå°†äºŒç»´ç»çº¬åº¦è½¬ä¸ºä¸€ç»´å­—ç¬¦ä¸²ã€‚

---



### ç¬¬äº”ç« ï¼šæŒä¹…åŒ–

#### 1.RDB

1. RDB æŒä¹…åŒ–æ˜¯æŠŠ==å½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹==ï¼Œåˆ†ä¸ºæ‰‹åŠ¨è§¦å‘å’Œè‡ªåŠ¨è§¦å‘ã€‚

2. ==bgsave==å‘½ä»¤:Redisè¿›ç¨‹æ‰§è¡Œforkæ“ä½œåˆ›å»º==å­è¿›ç¨‹==ï¼ŒRDBæŒä¹…åŒ–è¿‡ç¨‹ç”±å­è¿›ç¨‹è´Ÿè´£ï¼Œå®ŒæˆåŽè‡ªåŠ¨ç»“æŸã€‚

3. bgsaveå‘½ä»¤æ˜¯é’ˆå¯¹saveé˜»å¡žé—®é¢˜åšçš„ä¼˜åŒ–ã€‚å› æ­¤Rediså†…éƒ¨æ‰€æœ‰çš„æ¶‰åŠRDBçš„æ“ä½œ==éƒ½é‡‡ç”¨bgsaveçš„æ–¹å¼==ï¼Œè€Œsaveå‘½ä»¤å·²ç»åºŸå¼ƒã€‚

4. é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œshutdownå‘½ä»¤æ—¶ï¼Œå¦‚æžœ==æ²¡æœ‰å¼€å¯AOFæŒä¹…åŒ–åŠŸèƒ½åˆ™è‡ªåŠ¨æ‰§è¡Œbgsave==ã€‚

5. RDBçš„æµç¨‹

	> 1. Redisçˆ¶è¿›ç¨‹åˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹ï¼Œå¦‚RDB/AOF å­è¿›ç¨‹ï¼Œå¦‚æžœå­˜åœ¨ç›´æŽ¥return
	> 2. çˆ¶è¿›ç¨‹==æ‰§è¡Œ fork æ“ä½œåˆ›å»ºå­è¿›ç¨‹==ï¼Œ==fork æ“ä½œè¿‡ç¨‹ä¸­çˆ¶è¿›ç¨‹ä¼šé˜»å¡ž==ï¼Œé€šè¿‡ info statså‘½ä»¤æŸ¥çœ‹latest fork usecé€‰é¡¹ï¼Œå¯ä»¥èŽ·å–æœ€è¿‘ä¸€ä¸ª forkæ“ä½œçš„è€—æ—¶ï¼Œå•ä½ä¸ºå¾®ç§’ã€‚
	> 3. çˆ¶è¿›ç¨‹ forkå®ŒæˆåŽï¼Œbgsaveå‘½ä»¤è¿”å›žâ€œBackground saving startedâ€ä¿¡æ¯å¹¶ä¸å†é˜»å¡žçˆ¶è¿›ç¨‹ï¼Œå¯ä»¥ç»§ç»­å“åº”å…¶ä»–å‘½ä»¤ã€‚
	> 4. ==å­è¿›ç¨‹åˆ›å»ºRDBæ–‡ä»¶==ï¼Œæ ¹æ®çˆ¶è¿›ç¨‹å†…å­˜ç”Ÿæˆ==ä¸´æ—¶å¿«ç…§æ–‡ä»¶==ï¼Œå®ŒæˆåŽå¯¹åŽŸæœ‰æ–‡ä»¶è¿›è¡ŒåŽŸå­æ›¿æ¢ã€‚æ‰§è¡Œlastsaveå‘½ä»¤å¯ä»¥èŽ·å–æœ€åŽä¸€æ¬¡ç”ŸæˆRDBçš„æ—¶é—´ï¼Œå¯¹åº”infoç»Ÿè®¡çš„rdb last save timeé€‰é¡¹ã€‚
	> 5. è¿›ç¨‹å‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹è¡¨ç¤ºå®Œæˆï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚
	>
	> <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240406212614.png" alt="å¾®ä¿¡æˆªå›¾_20240406212614" style="zoom:50%;" />

6. > ![å¾®ä¿¡æˆªå›¾_20240406213923](Redis.assets/å¾®ä¿¡æˆªå›¾_20240406213923.png)

#### 2.AOF

1. ä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼==è®°å½•æ¯æ¬¡å†™å‘½ä»¤==ï¼Œ==é‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­çš„å‘½ä»¤==è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚AOFçš„ä¸»è¦ä½œç”¨æ˜¯==è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®žæ—¶æ€§==ï¼Œç›®å‰å·²ç»æ˜¯ RedisæŒä¹…åŒ–çš„ä¸»æµæ–¹å¼ã€‚

2. ==æŒä¹…åŒ–æµç¨‹==ï¼š

	> 1. æ‰€æœ‰çš„å†™äººå‘½ä»¤ä¼š==è¿½åŠ åˆ°aof_buf(ç¼“å†²åŒº)ä¸­==ã€‚
	> 2. AOFç¼“å†²åŒºæ ¹æ®å¯¹åº”çš„ç­–ç•¥==å‘ç¡¬ç›˜åšåŒæ­¥æ“ä½œ==
	> 3. éœ€è¦å®šæœŸå¯¹AOFæ–‡ä»¶è¿›è¡Œ==é‡å†™è¾¾åˆ°åŽ‹ç¼©çš„ç›®çš„==ã€‚
	> 4. å½“==RedisæœåŠ¡å™¨é‡å¯æ—¶ï¼Œå¯ä»¥åŠ è½½AOFæ–‡ä»¶è¿›è¡Œæ•°æ®æ¢å¤==
	>
	> <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240406214851.png" alt="å¾®ä¿¡æˆªå›¾_20240406214851" style="zoom:50%;" />

3. AOF==ä¸ºä»€ä¹ˆæŠŠå‘½ä»¤è¿½åŠ åˆ°aof_bufä¸­?==

	> Redisä½¿ç”¨å•çº¿ç¨‹å“åº”å‘½ä»¤ï¼Œå¦‚æžœ==æ¯æ¬¡å†™AOFæ–‡ä»¶å‘½ä»¤éƒ½ç›´æŽ¥è¿½åŠ åˆ°ç¡¬ç›˜ï¼Œé‚£ä¹ˆæ€§èƒ½å®Œå…¨å–å†³äºŽå½“å‰ç¡¬ç›˜è´Ÿè½½==ã€‚å…ˆå†™å…¥ç¼“å†²åŒºaofbufä¸­ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªå¥½å¤„ï¼ŒRediså¯ä»¥æä¾›å¤šç§ç¼“å†²åŒºåŒæ­¥ç¡¬ç›˜çš„ç­–ç•¥ï¼Œåœ¨æ€§èƒ½å’Œå®‰å…¨æ€§æ–¹é¢åšå‡ºå¹³è¡¡ã€‚

4. Redis æä¾›äº†å¤šç§ AOF ç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥ï¼Œç”±å‚æ•°appendfsyncæŽ§åˆ¶

	> ![å¾®ä¿¡æˆªå›¾_20240406215428](Redis.assets/å¾®ä¿¡æˆªå›¾_20240406215428.png)

6. ==é‡å†™æœºåˆ¶==ï¼šAOFæ–‡ä»¶é‡å†™æ˜¯æŠŠRedisè¿›ç¨‹å†…çš„æ•°æ®è½¬åŒ–ä¸º==å†™å‘½ä»¤ï¼ˆç§»é™¤åˆ æ”¹ï¼‰==åŒæ­¥åˆ°æ–°AOFæ–‡ä»¶çš„è¿‡ç¨‹ã€‚

7. ==é‡å†™æµç¨‹==ï¼š

	> 1. ==ä¸»è¿›ç¨‹forkæ“ä½œå®ŒæˆåŽï¼Œç»§ç»­å“åº”å…¶ä»–å‘½ä»¤==ã€‚æ‰€æœ‰ä¿®æ”¹å‘½ä»¤ä¾ç„¶å†™äººAOFç¼“å†²åŒºå¹¶æ ¹æ® appendfsync ç­–ç•¥==åŒæ­¥åˆ°ç¡¬ç›˜==ï¼Œä¿è¯åŽŸæœ‰ AOF æœºåˆ¶==ä¸€è‡´æ€§==ã€‚
	> 2. ==å­è¿›ç¨‹åªèƒ½å…±äº« forkæ“ä½œæ—¶çš„å†…å­˜æ•°æ®==ã€‚ç”±äºŽçˆ¶è¿›ç¨‹ä¾ç„¶å“åº”å‘½ä»¤ï¼Œ==Redisä½¿ç”¨â€œAOFé‡å†™ç¼“å†²åŒºâ€ä¿å­˜è¿™éƒ¨åˆ†æ–°æ•°æ®==ï¼Œé˜²æ­¢æ–°AOFæ–‡ä»¶ç”ŸæˆæœŸé—´ä¸¢å¤±è¿™éƒ¨åˆ†æ•°æ®
	>
	> <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240406220758.png" alt="å¾®ä¿¡æˆªå›¾_20240406220758" style="zoom:50%;" />

8. å¯åŠ¨æµç¨‹ï¼š

	> <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240406220930.png" alt="å¾®ä¿¡æˆªå›¾_20240406220930" style="zoom:50%;" />

9. AOFæ–‡ä»¶å¯èƒ½å­˜åœ¨ç»“å°¾ä¸å®Œæ•´çš„æƒ…å†µï¼Œæ¯”å¦‚==æœºå™¨çªç„¶æŽ‰ç”µå¯¼è‡´AOFå°¾éƒ¨æ–‡ä»¶å‘½ä»¤å†™å…¥ä¸å…¨==ã€‚

	Redis ä¸ºæˆ‘ä»¬æä¾›äº† aof-load-truncatedé…ç½®æ¥å…¼å®¹è¿™ç§æƒ…å†µï¼Œé»˜è®¤å¼€å¯ã€‚åŠ è½½ AOF æ—¶å½“é‡åˆ°æ­¤é—®é¢˜æ—¶ä¼šå¿½ç•¥å¹¶ç»§ç»­å¯åŠ¨

#### 3.é—®é¢˜å®šä½å’Œä¼˜åŒ–

1. å¦‚ä½•æ”¹å–„ fork æ“ä½œçš„è€—æ—¶ï¼Ÿ

	> 1. ä¼˜å…ˆä½¿ç”¨==ç‰©ç†æœº==æˆ–è€…==é«˜æ•ˆæ”¯æŒforkæ“ä½œçš„è™šæ‹ŸåŒ–æŠ€æœ¯==ï¼Œé¿å…ä½¿ç”¨xenã€‚
	> 2. æŽ§åˆ¶ Rediså®žä¾‹æœ€å¤§å¯ç”¨å†…å­˜ï¼Œ==forkè€—æ—¶è·Ÿå†…å­˜é‡æˆæ­£æ¯”==ï¼Œçº¿ä¸Šå»ºè®®æ¯ä¸ªRediså®žä¾‹å†…å­˜æŽ§åˆ¶åœ¨ 10GB ä»¥å†…ã€‚
	> 3. ==åˆç†é…ç½®Linuxå†…å­˜åˆ†é…ç­–ç•¥ï¼Œé¿å…ç‰©ç†å†…å­˜ä¸è¶³å¯¼è‡´forkå¤±è´¥==
	> 4. ==é™ä½Žforkæ“ä½œçš„é¢‘çŽ‡==ï¼Œå¦‚é€‚åº¦æ”¾å®½AOFè‡ªåŠ¨è§¦å‘æ—¶æœºï¼Œé¿å…ä¸å¿…è¦çš„å…¨é‡å¤åˆ¶ç­‰ã€‚

2. ==å­è¿›ç¨‹éžå¸¸æ¶ˆè€—CPU==ï¼Œä¼šå’Œçˆ¶è¿›ç¨‹äº§ç”Ÿå•æ ¸èµ„æºç«žäº‰ã€‚==ä¸è¦å’Œå…¶ä»–CPUå¯†é›†åž‹æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·==ï¼Œé€ æˆCPUè¿‡åº¦ç«žäº‰ã€‚

3. ==å†…å­˜æ¶ˆè€—ä¼˜åŒ–ï¼š==

	> 1. åŒCPUä¼˜åŒ–ä¸€æ ·ï¼Œå¦‚æžœéƒ¨ç½²å¤šä¸ªRediså®žä¾‹ï¼Œ==å°½é‡ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå­è¿›ç¨‹åœ¨å·¥ä½œ==ã€‚
	> 2. é¿å…åœ¨å¤§é‡å†™äººæ—¶åšå­è¿›ç¨‹é‡å†™æ“ä½œï¼Œè¿™æ ·å°†å¯¼è‡´çˆ¶è¿›ç¨‹ç»´æŠ¤å¤§é‡é¡µå‰¯æœ¬ï¼Œé€ æˆå†…å­˜æ¶ˆè€—ã€‚

4. ç¡¬ç›˜å¼€é”€ä¼˜åŒ–ï¼š

	> 1. ==ä¸è¦å’Œå…¶ä»–é«˜ç¡¬ç›˜è´Ÿè½½çš„æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·==ã€‚å¦‚:å­˜å‚¨æœåŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ç­‰
	> 2. ==AOF é‡å†™æ—¶ä¼šæ¶ˆè€—å¤§é‡ç¡¬ç›˜IO==ï¼Œå¯ä»¥å¼€å¯é…ç½® no-appendfsync-on-rewriteé»˜è®¤å…³é—­ã€‚è¡¨ç¤ºåœ¨ AOF é‡å†™æœŸé—´ä¸åšfsync æ“ä½œã€‚
	> 3. å¯¹äºŽå•æœºé…ç½®å¤šä¸ªRediså®žä¾‹çš„æƒ…å†µï¼Œå¯ä»¥é…ç½®==ä¸åŒå®žä¾‹*åˆ†ç›˜* å­˜å‚¨AOF æ–‡ä»¶==ï¼Œåˆ†æ‘Šç¡¬ç›˜å†™å…¥åŽ‹åŠ›ã€‚

5. ==AOFè¿½åŠ é˜»å¡ž==

	> ![å¾®ä¿¡æˆªå›¾_20240407221741](Redis.assets/å¾®ä¿¡æˆªå›¾_20240407221741.png)

6. ==å­è¿›ç¨‹æ‰§è¡ŒæœŸé—´ä½¿ç”¨`copy-on-write`æœºåˆ¶ä¸Žçˆ¶è¿›ç¨‹å…±äº«å†…å­˜ï¼Œé¿å…å†…å­˜æ¶ˆè€—ç¿»å€==ã€‚AOF==é‡å†™æœŸé—´è¿˜éœ€è¦ç»´æŠ¤é‡å†™ç¼“å†²åŒº==ï¼Œä¿å­˜æ–°çš„å†™äººå‘½ä»¤é¿å…æ•°æ®ä¸¢å¤±ã€‚

7. å•æœºéƒ¨ç½²å¤šä¸ªå®žä¾‹æ—¶ï¼Œä¸ºé˜²æ­¢å‡ºçŽ°å¤šä¸ªå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œï¼Œå»ºè®®åš==éš”ç¦»æŽ§åˆ¶é¿å… CPUå’Œ IO èµ„æºç«žäº‰==ã€‚

---



### ç¬¬ä¸ƒç« ï¼šé˜»å¡ž

#### 1.å‘çŽ°é˜»å¡ž

1. é™¤äº†åœ¨åº”ç”¨æ–¹åŠ äººç»Ÿè®¡æŠ¥è­¦é€»è¾‘ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å€ŸåŠ©Redisç›‘æŽ§ç³»ç»Ÿå‘çŽ°é˜»å¡žé—®é¢˜ï¼Œå½“ç›‘æŽ§ç³»ç»Ÿæ£€æµ‹åˆ° Redis è¿è¡ŒæœŸçš„ä¸€äº›å…³é”®æŒ‡æ ‡å‡ºçŽ°ä¸æ­£å¸¸æ—¶ä¼šè§¦å‘æŠ¥è­¦ã€‚
2. ç›‘æŽ§ç³»ç»Ÿæ‰€ç›‘æŽ§çš„å…³é”®æŒ‡æ ‡æœ‰å¾ˆå¤šï¼Œå¦‚å‘½ä»¤è€—æ—¶ã€æ…¢æŸ¥è¯¢ã€æŒä¹…åŒ–é˜»å¡žã€è¿žæŽ¥æ‹’ç»CPU/å†…å­˜/ç½‘ç»œ/ç£ç›˜ä½¿ç”¨è¿‡è½½ç­‰ã€‚

#### 2.å†…åœ¨åŽŸå› 

1. ==APIæˆ–æ•°æ®ç»“æž„ä½¿ç”¨ä¸åˆç†==ï¼š

	> ==åœ¨å¤§å¯¹è±¡ä¸Šä½¿ç”¨å¤æ‚åº¦O(n)çš„å‘½ä»¤==
	>
	> 1. å¦‚ä½•å‘çŽ°==æ…¢æŸ¥è¯¢==
	>
	> 	`slowlog get {n}`ï¼ŒèŽ·å–æœ€è¿‘çš„næ¡æ…¢æŸ¥è¯¢ï¼ˆé»˜è®¤æ‰§è¡Œæ—¶é—´ä¸º10msä»¥ä¸Šï¼Œå»ºè®®æ‰‹åŠ¨æ”¹ä¸º1msï¼Œä»¥è¿›è¡Œæ¯«ç§’çº§çš„æŽ§åˆ¶ï¼‰ï¼Œç„¶åŽæŠŠå¤æ‚åº¦è¾ƒé«˜çš„å‘½ä»¤æ”¹ä¸ºå¤æ‚åº¦è¾ƒä½Žçš„å‘½ä»¤ï¼Œå¦‚hgetall->hmget
	>
	> 2. ==å¦‚ä½•å‘çŽ°å¤§å¯¹è±¡==
	>
	> 	```shell
	> 	redis-cli -h{ip} -p{port} --bigkeys;#ä¸­é—´çš„ipå’Œç«¯å£å¯å¿½ç•¥ï¼Œè‡ªåŠ¨å–é»˜è®¤ç«¯å£
	> 	```
	
2. ==CPUé¥±å’Œ==ï¼š

	> ==å•çº¿ç¨‹çš„ Redis å¤„ç†å‘½ä»¤æ—¶åªèƒ½ä½¿ç”¨ä¸€ä¸ªCPU==ã€‚CPUé¥±å’ŒæŒ‡ Redis æŠŠå•æ ¸CPU ä½¿ç”¨çŽ‡è·‘åˆ°æŽ¥è¿‘100%ã€‚
	>
	> CPUé¥±å’Œæ˜¯éžå¸¸å±é™©çš„ï¼Œå°†å¯¼è‡´Redisæ— æ³•å¤„ç†æ›´å¤šçš„å‘½ä»¤ï¼Œä¸¥é‡å½±å“åžåé‡å’Œåº”ç”¨æ–¹çš„ç¨³å®šæ€§ã€‚
	>
	> æ³¨æ„ï¼šziplistç¼–ç æ˜¯redisä½¿ç”¨æ—¶é—´æ¢æ›´ä¸‹çš„ç©ºé—´çš„æ–¹æ³•ï¼Œä¸å¯è¿‡åº¦ä½¿ç”¨ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æŸäº›O(1)å‘½ä»¤çš„æ‰§è¡Œæ—¶é—´åå¸¸åœ°å˜é•¿

3. ==æŒä¹…åŒ–é˜»å¡ž==ï¼š

	> 1. forké˜»å¡ž
	>
	> 2. AOFåˆ·ç›˜é˜»å¡ž
	>
	> 	æ–‡ä»¶åˆ·ç›˜çš„æ–¹å¼ä¸€èˆ¬é‡‡ç”¨æ¯ç§’ä¸€æ¬¡ï¼Œ==åŽå°çº¿ç¨‹æ¯ç§’å¯¹AOFæ–‡ä»¶åšfsyncæ“ä½œ==ã€‚å½“ç¡¬ç›˜åŽ‹åŠ›è¿‡å¤§æ—¶ï¼Œfsyncæ“ä½œéœ€è¦ç­‰å¾…ï¼Œç›´åˆ°å†™å…¥å®Œæˆã€‚å¦‚æžœä¸»çº¿ç¨‹å‘çŽ°è·ç¦»ä¸Šä¸€æ¬¡çš„fsyncæˆåŠŸ==è¶…è¿‡2ç§’==ï¼Œä¸ºäº†æ•°æ®å®‰å…¨æ€§==å®ƒï¼ˆä¸»çº¿ç¨‹ï¼‰ä¼šé˜»å¡žç›´åˆ°åŽå°çº¿ç¨‹æ‰§è¡Œfsyncæ“ä½œå®Œæˆ==ã€‚è¿™ç§é˜»å¡žè¡Œä¸º==ä¸»è¦æ˜¯ç¡¬ç›˜åŽ‹åŠ›å¼•èµ·==
	>
	> 3. HugePageå†™æ“ä½œå¯¼è‡´

#### 3.å¤–åœ¨åŽŸå› 

1. ==CPUç«žäº‰==ï¼š

	> 1. è¿›ç¨‹ç«žäº‰ï¼š
	>
	> 	- Redisæ˜¯å…¸åž‹çš„CPUå¯†é›†åž‹åº”ç”¨ï¼Œ==ä¸å»ºè®®å’Œå…¶ä»–å¤šæ ¸CPUå¯†é›†åž‹æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·==ã€‚å½“å…¶ä»–è¿›ç¨‹è¿‡åº¦æ¶ˆè€—CPUæ—¶ï¼Œå°†ä¸¥é‡å½±å“Redisåžåé‡
	>
	> 2. ç»‘å®šCPUï¼š
	>
	> 	- éƒ¨ç½²Redisæ—¶==ä¸ºäº†å……åˆ†åˆ©ç”¨å¤šæ ¸CPUï¼Œé€šå¸¸ä¸€å°æœºå™¨éƒ¨ç½²å¤šä¸ªå®žä¾‹==ã€‚å¸¸è§çš„==ä¸€ç§ä¼˜åŒ–æ˜¯æŠŠRedisè¿›ç¨‹ç»‘å®šåˆ°CPUä¸Š==ï¼Œç”¨äºŽé™ä½ŽCPUé¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚
	>
	> 	- ==å­è¿›ç¨‹é‡å†™æ—¶å¯¹å•æ ¸CPUä½¿ç”¨çŽ‡é€šå¸¸åœ¨90%ä»¥ä¸Š==ï¼Œçˆ¶è¿›ç¨‹ä¸Žå­è¿›ç¨‹å°†==äº§ç”Ÿæ¿€çƒˆCPUç«žäº‰==ï¼Œæžå¤§å½±å“Redisç¨³å®šæ€§ã€‚
	>
	> 		<img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240409201532.png" alt="å¾®ä¿¡æˆªå›¾_20240409201532" style="zoom:67%;" />

2. ==å†…å­˜äº¤æ¢==ï¼š

	> å†…å­˜äº¤æ¢(swap)å¯¹äºŽRedisæ¥è¯´æ˜¯éžå¸¸è‡´å‘½çš„ï¼ŒRedisä¿è¯é«˜æ€§èƒ½çš„ä¸€ä¸ªé‡è¦å‰ææ˜¯æ‰€æœ‰çš„æ•°æ®åœ¨å†…å­˜ä¸­ã€‚==å¦‚æžœæ“ä½œç³»ç»ŸæŠŠRedisä½¿ç”¨çš„éƒ¨åˆ†å†…å­˜æ¢å‡ºåˆ°ç¡¬ç›˜==ï¼Œç”±äºŽ==å†…å­˜ä¸Žç¡¬ç›˜è¯»å†™é€Ÿåº¦å·®å‡ ä¸ªæ•°é‡çº§==ï¼Œä¼šå¯¼è‡´å‘ç”Ÿäº¤æ¢åŽçš„Redisæ€§èƒ½æ€¥å‰§ä¸‹é™

3. ==ç½‘ç»œé—®é¢˜==ï¼š

	> 1. ç½‘ç»œé—ªæ–­
	> 2. Redisè¿žæŽ¥æ‹’ç»ï¼šè¶…è¿‡å®¢æˆ·ç«¯æœ€å¤§è¿žæŽ¥æ•°
	> 3. è¿žæŽ¥æº¢å‡ºï¼ˆæ²¡ç»†çœ‹ï¼‰
	> 4. ç½‘ç»œå»¶è¿Ÿ
	> 5. ç½‘å¡è½¯ä¸­æ–­

----



### ç¬¬å…«ç« ï¼šç†è§£å†…å­˜

#### 1.å†…å­˜æ¶ˆè€—

1. æŸ¥è¯¢å†…å­˜æ¶ˆè€—æ–¹å¼ï¼š

	```shell
	info memory
	```

2. ==å¯¹è±¡å†…å­˜==ï¼šå¯¹è±¡å†…å­˜æ˜¯Rediså†…å­˜å ç”¨æœ€å¤§çš„ä¸€å—ï¼Œå­˜å‚¨ç€ç”¨æˆ·æ‰€æœ‰çš„æ•°æ®ã€‚

3. ==ç¼“å†²å†…å­˜==ï¼š

	> 1. ==å®¢æˆ·ç«¯ç¼“å†²==ï¼šä¸€èˆ¬å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä½†æ˜¯å¦‚æžœå­˜åœ¨å¤§é‡æ…¢è¿žæŽ¥çš„è¯å°±ä¸è¡Œäº†ã€‚å¯ä»¥ä½¿ç”¨maxclientsé…ç½®è¿›è¡Œé™åˆ¶ã€‚
	> 2. ==ä»Žå®¢æˆ·ç«¯ç¼“å†²==
	> 3. ==è®¢é˜…å®¢æˆ·ç«¯==
	> 4. ==AOFç¼“å†²åŒº==ï¼šä¿å­˜æœ€è¿‘å†™å…¥çš„å‘½ä»¤

4. ==å†…å­˜ç¢Žç‰‡==

5. ==å­è¿›ç¨‹æ¶ˆè€—==ï¼š

	> 1. Redisäº§ç”Ÿçš„å­è¿›ç¨‹ï¼ˆAOF\RDBé‡å†™æ—¶çˆ¶è¿›ç¨‹forkå¾—åˆ°ï¼‰å¹¶ä¸éœ€è¦æ¶ˆè€—1å€çš„çˆ¶è¿›ç¨‹å†…å­˜ï¼Œå®žé™…æ¶ˆè€—æ ¹æ®æœŸé—´å†™äººå‘½ä»¤é‡å†³å®šï¼Œä½†æ˜¯ä¾ç„¶è¦é¢„ç•™å‡ºä¸€äº›å†…å­˜é˜²æ­¢æº¢å‡ºã€‚
	> 2. æŽ’æŸ¥å½“å‰ç³»ç»Ÿæ˜¯å¦æ”¯æŒå¹¶å¼€å¯THPï¼Œå¦‚æžœå¼€å¯å»ºè®®å…³é—­ï¼Œé˜²æ­¢copy-on-writeæœŸé—´å†…
	> 	å­˜è¿‡åº¦æ¶ˆè€—ã€‚

#### 2.å†…å­˜ç®¡ç†

1. å†…å­˜å›žæ”¶ç­–ç•¥ï¼š

	> 1. åˆ é™¤è¾¾åˆ°è¿‡æœŸæ—¶é—´çš„å¯¹è±¡
	>
	> 	- æƒ°æ€§åˆ é™¤ï¼Œå½“å®¢æˆ·ç«¯è¯»å–å¸¦æœ‰è¿‡æœŸå±žæ€§çš„é”®æ—¶ï¼Œå¦‚æžœè¶…è¿‡äº†è¿‡æœŸæ—¶é—´ï¼Œåˆ™åˆ é™¤å¹¶è¿”å›žç©ºã€‚ç¼ºç‚¹æ˜¯å¯èƒ½å­˜åœ¨è¿‡æœŸå¯¹è±¡çš„å†…å­˜æ— æ³•åŠæ—¶é‡Šæ”¾æ‰€å¸¦æ¥çš„å†…å­˜ç§»é™¤é—®é¢˜
	> 	- å®šæ—¶ä»»åŠ¡åˆ é™¤ï¼Œé»˜è®¤æ¯ç§’10æ¬¡å®šæ—¶ä»»åŠ¡
	>
	> 2. å†…å­˜æº¢å‡ºæŽ§åˆ¶ç­–ç•¥
	>
	> 	- Rediså…­ç§å†…å­˜æº¢å‡ºæŽ§åˆ¶ç­–ç•¥ï¼š
	>
	> 		![å¾®ä¿¡æˆªå›¾_20240411165633](Redis.assets/å¾®ä¿¡æˆªå›¾_20240411165633.png)
	>
	> 	- å½“Redis ä¸€ç›´å·¥ä½œåœ¨å†…å­˜æº¢å‡º(used emory>maxmemory)çš„çŠ¶æ€ä¸‹æ—¥è®¾ç½®éž noevictionç­–ç•¥æ—¶ï¼Œä¼š==é¢‘ç¹åœ°è§¦å‘å›žæ”¶å†…å­˜çš„æ“ä½œ==ï¼Œå½±å“RedisæœåŠ¡å™¨çš„æ€§èƒ½ã€‚

#### 3.å†…å­˜ä¼˜åŒ–

1. ==redisObjectå¯¹è±¡==ï¼š

	> <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240411170945.png" alt="å¾®ä¿¡æˆªå›¾_20240411170945" style="zoom:50%;" />

2. ==ç¼©å‡é”®å€¼å¯¹è±¡==ï¼š

	> - ç¼©å‡keyå’Œvalueçš„é•¿åº¦
	> - ä½¿ç”¨åŽ‹ç¼©ç®—æ³•åŽ‹ç¼©jsonå’Œxmlå†å­˜å…¥redisï¼Œå¯ä»¥èŠ‚çœ60%çš„ç©ºé—´

3. ==å…±äº«å¯¹è±¡æ± ==ï¼š

	> - ![å¾®ä¿¡æˆªå›¾_20240411173613](Redis.assets/å¾®ä¿¡æˆªå›¾_20240411173613.png)

4. ==å­—ç¬¦ä¸²ä¼˜åŒ–==ï¼š

	> - Redisæ²¡æœ‰æ‰æœ‰Cè¯­è¨€åŽŸç”Ÿçš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯è‡ªå·±å®žçŽ°äº†åŠ¨æ€å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç”±äºŽé‡‡ç”¨é¢„åˆ†é…æœºåˆ¶ï¼Œå­—ç¬¦ä¸²ç¼©å‡ä¸ä¼šé‡Šæ”¾å†…å­˜ï¼Œå› æ­¤è¦æ³¨æ„è¿™éƒ¨åˆ†å†…å­˜çš„æŸè€—

5. ==ç¼–ç ä¼˜åŒ–==ï¼š

	> ![å¾®ä¿¡æˆªå›¾_20240411201030](Redis.assets/å¾®ä¿¡æˆªå›¾_20240411201030.png)
	>
	> ç¼–ç ç±»åž‹è½¬æ¢==åªèƒ½ä»Žå°ç¼–ç è½¬æ¢æˆå¤§ç¼–ç ==

6. ==ziplistç¼–ç ==ï¼š

	> <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240411205247.png" alt="å¾®ä¿¡æˆªå›¾_20240411205247" style="zoom:50%;" />
	>
	> - èŠ‚çœå†…å­˜ï¼Œä½†æ˜¯å¢žåŠ è€—æ—¶
	> - è¯»å†™æ“ä½œè®¾è®¡å¤æ‚åº¦æŒ‡é’ˆç§»åŠ¨ï¼Œæœ€å¤§å¤æ‚åº¦ä¸ºO(n2)
	> - é€‚åˆå­˜å‚¨å°å¯¹è±¡å’Œé•¿åº¦æœ‰é™çš„æ•°æ®

7. ==intsetç¼–ç ==ï¼š

	> - intsetç©ºé—´å’Œæ€§èƒ½éƒ½æ¯”å“ˆå¸Œè¡¨å¥½ï¼Œå±€é™æ˜¯åªèƒ½å­˜æ•´æ•°

8. Redisçš„é”®è¿‡å¤šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ziplistå°†è¿™äº›é”®åˆ†ç»„ï¼Œ==å‡å°å†…å­˜æ¶ˆè€—ï¼ˆä»£ä»·æ˜¯å†™å…¥è€—æ—¶è¾ƒå¤§ï¼Œä¸”æŸ¥æ‰¾é€Ÿåº¦ç›¸æ¯”æ›´æ…¢==ï¼‰ï¼Œä½†æ˜¯è¦==æ³¨æ„æ¯ä¸ªziplistçš„é•¿åº¦ä¸å®œè¶…è¿‡1000ä¸”å¯¹è±¡ä¸èƒ½è¿‡å¤§(1KB)ï¼Œä¸ç„¶åè€Œä¼šåŠ å¤§CPUæ¶ˆè€—==ã€‚

	> zipliståˆ†ç»„åŽä¸èƒ½åœ¨ä½¿ç”¨expireå’ŒLRUæ·˜æ±°æœºåˆ¶ï¼Œéœ€è¦æ‰‹åŠ¨ç»´æŠ¤åˆ é™¤

---



### ç¬¬åä¸€ç« ï¼šç¼“å­˜è®¾è®¡

#### 1.ç¼“å­˜çš„æ”¶ç›Šå’Œæˆæœ¬

1. ![å¾®ä¿¡æˆªå›¾_20240412213449](Redis.assets/å¾®ä¿¡æˆªå›¾_20240412213449.png)

#### 2.ç¼“å­˜æ›´æ–°ç­–ç•¥

1. ![å¾®ä¿¡æˆªå›¾_20240413215402](Redis.assets/å¾®ä¿¡æˆªå›¾_20240413215402.png)

#### 3.ç¼“å­˜ç²’åº¦æŽ§åˆ¶

1. ![å¾®ä¿¡æˆªå›¾_20240413215745](Redis.assets/å¾®ä¿¡æˆªå›¾_20240413215745.png)

#### 4.ç©¿é€ä¼˜åŒ–

1. ==ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜å±‚å’Œå­˜å‚¨å±‚éƒ½ä¸ä¼šå‘½ä¸­==

2. ==ç¼“å­˜ç©ºå¯¹è±¡==ï¼š

	> <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240414234618.png" alt="å¾®ä¿¡æˆªå›¾_20240414234618" style="zoom:67%;" />

3. ä½¿ç”¨==ç¼“å­˜ç©ºå€¼è§£å†³ç¼“å­˜ç©¿é€çš„ç¼ºç‚¹==ï¼š

	> 1. åœ¨==å†…å­˜ä½¿ç”¨æ›´å¤šçš„é”®ä¿å­˜ç©ºå€¼==ï¼Œæµªè´¹å†…å­˜ç©ºé—´ï¼Œå¯ä»¥é‡‡ç”¨==expiredçš„æ–¹å¼ç¼“è§£==
	> 2. ç¼“å­˜å’Œå‚¨å­˜çš„æ•°æ®ä¼šæœ‰ä¸€æ®µæ—¶é—´ä¸ä¸€è‡´

4. ==å¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆª==ï¼š

	> <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240414235227.png" alt="å¾®ä¿¡æˆªå›¾_20240414235227" style="zoom: 67%;" />
	>
	> åœ¨è®¿é—®ç¼“å­˜å±‚ä¹‹å‰åšä¸€æ¬¡æ‹¦æˆªï¼Œå°†ä¸å­˜åœ¨çš„keyçš„è¯·æ±‚çš„è¿‡æ»¤æŽ‰

5. ç¼“å­˜ç©ºå¯¹è±¡ vs å¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆªï¼š

	> ![å¾®ä¿¡æˆªå›¾_20240414235351](Redis.assets/å¾®ä¿¡æˆªå›¾_20240414235351.png)

#### 5.æ— åº•æ´žä¼˜åŒ–

1. æ— åº•æ´žé—®é¢˜ï¼šç›¸æ¯”äºŽå•æœºæ‰¹é‡æ“ä½œåªæ¶‰åŠä¸€æ¬¡ç½‘ç»œæ“ä½œï¼Œ==åˆ†å¸ƒå¼æ‰¹é‡æ“ä½œæ¶‰åŠå¤šæ¬¡ç½‘ç»œæ“ä½œ==ï¼Œå› æ­¤==æ·»åŠ è¿‡å¤šèŠ‚ç‚¹åè€Œä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™==

	> <img src="Redis.assets/å¾®ä¿¡æˆªå›¾_20240415000434.png" alt="å¾®ä¿¡æˆªå›¾_20240415000434" style="zoom:67%;" />

2. ==åº”å¯¹ç­–ç•¥==ï¼š

	> ![å¾®ä¿¡æˆªå›¾_20240415001618](Redis.assets/å¾®ä¿¡æˆªå›¾_20240415001618.png)

#### 6.é›ªå´©ä¼˜åŒ–

1. ==é›ªå´©é—®é¢˜==ï¼šç¼“å­˜å±‚å´©æºƒï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚ä¸€ä¸‹å­å…¨éƒ¨æ¶Œå…¥å‚¨å­˜å±‚ï¼Œå¯¼è‡´æ•ˆçŽ‡å¤§å¹…ä¸‹é™ï¼Œç”šè‡³å¤§é‡çº¿ç¨‹é˜»å¡žè€Œå¯¼è‡´å¤§é‡æœåŠ¡ä¸å¯ç”¨

#### 7.çƒ­ç‚¹Keyé‡å»ºä¼˜åŒ–

1. åœ¨==ç¼“å­˜å¤±æ•ˆçš„çž¬é—´ï¼Œæœ‰å¤§é‡çº¿ç¨‹æ¥é‡å»ºç¼“å­˜ï¼ˆä¸Šä¸€æ¬¡é‡å»ºæ²¡æœ‰å®Œæˆï¼Œè€Œå…¶å®ƒå¤§é‡çš„è¯·æ±‚æ¶Œå…¥å¯¼è‡´æ‰§è¡Œå¤§é‡é‡å»ºç¼“å­˜çš„æ“ä½œï¼‰==ï¼Œé€ æˆåŽç«¯è´Ÿè½½åŠ å¤§ï¼Œç”šè‡³å¯èƒ½ä¼šè®©åº”ç”¨å´©æºƒã€‚
2. ![å¾®ä¿¡æˆªå›¾_20240415003400](Redis.assets/å¾®ä¿¡æˆªå›¾_20240415003400.png)

---



## Redisæ ¸å¿ƒæŠ€æœ¯ä¸Žå®žæˆ˜

> ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/79da7093ed998a99d9abe91e610b74e7.jpg)
>
> ----
>
> ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/70a5bc1ddc9e3579a2fcb8a5d44118b4.jpeg)
>
> ---
>
> ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/13946f7543f9eea58c9bd2b877826b7e.jpg)

---



### 2.åŸºæœ¬æž¶æž„ï¼šä¸€ä¸ªé”®å€¼æ•°æ®åº“åŒ…å«ä»€ä¹ˆï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. ==é”®å€¼æ•°æ®åº“çš„åŸºæœ¬æ“ä½œ==ï¼š

	> æŸ¥è¯¢ä¸€ä¸ªç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…çš„è®¿é—®è®°å½•ã€‚è¿™ç§æ“ä½œåœ¨é”®å€¼æ•°æ®åº“ä¸­å±žäºŽ SCAN æ“ä½œï¼Œå³==æ ¹æ®ä¸€æ®µ key çš„èŒƒå›´è¿”å›žç›¸åº”çš„ value å€¼ã€‚å› æ­¤ï¼ŒPUT/GET/DELETE/SCAN æ˜¯ä¸€ä¸ªé”®å€¼æ•°æ®åº“çš„åŸºæœ¬æ“ä½œé›†åˆã€‚==

2. ==é”®å€¼å¯¹ä¿å­˜åœ¨å†…å­˜è¿˜æ˜¯å¤–å­˜ï¼Ÿ==

	> - ä¿å­˜åœ¨==å†…å­˜çš„å¥½å¤„æ˜¯è¯»å†™å¾ˆå¿«==ï¼Œæ¯•ç«Ÿå†…å­˜çš„è®¿é—®é€Ÿåº¦ä¸€èˆ¬éƒ½åœ¨ç™¾ ns çº§åˆ«ã€‚ä½†æ˜¯ï¼Œ==æ½œåœ¨çš„é£Žé™©æ˜¯ä¸€æ—¦æŽ‰ç”µï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½ä¼šä¸¢å¤±==ã€‚
	>
	> - ä¿å­˜åœ¨==å¤–å­˜ï¼Œè™½ç„¶å¯ä»¥é¿å…æ•°æ®ä¸¢å¤±==ï¼Œä½†æ˜¯å—é™äºŽ==ç£ç›˜çš„æ…¢é€Ÿè¯»å†™==ï¼ˆé€šå¸¸åœ¨å‡  ms çº§åˆ«ï¼‰ï¼Œé”®å€¼æ•°æ®åº“çš„==æ•´ä½“æ€§èƒ½ä¼šè¢«æ‹‰ä½Ž==ã€‚

3. ==é‡‡ç”¨ä»€ä¹ˆè®¿é—®æ¨¡å¼==ï¼Ÿ

	> - <img src="https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/ec18bf4b8afef2fa8b99af252d95a2d5.jpg" alt="img" style="zoom: 20%;" />
	> - è®¿é—®æ¨¡å¼é€šå¸¸æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯==é€šè¿‡å‡½æ•°åº“è°ƒç”¨çš„æ–¹å¼ä¾›å¤–éƒ¨åº”ç”¨ä½¿ç”¨==ï¼Œæ¯”å¦‚ï¼Œä¸Šå›¾ä¸­çš„ libsimplekv.soï¼Œå°±æ˜¯ä»¥åŠ¨æ€é“¾æŽ¥åº“çš„å½¢å¼é“¾æŽ¥åˆ°æˆ‘ä»¬è‡ªå·±çš„ç¨‹åºä¸­ï¼Œæä¾›é”®å€¼å­˜å‚¨åŠŸèƒ½ï¼›
	>
	> - å¦ä¸€ç§æ˜¯==é€šè¿‡ç½‘ç»œæ¡†æž¶ä»¥ Socket é€šä¿¡çš„å½¢å¼å¯¹å¤–æä¾›é”®å€¼å¯¹æ“ä½œ==ï¼Œè¿™ç§å½¢å¼å¯ä»¥æä¾›å¹¿æ³›çš„é”®å€¼å­˜å‚¨æœåŠ¡ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç½‘ç»œæ¡†æž¶ä¸­åŒ…æ‹¬ Socket Server å’Œåè®®è§£æžã€‚

4. ==å•çº¿ç¨‹ vs å¤šçº¿ç¨‹==

	> - å•çº¿ç¨‹ï¼šå¦‚æžœä¸€ä¸ªçº¿ç¨‹æ—¢è¦å¤„ç†ç½‘ç»œè¿žæŽ¥ã€è§£æžè¯·æ±‚ï¼Œåˆè¦å®Œæˆæ•°æ®å­˜å–ï¼Œ==ä¸€æ—¦æŸä¸€æ­¥æ“ä½œå‘ç”Ÿé˜»å¡žï¼Œæ•´ä¸ªçº¿ç¨‹å°±ä¼šé˜»å¡žä½==ï¼Œè¿™å°±é™ä½Žäº†ç³»ç»Ÿå“åº”é€Ÿåº¦
	> - å¤šçº¿ç¨‹ï¼šæŸä¸ªçº¿ç¨‹è¢«é˜»å¡žæ—¶ï¼Œå…¶ä»–çº¿ç¨‹è¿˜èƒ½æ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯ï¼Œ==ä¸åŒçº¿ç¨‹é—´å¦‚æžœéœ€è¦è®¿é—®å…±äº«èµ„æºï¼Œé‚£åˆä¼šäº§ç”Ÿçº¿ç¨‹ç«žäº‰ï¼Œä¹Ÿä¼šå½±å“ç³»ç»Ÿæ•ˆçŽ‡==

5. ==å¦‚ä½•å®šä½é”®å€¼å¯¹çš„ä½ç½®==ï¼Ÿ

	> - ==ç´¢å¼•çš„ä½œç”¨æ˜¯è®©é”®å€¼æ•°æ®åº“æ ¹æ® key æ‰¾åˆ°ç›¸åº” value çš„å­˜å‚¨ä½ç½®ï¼Œè¿›è€Œæ‰§è¡Œæ“ä½œ==ã€‚
	> - ä¸€èˆ¬è€Œè¨€ï¼Œ==å†…å­˜é”®å€¼æ•°æ®åº“==ï¼ˆä¾‹å¦‚ Redisï¼‰é‡‡ç”¨==å“ˆå¸Œè¡¨ä½œä¸ºç´¢å¼•==ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†åŽŸå› åœ¨äºŽï¼Œå…¶==é”®å€¼æ•°æ®åŸºæœ¬éƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜==ä¸­çš„ï¼Œè€Œ==å†…å­˜çš„é«˜æ€§èƒ½éšæœºè®¿é—®ç‰¹æ€§å¯ä»¥å¾ˆå¥½åœ°ä¸Žå“ˆå¸Œè¡¨ O(1) çš„æ“ä½œå¤æ‚åº¦ç›¸åŒ¹é…==ã€‚
	> - å¯¹äºŽ Redis è€Œè¨€ï¼Œå¾ˆæœ‰æ„æ€çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒçš„ value æ”¯æŒå¤šç§ç±»åž‹ï¼Œå½“æˆ‘ä»¬é€šè¿‡ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ª key æ‰€å¯¹åº”çš„ value åŽï¼Œä»ç„¶éœ€è¦ä»Ž value çš„å¤æ‚ç»“æž„ï¼ˆä¾‹å¦‚é›†åˆå’Œåˆ—è¡¨ï¼‰ä¸­è¿›ä¸€æ­¥æ‰¾åˆ°æˆ‘ä»¬å®žé™…éœ€è¦çš„æ•°æ®ï¼Œ==è¿™ä¸ªæ“ä½œçš„æ•ˆçŽ‡æœ¬èº«å°±ä¾èµ–äºŽå®ƒä»¬çš„å®žçŽ°ç»“æž„ï¼ˆå¦‚ziplist, intsetç­‰ï¼‰==ã€‚

6. ==é”®å€¼æ•°æ®åº“çš„æŒä¹…åŒ–ç­–ç•¥==ï¼š

	> - ä¸€ç§æ–¹å¼æ˜¯ï¼Œå¯¹äºŽ==æ¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ŒSimpleKV éƒ½å¯¹å…¶è¿›è¡Œè½ç›˜ä¿å­˜==ï¼Œè¿™è™½ç„¶è®© SimpleKV çš„æ•°æ®æ›´åŠ å¯é ï¼Œä½†æ˜¯ï¼Œå› ä¸º==æ¯æ¬¡éƒ½è¦å†™ç›˜ï¼ŒSimpleKV çš„æ€§èƒ½ä¼šå—åˆ°å¾ˆå¤§å½±å“==ã€‚
	> - å¦ä¸€ç§æ–¹å¼æ˜¯ï¼ŒSimpleKV åªæ˜¯==å‘¨æœŸæ€§åœ°æŠŠå†…å­˜ä¸­çš„é”®å€¼æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ä¸­==ï¼Œè¿™æ ·å¯ä»¥==é¿å…é¢‘ç¹å†™ç›˜æ“ä½œçš„æ€§èƒ½å½±å“==ã€‚ä½†æ˜¯ï¼Œä¸€ä¸ªæ½œåœ¨çš„ä»£ä»·æ˜¯ SimpleKV çš„==æ•°æ®ä»ç„¶æœ‰ä¸¢å¤±çš„é£Žé™©==ã€‚

7. ==SimpleKV vs Redis==

	> ![image-20230109185959371](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/image-20230109185959371.png)

---



### 3.æ•°æ®ç»“æž„ï¼šå¿«é€Ÿçš„Redisæœ‰å“ªäº›æ…¢æ“ä½œï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. > ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/8219f7yy651e566d47cc9f661b399f01.jpg)

2. ==é”®å’Œå€¼ï¼ˆkeyä¸ºredisKey, valueä¸ºæ•°æ®ç±»åž‹ï¼‰ç”¨ä»€ä¹ˆç»“æž„ç»„ç»‡==ï¼Ÿ

	> - ==Redis ä½¿ç”¨äº†ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥ä¿å­˜æ‰€æœ‰é”®å€¼å¯¹==ã€‚ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå…¶å®žå°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ==æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ç§°ä¸ºä¸€ä¸ªå“ˆå¸Œæ¡¶==ã€‚æ¯ä¸ª==å“ˆå¸Œæ¡¶ä¸­ä¿å­˜äº†é”®å€¼å¯¹æ•°æ®==ã€‚
	>
	> - ==å“ˆå¸Œæ¡¶ä¸­çš„å…ƒç´ ä¿å­˜çš„==å¹¶ä¸æ˜¯å€¼æœ¬èº«ï¼Œè€Œ==æ˜¯æŒ‡å‘å…·ä½“å€¼çš„æŒ‡é’ˆ==ã€‚
	>
	> - ==å…¨å±€å“ˆå¸Œè¡¨==ï¼š
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/1cc8eaed5d1ca4e3cdbaa5a3d48dfb5f.jpg)

3. å½“ä½ å¾€ Redis ä¸­å†™å…¥å¤§é‡æ•°æ®åŽï¼Œå°±å¯èƒ½å‘çŽ°æ“ä½œæœ‰æ—¶å€™ä¼šçªç„¶å˜æ…¢äº†ã€‚è¿™å…¶å®žæ˜¯å› ä¸ºä½ å¿½ç•¥äº†ä¸€ä¸ªæ½œåœ¨çš„é£Žé™©ç‚¹ï¼Œé‚£å°±æ˜¯==å“ˆå¸Œè¡¨çš„å†²çªé—®é¢˜å’Œ rehash å¯èƒ½å¸¦æ¥çš„æ“ä½œé˜»å¡ž==ã€‚

4. ==ä¸ºä»€ä¹ˆå“ˆå¸Œè¡¨æ“ä½œå˜æ…¢äº†==ï¼Ÿ

	> - Redis ä¼šå¯¹å“ˆå¸Œè¡¨åš ==rehash æ“ä½œ==ã€‚rehash ä¹Ÿå°±æ˜¯==å¢žåŠ çŽ°æœ‰çš„å“ˆå¸Œæ¡¶æ•°é‡==ï¼Œè®©é€æ¸==å¢žå¤šçš„ entry å…ƒç´ èƒ½åœ¨æ›´å¤šçš„æ¡¶ä¹‹é—´åˆ†æ•£==ä¿å­˜ï¼Œ==å‡å°‘å•ä¸ªæ¡¶ä¸­çš„å…ƒç´ æ•°é‡ï¼Œä»Žè€Œå‡å°‘å•ä¸ªæ¡¶ä¸­çš„å†²çª==ã€‚
	> - ==rehash çš„æ“ä½œ==ï¼ˆ==Redis é»˜è®¤ä½¿ç”¨äº†ä¸¤ä¸ªå…¨å±€å“ˆå¸Œè¡¨==ï¼šå“ˆå¸Œè¡¨ 1 å’Œå“ˆå¸Œè¡¨ 2ï¼‰ï¼š
	> 	- ç»™==å“ˆå¸Œè¡¨ 2 åˆ†é…æ›´å¤§çš„ç©ºé—´==ï¼Œä¾‹å¦‚æ˜¯å½“å‰å“ˆå¸Œè¡¨ 1 å¤§å°çš„ä¸¤å€ï¼›
	> 	- æŠŠå“ˆå¸Œè¡¨ 1 ä¸­çš„æ•°æ®é‡æ–°æ˜ å°„å¹¶==æ‹·è´åˆ°å“ˆå¸Œè¡¨ 2 ä¸­==ï¼›
	> 	- ==é‡Šæ”¾å“ˆå¸Œè¡¨ 1 çš„ç©ºé—´==ã€‚
	> - å¦‚æžœ==ä¸€æ¬¡æ€§æŠŠå“ˆå¸Œè¡¨ 1 ä¸­çš„æ•°æ®éƒ½è¿ç§»å®Œ==ï¼Œä¼šé€ æˆ ==Redis çº¿ç¨‹é˜»å¡ž==ï¼Œæ— æ³•æœåŠ¡å…¶ä»–è¯·æ±‚ã€‚æ­¤æ—¶ï¼ŒRedis å°±æ— æ³•å¿«é€Ÿè®¿é—®æ•°æ®äº†ã€‚
	> - è§£å†³ä¸€æ¬¡æ€§è¿ç§»æ‰€æœ‰æ•°æ®é€ æˆçš„çº¿ç¨‹é˜»å¡žé—®é¢˜çš„æ–¹æ³•ï¼š==æ¸è¿›å¼ rehash==
	> 	- ==æ¯å¤„ç†ä¸€ä¸ªè¯·æ±‚æ—¶==ï¼Œä»Žå“ˆå¸Œè¡¨ 1 ä¸­çš„==ç¬¬ä¸€ä¸ªç´¢å¼•ä½ç½®å¼€å§‹ï¼ˆæ³¨æ„ä¸æ˜¯æŸ¥åˆ°çš„ä½ç½®ï¼Œè€Œæ˜¯ä»Žåˆå§‹ä½ç½®å¼€å§‹å‘åŽéåŽ†ï¼‰==ï¼Œ==é¡ºå¸¦ç€å°†è¿™ä¸ªç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰ entries æ‹·è´åˆ°å“ˆå¸Œè¡¨ 2 ä¸­==ï¼›
	> 	- ç­‰å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œ==å†é¡ºå¸¦æ‹·è´å“ˆå¸Œè¡¨ 1 ä¸­çš„ä¸‹ä¸€ä¸ªç´¢å¼•ä½ç½®çš„ entries==ã€‚
	> 	- ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/73fb212d0b0928d96a0d7d6ayy76da0c.jpg)

5. ==åº•å±‚æ•°æ®ç»“æž„==ï¼š

	> - ==åŽ‹ç¼©é“¾è¡¨ï¼ˆziplistï¼‰==ï¼š
	>
	> 	- åŽ‹ç¼©åˆ—è¡¨åœ¨è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µ zlbytesã€zltail å’Œ zllenï¼Œåˆ†åˆ«è¡¨ç¤º==åˆ—è¡¨é•¿åº¦ã€åˆ—è¡¨å°¾çš„åç§»é‡å’Œåˆ—è¡¨ä¸­çš„ entry ä¸ªæ•°==ï¼›åŽ‹ç¼©åˆ—è¡¨åœ¨è¡¨å°¾è¿˜æœ‰ä¸€ä¸ª ==zlendï¼Œè¡¨ç¤ºåˆ—è¡¨ç»“æŸ==ã€‚
	> 	- ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/9587e483f6ea82f560ff10484aaca4a0.jpg)
	>
	> - ==è·³è¡¨ï¼ˆskiplistï¼‰==ï¼š
	>
	> 	- ==è·³è¡¨åœ¨é“¾è¡¨çš„åŸºç¡€ä¸Šï¼Œå¢žåŠ äº†å¤šçº§ç´¢å¼•==ï¼Œé€šè¿‡ç´¢å¼•ä½ç½®çš„å‡ ä¸ªè·³è½¬ï¼Œå®žçŽ°æ•°æ®çš„å¿«é€Ÿå®šä½
	> 	- ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/1eca7135d38de2yy16681c2bbc4f3fb4.jpg)
	>
	> - ==å„ç§æ•°æ®ç»“æž„çš„æŸ¥è¯¢é€Ÿåº¦==ï¼š
	>
	> 	<img src="https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/fb7e3612ddee8a0ea49b7c40673a0cf0.jpg" alt="img" style="zoom: 50%;" />

6. ==ä¸åŒæ“ä½œçš„å¤æ‚åº¦==ï¼š

	> - æ“ä½œå¤æ‚åº¦â€œ==å£è¯€==â€ï¼š
	> 	1. å•å…ƒç´ æ“ä½œæ˜¯åŸºç¡€ï¼›
	> 	2. ==èŒƒå›´æ“ä½œéžå¸¸è€—æ—¶==ï¼›
	> 	3. ==ç»Ÿè®¡æ“ä½œé€šå¸¸é«˜æ•ˆ==ï¼›
	> 	4. ä¾‹å¤–æƒ…å†µåªæœ‰å‡ ä¸ªã€‚
	> - ==å•å…ƒç´ æ“ä½œï¼Œæ˜¯æŒ‡æ¯ä¸€ç§é›†åˆç±»åž‹å¯¹å•ä¸ªæ•°æ®å®žçŽ°çš„å¢žåˆ æ”¹æŸ¥æ“ä½œ==ã€‚
	> - ==èŒƒå›´æ“ä½œï¼Œæ˜¯æŒ‡é›†åˆç±»åž‹ä¸­çš„éåŽ†æ“ä½œï¼Œå¯ä»¥è¿”å›žé›†åˆä¸­çš„æ‰€æœ‰æ•°æ®==ã€‚æ¯”å¦‚ Hash ç±»åž‹çš„ HGETALL å’Œ Set ç±»åž‹çš„ SMEMBERSï¼Œæˆ–è€…è¿”å›žä¸€ä¸ªèŒƒå›´å†…çš„éƒ¨åˆ†æ•°æ®ï¼Œæ¯”å¦‚ List ç±»åž‹çš„ LRANGE å’Œ ZSet ç±»åž‹çš„ ZRANGEã€‚==è¿™ç±»æ“ä½œçš„å¤æ‚åº¦ä¸€èˆ¬æ˜¯ O(N)ï¼Œæ¯”è¾ƒè€—æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…==ã€‚
	> - ==SCAN ç³»åˆ—æ“ä½œï¼ˆå¯¹èŒƒå›´æ“ä½œçš„ä¼˜åŒ–ï¼‰==ï¼ˆåŒ…æ‹¬ HSCANï¼ŒSSCAN å’Œ ZSCANï¼‰ï¼Œè¿™ç±»æ“ä½œå®žçŽ°äº†==æ¸è¿›å¼éåŽ†==ï¼Œæ¯æ¬¡==åªè¿”å›žæœ‰é™æ•°é‡çš„æ•°æ®==ï¼Œ==é¿å…äº†ä¸€æ¬¡æ€§è¿”å›žæ‰€æœ‰å…ƒç´ ==è€Œå¯¼è‡´çš„ Redis é˜»å¡žã€‚
	> - ==ç»Ÿè®¡æ“ä½œ==ï¼Œæ˜¯æŒ‡==é›†åˆç±»åž‹å¯¹é›†åˆä¸­æ‰€æœ‰å…ƒç´ ä¸ªæ•°çš„è®°å½•ï¼ˆåªè¿”å›žå…ƒç´ ä¸ªæ•°ï¼‰==ã€‚
	> - ==ä¾‹å¤–æƒ…å†µ==ï¼Œ==åŽ‹ç¼©åˆ—è¡¨å’ŒåŒå‘é“¾è¡¨éƒ½ä¼šè®°å½•è¡¨å¤´å’Œè¡¨å°¾çš„åç§»é‡==ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¯¹äºŽ List ç±»åž‹çš„ LPOPã€RPOPã€LPUSHã€RPUSH è¿™å››ä¸ªæ“ä½œæ¥è¯´å®ƒä»¬çš„å¤æ‚åº¦åªæœ‰ O(1)ã€‚

7. ==æ•´æ•°æ•°ç»„å’ŒåŽ‹ç¼©åˆ—è¡¨åœ¨æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æ–¹é¢å¹¶æ²¡æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿==ï¼Œé‚£ä¸ºä»€ä¹ˆ Redis è¿˜ä¼šæŠŠå®ƒä»¬ä½œä¸ºåº•å±‚æ•°æ®ç»“æž„å‘¢ï¼Ÿ

	> æˆ‘çš„å›žç­”ï¼šèŠ‚çœå†…å­˜ç©ºé—´ï¼Œæ•´åž‹åªå 4å­—èŠ‚ï¼Œè€ŒåŽ‹ç¼©é“¾è¡¨å°±æ˜¯ä¸ºèŠ‚çœå†…å­˜ç©ºé—´è€Œå­˜åœ¨çš„æ•°æ®ç»“æž„

---



### 4.é«˜æ€§èƒ½IOæ¨¡åž‹ï¼šä¸ºä»€ä¹ˆå•çº¿ç¨‹Redisèƒ½é‚£ä¹ˆå¿«ï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. Redis æ˜¯å•çº¿ç¨‹ï¼Œä¸»è¦æ˜¯æŒ‡ ==Redis çš„ç½‘ç»œ IO å’Œé”®å€¼å¯¹è¯»å†™æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„ï¼Œè¿™ä¹Ÿæ˜¯ Redis å¯¹å¤–æä¾›é”®å€¼å­˜å‚¨æœåŠ¡çš„ä¸»è¦æµç¨‹==ã€‚

	> ä½† ==Redis çš„å…¶ä»–åŠŸèƒ½==ï¼Œæ¯”å¦‚æŒä¹…åŒ–ã€å¼‚æ­¥åˆ é™¤ã€é›†ç¾¤æ•°æ®åŒæ­¥ç­‰ï¼Œ==å…¶å®žæ˜¯ç”±é¢å¤–çš„çº¿ç¨‹æ‰§è¡Œçš„==ã€‚

2. ==å¤šçº¿ç¨‹æ€§èƒ½çš„ç“¶é¢ˆ==ï¼š

	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/cbd394e62219cc5a6d9ae64035e51733.jpg)
	> - æ¯”å¦‚ä¸€ä¸ªå…±äº«çš„æ•°æ®ç»“æž„ã€‚å½“æœ‰å¤šä¸ªçº¿ç¨‹è¦ä¿®æ”¹è¿™ä¸ªå…±äº«èµ„æºæ—¶ï¼Œ==ä¸ºäº†ä¿è¯å…±äº«èµ„æºçš„æ­£ç¡®æ€§ï¼Œå°±éœ€è¦æœ‰é¢å¤–çš„æœºåˆ¶è¿›è¡Œä¿è¯==ï¼Œè€Œè¿™ä¸ªé¢å¤–çš„æœºåˆ¶ï¼Œå°±ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€
	> - ==é‡‡ç”¨å¤šçº¿ç¨‹å¼€å‘==ä¸€èˆ¬ä¼šå¼•å…¥==åŒæ­¥åŽŸè¯­==æ¥==ä¿æŠ¤å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®==ï¼Œè¿™ä¹Ÿä¼š==é™ä½Žç³»ç»Ÿä»£ç çš„æ˜“è°ƒè¯•æ€§å’Œå¯ç»´æŠ¤æ€§==ã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼ŒRedis ç›´æŽ¥é‡‡ç”¨äº†å•çº¿ç¨‹æ¨¡å¼

3. ==å•çº¿ç¨‹ Redis ä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«==ï¼Ÿ

	> - ä¸€æ–¹é¢ï¼Œ==Redis çš„å¤§éƒ¨åˆ†æ“ä½œåœ¨å†…å­˜ä¸Šå®Œæˆ==ï¼Œå†åŠ ä¸Šå®ƒé‡‡ç”¨äº†==é«˜æ•ˆçš„æ•°æ®ç»“æž„==ï¼Œä¾‹å¦‚å“ˆå¸Œè¡¨å’Œè·³è¡¨ï¼Œè¿™æ˜¯å®ƒå®žçŽ°é«˜æ€§èƒ½çš„ä¸€ä¸ªé‡è¦åŽŸå› ã€‚
	> - å¦ä¸€æ–¹é¢ï¼Œå°±æ˜¯ ==Redis é‡‡ç”¨äº†å¤šè·¯å¤ç”¨æœºåˆ¶==ï¼Œä½¿å…¶åœ¨==ç½‘ç»œ IO æ“ä½œä¸­èƒ½å¹¶å‘å¤„ç†å¤§é‡çš„å®¢æˆ·ç«¯è¯·æ±‚==ï¼Œå®žçŽ°é«˜åžåçŽ‡ã€‚

4. ==åŸºæœ¬ IO æ¨¡åž‹ä¸Žé˜»å¡žç‚¹==

	> - ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆbind/listenï¼‰ï¼Œå’Œ==å®¢æˆ·ç«¯å»ºç«‹è¿žæŽ¥ï¼ˆacceptï¼‰==ï¼Œ==ä»Ž socket ä¸­è¯»å–è¯·æ±‚ï¼ˆrecvï¼‰==ï¼Œè§£æžå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ˆparseï¼‰ï¼Œæ ¹æ®è¯·æ±‚ç±»åž‹è¯»å–é”®å€¼æ•°æ®ï¼ˆgetï¼‰ï¼Œæœ€åŽç»™å®¢æˆ·ç«¯è¿”å›žç»“æžœï¼Œå³å‘ socket ä¸­å†™å›žæ•°æ®ï¼ˆsendï¼‰ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/e18499ab244e4428a0e60b4da6575bc9.jpg)
	> - ==æ½œåœ¨çš„é˜»å¡žç‚¹ï¼Œåˆ†åˆ«æ˜¯ accept() å’Œ recv()==ã€‚

5. ==éžé˜»å¡žæ¨¡å¼==

	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/1ccc62ab3eb2a63c4965027b4248f34a.jpg)
	> - Redis è°ƒç”¨ recv() åŽï¼Œå¦‚æžœå·²è¿žæŽ¥å¥—æŽ¥å­—ä¸Šä¸€ç›´==æ²¡æœ‰æ•°æ®åˆ°è¾¾==ï¼ŒRedis çº¿ç¨‹åŒæ ·å¯ä»¥==è¿”å›žå¤„ç†å…¶ä»–æ“ä½œ==ã€‚==æˆ‘ä»¬ä¹Ÿéœ€è¦æœ‰æœºåˆ¶ç»§ç»­ç›‘å¬è¯¥å·²è¿žæŽ¥å¥—æŽ¥å­—==ï¼Œå¹¶åœ¨æœ‰æ•°æ®è¾¾åˆ°æ—¶é€šçŸ¥ Redisã€‚

6. ==åŸºäºŽå¤šè·¯å¤ç”¨çš„é«˜æ€§èƒ½ I/O==

	> - æ¨¡åž‹Linux ä¸­çš„ ==IO å¤šè·¯å¤ç”¨æœºåˆ¶æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª IO æµ==ï¼Œå°±æ˜¯æˆ‘ä»¬ç»å¸¸å¬åˆ°çš„ ==select/epoll æœºåˆ¶==ã€‚å…è®¸==å†…æ ¸ä¸­ï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬å¥—æŽ¥å­—å’Œå·²è¿žæŽ¥å¥—æŽ¥å­—==ã€‚å†…æ ¸ä¼š==ä¸€ç›´ç›‘å¬==è¿™äº›å¥—æŽ¥å­—ä¸Šçš„è¿žæŽ¥è¯·æ±‚æˆ–æ•°æ®è¯·æ±‚ã€‚==ä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾==ï¼Œå°±ä¼šäº¤ç»™ Redis çº¿ç¨‹å¤„ç†
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/00ff790d4f6225aaeeebba34a71d8bea.jpg)
	> - è¿™äº›äº‹ä»¶ä¼šè¢«==æ”¾è¿›ä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—==ï¼ŒRedis ==å•çº¿ç¨‹å¯¹è¯¥äº‹ä»¶é˜Ÿåˆ—ä¸æ–­è¿›è¡Œå¤„ç†==ã€‚è¿™æ ·ä¸€æ¥ï¼ŒRedis ==æ— éœ€ä¸€ç›´è½®è¯¢æ˜¯å¦æœ‰è¯·æ±‚å®žé™…å‘ç”Ÿ==ï¼Œè¿™å°±å¯ä»¥é¿å…é€ æˆ CPU èµ„æºæµªè´¹ã€‚
	> - è¿žæŽ¥è¯·æ±‚å’Œè¯»æ•°æ®è¯·æ±‚åˆ†åˆ«å¯¹åº” Accept äº‹ä»¶å’Œ Read äº‹ä»¶ï¼ˆ==è¯·æ±‚å’Œäº‹ä»¶ä¸€ä¸€å¯¹åº”==ï¼‰ï¼ŒRedis åˆ†åˆ«å¯¹è¿™ä¸¤ä¸ªäº‹ä»¶æ³¨å†Œ accept å’Œ get å›žè°ƒå‡½æ•°ï¼ˆ==äº‹ä»¶å’Œå›žè°ƒå‡½æ•°ä¸€ä¸€å¯¹åº”==ï¼‰ã€‚å½“ Linux å†…æ ¸ç›‘å¬åˆ°æœ‰è¿žæŽ¥è¯·æ±‚æˆ–è¯»æ•°æ®è¯·æ±‚æ—¶ï¼Œå°±ä¼šè§¦å‘ Accept äº‹ä»¶å’Œ Read äº‹ä»¶ï¼Œæ­¤æ—¶ï¼Œå†…æ ¸å°±ä¼šå›žè°ƒ Redis ç›¸åº”çš„ accept å’Œ get å‡½æ•°è¿›è¡Œå¤„ç†ï¼ˆ==Linuxå†…æ ¸å°†è¯·æ±‚å’Œäº‹ä»¶å¯¹åº”èµ·æ¥ï¼Œå•çº¿ç¨‹å°±ä¸è¦åŽ»åšå¯¹åº”å·¥ä½œï¼Œè€Œåªéœ€è¦è°ƒç”¨å›žè°ƒå‡½æ•°å³å¯ï¼Œæé«˜äº†å•çº¿ç¨‹çš„å¤„ç†æ•ˆçŽ‡==ï¼‰ã€‚

7. ==å°ç»“==ï¼šRedis å•çº¿ç¨‹æ˜¯æŒ‡å®ƒ==å¯¹ç½‘ç»œ IO å’Œæ•°æ®è¯»å†™çš„æ“ä½œé‡‡ç”¨äº†ä¸€ä¸ªçº¿ç¨‹==ï¼Œè€Œé‡‡ç”¨å•çº¿ç¨‹çš„ä¸€ä¸ªæ ¸å¿ƒåŽŸå› æ˜¯==é¿å…å¤šçº¿ç¨‹å¼€å‘çš„å¹¶å‘æŽ§åˆ¶é—®é¢˜==ã€‚å•çº¿ç¨‹çš„ Redis ä¹Ÿèƒ½èŽ·å¾—==é«˜æ€§èƒ½ï¼Œè·Ÿå¤šè·¯å¤ç”¨çš„ IO æ¨¡åž‹å¯†åˆ‡ç›¸å…³==ï¼Œå› ä¸ºè¿™==é¿å…äº† accept() å’Œ send()/recv() æ½œåœ¨çš„ç½‘ç»œ IO æ“ä½œé˜»å¡žç‚¹==ã€‚

---



### 5.AOFæ—¥å¿—ï¼šå®•æœºäº†ï¼ŒRediså¦‚ä½•é¿å…æ•°æ®ä¸¢å¤±ï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. ==AOF æ—¥å¿—æ˜¯å¦‚ä½•å®žçŽ°çš„==ï¼Ÿ

	> - AOF æ—¥å¿—æ˜¯==å†™åŽæ—¥å¿—==ï¼Œâ€œå†™åŽâ€çš„æ„æ€æ˜¯ Redis æ˜¯==å…ˆæ‰§è¡Œå‘½ä»¤ï¼ŒæŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œç„¶åŽæ‰è®°å½•æ—¥å¿—==ã€‚
	> - <img src="https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/407f2686083afc37351cfd9107319a1f.jpg" alt="img" style="zoom:20%;" />
	> - ==AOF é‡Œè®°å½•çš„æ˜¯ Redis æ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤==ï¼Œè¿™äº›å‘½ä»¤æ˜¯ä»¥æ–‡æœ¬å½¢å¼ä¿å­˜çš„ã€‚
	> - <img src="https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/4d120bee623642e75fdf1c0700623a9f.jpg" alt="img" style="zoom:20%;" />
	> - ==`*3`è¡¨ç¤ºå½“å‰å‘½ä»¤æœ‰ä¸‰ä¸ªéƒ¨åˆ†==ï¼Œæ¯éƒ¨åˆ†éƒ½æ˜¯ç”±â€œ`$+æ•°å­—`â€å¼€å¤´ï¼ŒåŽé¢ç´§è·Ÿç€å…·ä½“çš„å‘½ä»¤ã€é”®æˆ–å€¼ã€‚
	> - ==â€œ`$3 set`â€è¡¨ç¤ºè¿™éƒ¨åˆ†æœ‰ 3 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯â€œ`set`â€å‘½ä»¤==ã€‚
	> - å¦‚æžœ==å…ˆè®°æ—¥å¿—==å†æ‰§è¡Œå‘½ä»¤çš„è¯ï¼Œ==æ—¥å¿—ä¸­å°±æœ‰å¯èƒ½è®°å½•äº†é”™è¯¯çš„å‘½ä»¤ï¼ˆRedis åœ¨å‘ AOF é‡Œé¢è®°å½•æ—¥å¿—çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šå…ˆåŽ»å¯¹è¿™äº›å‘½ä»¤è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼‰==ï¼ŒRedis åœ¨ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºé”™ã€‚
	> - ==å†™åŽæ—¥å¿—==è¿™ç§æ–¹å¼ï¼Œå°±æ˜¯å…ˆè®©ç³»ç»Ÿæ‰§è¡Œå‘½ä»¤ï¼Œ==åªæœ‰å‘½ä»¤èƒ½æ‰§è¡ŒæˆåŠŸï¼Œæ‰ä¼šè¢«è®°å½•åˆ°æ—¥å¿—ä¸­==ã€‚

2. ==AOF æ½œåœ¨çš„é£Žé™©==ï¼š

	> - å¦‚æžœåˆšæ‰§è¡Œå®Œä¸€ä¸ªå‘½ä»¤ï¼Œ==è¿˜æ²¡æœ‰æ¥å¾—åŠè®°æ—¥å¿—å°±å®•æœºäº†==ï¼Œé‚£ä¹ˆ==è¿™ä¸ªå‘½ä»¤å’Œå…¶æ•°æ®å°±æœ‰ä¸¢å¤±çš„é£Žé™©==ã€‚
	> - AOF æ—¥å¿—ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå¦‚æžœåœ¨æŠŠ==æ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜æ—¶ï¼Œç£ç›˜å†™åŽ‹åŠ›å¤§ï¼Œå°±ä¼šå¯¼è‡´å†™ç›˜å¾ˆæ…¢ï¼Œè¿›è€Œå¯¼è‡´åŽç»­çš„æ“ä½œä¹Ÿæ— æ³•æ‰§è¡Œäº†==ã€‚

3. ==ä¸‰ç§å†™å›žç­–ç•¥==

	> - AOF é…ç½®é¡¹ `appendfsync `çš„ä¸‰ä¸ªå¯é€‰å€¼ï¼š
	> 	1. Alwaysï¼ŒåŒæ­¥å†™å›žï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œ==ç«‹é©¬åŒæ­¥åœ°å°†æ—¥å¿—å†™å›žç£ç›˜ï¼ˆå½±å“ä¸»çº¿ç¨‹æ€§èƒ½ï¼‰==ï¼›
	> 	2. Everysecï¼Œæ¯ç§’å†™å›žï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯==å…ˆæŠŠæ—¥å¿—å†™åˆ° AOF æ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜ï¼ˆå¯èƒ½å®•æœºä¸¢å¤±ä¸€ç§’çš„æ•°æ®ï¼‰==ï¼›
	> 	3. Noï¼Œæ“ä½œç³»ç»ŸæŽ§åˆ¶çš„å†™å›žï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œ==åªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ° AOF æ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒº==ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›žç£ç›˜ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/72f547f18dbac788c7d11yy167d7ebf8.jpg)

4. ==AOF é‡å†™æœºåˆ¶==ï¼š

	> - é‡å†™æœºåˆ¶å…·æœ‰==â€œå¤šå˜ä¸€â€åŠŸèƒ½==ã€‚å½“ä¸€ä¸ªé”®å€¼å¯¹è¢«å¤šæ¡å†™å‘½ä»¤==åå¤ä¿®æ”¹==æ—¶ï¼Œåœ¨é‡å†™çš„æ—¶å€™ï¼Œæ˜¯æ ¹æ®è¿™ä¸ªé”®å€¼å¯¹å½“å‰çš„==æœ€æ–°çŠ¶æ€==ï¼Œä¸ºå®ƒç”Ÿæˆå¯¹åº”çš„å†™å…¥å‘½ä»¤ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/6528c699fdcf40b404af57040bb8d208.jpg)
	> - æŠŠ==æ•´ä¸ªæ•°æ®åº“çš„æœ€æ–°æ•°æ®çš„æ“ä½œæ—¥å¿—éƒ½å†™å›žç£ç›˜ï¼Œä»ç„¶æ˜¯ä¸€ä¸ªéžå¸¸è€—æ—¶çš„è¿‡ç¨‹==ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±è¦ç»§ç»­å…³æ³¨å¦ä¸€ä¸ªé—®é¢˜äº†ï¼š==é‡å†™ä¼šä¸ä¼šé˜»å¡žä¸»çº¿ç¨‹==ï¼Ÿ

5. ==AOF é‡å†™ä¼šé˜»å¡žå—==?

	> - å’Œ AOF æ—¥å¿—ç”±ä¸»çº¿ç¨‹å†™å…¥ä¸åŒï¼Œ==é‡å†™è¿‡ç¨‹æ˜¯ç”±åŽå°å­è¿›ç¨‹ bgrewriteaof æ¥å®Œæˆçš„==ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†é¿å…é˜»å¡žä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™ã€‚
	> - é‡å†™çš„è¿‡ç¨‹æ€»ç»“ä¸º==â€œä¸€ä¸ªæ‹·è´ï¼Œä¸¤å¤„æ—¥å¿—â€==ã€‚
	> - â€œ==ä¸€ä¸ªæ‹·è´==â€å°±æ˜¯æŒ‡ï¼Œ==æ¯æ¬¡æ‰§è¡Œé‡å†™æ—¶ï¼Œä¸»çº¿ç¨‹ fork å‡ºåŽå°çš„ bgrewriteaof å­è¿›ç¨‹==ã€‚==fork ä¼šæŠŠä¸»çº¿ç¨‹çš„å†…å­˜æ‹·è´ä¸€ä»½ç»™ bgrewriteaof å­è¿›ç¨‹==ï¼Œè¿™é‡Œé¢å°±==åŒ…å«äº†æ•°æ®åº“çš„æœ€æ–°æ•°æ®==ã€‚
	> - â€œ==ä¸¤å¤„æ—¥å¿—==â€åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ
	> 	1. ==ä¸»çº¿ç¨‹æœªé˜»å¡žï¼Œä»ç„¶å¯ä»¥å¤„ç†æ–°æ¥çš„æ“ä½œ==ã€‚æ­¤æ—¶ï¼Œ==å¦‚æžœæœ‰å†™æ“ä½œ==ï¼Œç¬¬ä¸€å¤„æ—¥å¿—å°±æ˜¯æŒ‡æ­£åœ¨ä½¿ç”¨çš„ AOF æ—¥å¿—ï¼ŒRedis ==ä¼šæŠŠè¿™ä¸ªæ“ä½œå†™åˆ°å®ƒçš„ç¼“å†²åŒº==ã€‚
	> 	2. ç¬¬äºŒå¤„æ—¥å¿—ï¼Œå°±æ˜¯æŒ‡æ–°çš„ AOF é‡å†™æ—¥å¿—ã€‚==è¿™ä¸ªæ“ä½œä¹Ÿä¼šè¢«å†™åˆ°é‡å†™æ—¥å¿—çš„ç¼“å†²åŒºï¼ˆä¸»çº¿ç¨‹çš„ç¼“å†²åŒºå’Œé‡å†™æ—¥å¿—çš„ç¼“å†²åŒºä¸åŒï¼‰==ã€‚è¿™æ ·ï¼Œé‡å†™æ—¥å¿—ä¹Ÿä¸ä¼šä¸¢å¤±æœ€æ–°çš„æ“ä½œã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/6b054eb1aed0734bd81ddab9a31d0be8.jpg)
	> - æ¯æ¬¡ AOF ==é‡å†™æ—¶==ï¼ŒRedis ä¼š==å…ˆæ‰§è¡Œä¸€ä¸ªå†…å­˜æ‹·è´==ï¼Œç”¨äºŽé‡å†™ï¼›ç„¶åŽï¼Œä½¿ç”¨==ä¸¤ä¸ªæ—¥å¿—ä¿è¯åœ¨é‡å†™è¿‡ç¨‹ä¸­ï¼Œæ–°å†™å…¥çš„æ•°æ®ä¸ä¼šä¸¢å¤±==ã€‚è€Œä¸”ï¼Œå› ä¸º ==Redis é‡‡ç”¨é¢å¤–çš„çº¿ç¨‹è¿›è¡Œæ•°æ®é‡å†™==ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶==ä¸ä¼šé˜»å¡žä¸»çº¿ç¨‹==ã€‚

6. ä½¿ç”¨ ==AOF è¿›è¡Œæ•…éšœæ¢å¤æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦æŠŠæ‰€æœ‰çš„æ“ä½œè®°å½•éƒ½è¿è¡Œä¸€é==ã€‚æœ‰æ²¡æœ‰æ—¢èƒ½==é¿å…æ•°æ®ä¸¢å¤±ï¼Œåˆèƒ½æ›´å¿«åœ°æ¢å¤çš„æ–¹æ³•å‘¢==ï¼Ÿå½“ç„¶æœ‰ï¼Œé‚£å°±æ˜¯ ==RDB å¿«ç…§==äº†ã€‚

---



### 6.å†…å­˜å¿«ç…§ï¼šå®•æœºåŽï¼ŒRediså¦‚ä½•å®žçŽ°å¿«é€Ÿæ¢å¤ï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. ==RDB==

	> - å¯¹ Redis æ¥è¯´ï¼Œå®ƒå®žçŽ°ç±»ä¼¼ç…§ç‰‡è®°å½•æ•ˆæžœçš„æ–¹å¼ï¼Œå°±æ˜¯==æŠŠæŸä¸€æ—¶åˆ»çš„çŠ¶æ€ä»¥æ–‡ä»¶çš„å½¢å¼å†™åˆ°ç£ç›˜ä¸Š==ï¼Œä¹Ÿå°±æ˜¯==å¿«ç…§==ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿==å®•æœºï¼Œå¿«ç…§æ–‡ä»¶ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œæ•°æ®çš„å¯é æ€§ä¹Ÿå°±å¾—åˆ°äº†ä¿è¯==ã€‚è¿™ä¸ªå¿«ç…§æ–‡ä»¶å°±ç§°ä¸º RDB æ–‡ä»¶ï¼Œå…¶ä¸­ï¼Œ==RDB å°±æ˜¯ Redis DataBase çš„ç¼©å†™==ã€‚

2. ==ç»™å“ªäº›å†…å­˜æ•°æ®åšå¿«ç…§==ï¼Ÿ

	> - Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ save å’Œ bgsaveã€‚
	> 	- saveï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¼šå¯¼è‡´é˜»å¡žï¼›
	> 	- ==bgsaveï¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸“é—¨ç”¨äºŽå†™å…¥ RDB æ–‡ä»¶ï¼Œé¿å…äº†ä¸»çº¿ç¨‹çš„é˜»å¡ž==ï¼Œè¿™ä¹Ÿæ˜¯ Redis RDB æ–‡ä»¶ç”Ÿæˆçš„é»˜è®¤é…ç½®ã€‚

3. ==å¿«ç…§æ—¶æ•°æ®èƒ½ä¿®æ”¹å—==?

	> - Redis å°±ä¼šå€ŸåŠ©æ“ä½œç³»ç»Ÿæä¾›çš„==å†™æ—¶å¤åˆ¶æŠ€æœ¯==ï¼ˆCopy-On-Write, COWï¼‰ï¼Œ==åœ¨æ‰§è¡Œå¿«ç…§çš„åŒæ—¶ï¼Œæ­£å¸¸å¤„ç†å†™æ“ä½œ==ã€‚
	> - å¦‚æžœä¸»çº¿ç¨‹è¦==ä¿®æ”¹ä¸€å—æ•°æ®ï¼ˆä¾‹å¦‚å›¾ä¸­çš„é”®å€¼å¯¹ C==ï¼‰ï¼Œé‚£ä¹ˆï¼Œ==è¿™å—æ•°æ®å°±ä¼šè¢«å¤åˆ¶==ä¸€ä»½ï¼Œç”Ÿæˆè¯¥æ•°æ®çš„==å‰¯æœ¬ï¼ˆé”®å€¼å¯¹ Câ€™==ï¼‰ã€‚ç„¶åŽï¼Œä¸»çº¿ç¨‹==åœ¨è¿™ä¸ªæ•°æ®å‰¯æœ¬ä¸Šè¿›è¡Œä¿®æ”¹==ã€‚åŒæ—¶ï¼Œbgsave ==å­è¿›ç¨‹å¯ä»¥ç»§ç»­æŠŠåŽŸæ¥çš„æ•°æ®ï¼ˆé”®å€¼å¯¹ C==ï¼‰å†™å…¥ RDB æ–‡ä»¶ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/a2e5a3571e200cb771ed8a1cd14d5558.jpg)
	> - Redis ä¼šä½¿ç”¨ bgsave å¯¹å½“å‰å†…å­˜ä¸­çš„==æ‰€æœ‰æ•°æ®åšå¿«ç…§==ï¼Œè¿™ä¸ªæ“ä½œæ˜¯==å­è¿›ç¨‹åœ¨åŽå°å®Œæˆçš„==ï¼Œè¿™å°±==å…è®¸ä¸»çº¿ç¨‹åŒæ—¶å¯ä»¥ä¿®æ”¹æ•°æ®==ã€‚

4. ==å¤šä¹…åšä¸€æ¬¡å¿«ç…§==ï¼Ÿ

	> - ä¸¢å¤±æ•°æ®ï¼š
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/711c873a61bafde79b25c110735289ab.jpg)
	>
	> - ==å¦‚æžœé¢‘ç¹åœ°æ‰§è¡Œå…¨é‡å¿«ç…§ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸¤æ–¹é¢çš„å¼€é”€==ã€‚
	>
	> 	1. ä¸€æ–¹é¢ï¼Œé¢‘ç¹å°†å…¨é‡æ•°æ®å†™å…¥ç£ç›˜ï¼Œä¼š==ç»™ç£ç›˜å¸¦æ¥å¾ˆå¤§åŽ‹åŠ›==ï¼Œå¤šä¸ªå¿«ç…§ç«žäº‰æœ‰é™çš„ç£ç›˜å¸¦å®½ï¼Œå‰ä¸€ä¸ªå¿«ç…§è¿˜æ²¡æœ‰åšå®Œï¼ŒåŽä¸€ä¸ªåˆå¼€å§‹åšäº†ï¼Œå®¹æ˜“é€ æˆæ¶æ€§å¾ªçŽ¯ã€‚
	> 	2. å¦ä¸€æ–¹é¢ï¼Œ==bgsave å­è¿›ç¨‹éœ€è¦é€šè¿‡ fork æ“ä½œä»Žä¸»çº¿ç¨‹åˆ›å»ºå‡ºæ¥==ã€‚è™½ç„¶ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºåŽä¸ä¼šå†é˜»å¡žä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œ==fork è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹æœ¬èº«ä¼šé˜»å¡žä¸»çº¿ç¨‹==ï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„å†…å­˜è¶Šå¤§ï¼Œé˜»å¡žæ—¶é—´è¶Šé•¿ã€‚å¦‚æžœ==é¢‘ç¹ fork å‡º bgsave å­è¿›ç¨‹ï¼Œè¿™å°±ä¼šé¢‘ç¹é˜»å¡žä¸»çº¿ç¨‹äº†==ã€‚
	>
	> - Redis 4.0 ä¸­æå‡ºäº†ä¸€ä¸ªæ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§çš„æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œ==å†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘çŽ‡æ‰§è¡Œ==ï¼Œåœ¨==ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨ AOF æ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œ==ã€‚
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/e4c5846616c19fe03dbf528437beb320.jpg)

5. ==å°ç»“==ï¼šåªéœ€è¦==æŠŠ RDB æ–‡ä»¶ç›´æŽ¥è¯»å…¥å†…å­˜==ï¼Œè¿™å°±é¿å…äº† AOF éœ€è¦é¡ºåºã€é€ä¸€é‡æ–°æ‰§è¡Œæ“ä½œå‘½ä»¤å¸¦æ¥çš„ä½Žæ•ˆæ€§èƒ½é—®é¢˜ï¼ˆ==Redis åŠ è½½ RDB æ¢å¤æ•°æ®è¿œè¿œæ¯” åŠ è½½ AOF å¿«==ï¼‰ã€‚

6. å…³äºŽ ==AOF å’Œ RDB çš„é€‰æ‹©é—®é¢˜==ï¼Œæˆ‘æƒ³å†ç»™ä½ æä¸‰ç‚¹å»ºè®®ï¼š

	- æ•°æ®==ä¸èƒ½ä¸¢å¤±==æ—¶ï¼Œ==å†…å­˜å¿«ç…§å’Œ AOF çš„æ··åˆä½¿ç”¨ï¼ˆå¦‚ä¸Šä½¿ç”¨AOFæ—¥å¿—ï¼‰==æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼›
	- å¦‚æžœå…è®¸==åˆ†é’Ÿçº§åˆ«==çš„æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥==åªä½¿ç”¨ RDB==ï¼›
	- å¦‚æžœ==åªç”¨ AOF==ï¼Œä¼˜å…ˆä½¿ç”¨ ==everysec çš„é…ç½®é€‰é¡¹==ï¼Œå› ä¸ºå®ƒåœ¨å¯é æ€§å’Œæ€§èƒ½ä¹‹é—´å–äº†ä¸€ä¸ªå¹³è¡¡ã€‚

---



### 7.åŒæ­¥ï¼šä¸»ä»Žåº“å¦‚ä½•å®žçŽ°æ•°æ®ä¸€è‡´ï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. Redis æä¾›äº†==ä¸»ä»Žåº“æ¨¡å¼==ï¼Œä»¥ä¿è¯æ•°æ®å‰¯æœ¬çš„ä¸€è‡´ï¼Œä¸»ä»Žåº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯==è¯»å†™åˆ†ç¦»==çš„æ–¹å¼ã€‚

	> - ==è¯»æ“ä½œ==ï¼šä¸»åº“ã€ä»Žåº“==éƒ½å¯ä»¥æŽ¥æ”¶==ï¼›
	> - ==å†™æ“ä½œ==ï¼šé¦–==å…ˆåˆ°ä¸»åº“æ‰§è¡Œ==ï¼Œç„¶åŽï¼Œ==ä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»Žåº“==ã€‚
	>
	> ![å¾®ä¿¡æˆªå›¾_20240418154511](Redis.assets/å¾®ä¿¡æˆªå›¾_20240418154511.png)

2. ==ä¸»ä»Žåº“é—´å¦‚ä½•è¿›è¡Œç¬¬ä¸€æ¬¡åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶ï¼‰==ï¼Ÿ

  > - åœ¨==å®žä¾‹ 2 ä¸Šæ‰§è¡Œä»¥ä¸‹è¿™ä¸ªå‘½ä»¤åŽ==ï¼Œ==å®žä¾‹ 2 å°±å˜æˆäº†å®žä¾‹ 1 çš„ä»Žåº“==ï¼Œå¹¶ä»Žå®žä¾‹ 1 ä¸Šå¤åˆ¶æ•°æ®ï¼š
  >
  > 	```java
  > 	replicaof  172.16.19.3  6379 
  > 	```
  >
  > - ![å¾®ä¿¡æˆªå›¾_20240418160316](Redis.assets/å¾®ä¿¡æˆªå›¾_20240418160316.png)
  >
  > - ç¬¬ä¸€é˜¶æ®µæ˜¯ä¸»ä»Žåº“é—´å»ºç«‹è¿žæŽ¥ã€åå•†åŒæ­¥çš„è¿‡ç¨‹ï¼Œä¸»è¦æ˜¯ä¸ºå…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œ==ä»Žåº“å’Œä¸»åº“å»ºç«‹èµ·è¿žæŽ¥ï¼Œå¹¶å‘Šè¯‰ä¸»åº“å³å°†è¿›è¡ŒåŒæ­¥ï¼Œä¸»åº“ç¡®è®¤å›žå¤åŽï¼Œä¸»ä»Žåº“é—´å°±å¯ä»¥å¼€å§‹åŒæ­¥äº†==ã€‚
  >
  > 	- FULLRESYNC å“åº”è¡¨ç¤º==ç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨çš„å…¨é‡å¤åˆ¶==ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»åº“ä¼šæŠŠå½“å‰==æ‰€æœ‰çš„æ•°æ®==éƒ½å¤åˆ¶ç»™ä»Žåº“ã€‚
  >
  > - åœ¨ç¬¬äºŒé˜¶æ®µï¼Œ==ä¸»åº“å°†æ‰€æœ‰æ•°æ®åŒæ­¥ç»™ä»Žåº“ã€‚ä»Žåº“æ”¶åˆ°æ•°æ®åŽï¼Œåœ¨æœ¬åœ°å®Œæˆæ•°æ®åŠ è½½==ã€‚è¿™ä¸ªè¿‡ç¨‹==ä¾èµ–äºŽå†…å­˜å¿«ç…§ç”Ÿæˆçš„ RDB æ–‡ä»¶==ã€‚
  >
  >   - ä»Žåº“æŽ¥æ”¶åˆ° RDB æ–‡ä»¶åŽï¼Œä¼š==å…ˆæ¸…ç©ºå½“å‰æ•°æ®åº“ï¼ˆä»Žåº“åœ¨åŒæ­¥ä¸»åº“ä¹‹å‰ï¼Œå¯èƒ½ä¿å­˜äº†å…¶å®ƒæ•°æ®ï¼Œæ¸…ç©ºæ•°æ®åº“ä»¥é¿å…ä¹‹å‰æ•°æ®çš„å½±å“ï¼‰==ï¼Œç„¶åŽ==åŠ è½½ RDB æ–‡ä»¶==ã€‚
  >   - ==ä¸ºä»€ä¹ˆä¸»ä»Žåº“é—´çš„å¤åˆ¶ä¸ä½¿ç”¨ AOF==ï¼Ÿ
  >   	1. ==RDB æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶==ï¼Œæ— è®ºæ˜¯è¦æŠŠ RDB å†™å…¥ç£ç›˜ï¼Œè¿˜æ˜¯è¦é€šè¿‡ç½‘ç»œä¼ è¾“ RDBï¼ŒIO ==æ•ˆçŽ‡éƒ½æ¯”è®°å½•å’Œä¼ è¾“ AOF çš„é«˜==ã€‚
  >   	2. åœ¨==ä»Žåº“ç«¯è¿›è¡Œæ¢å¤æ—¶==ï¼Œç”¨ ==RDB çš„æ¢å¤æ•ˆçŽ‡è¦é«˜äºŽç”¨ AOF==ã€‚
  >
  > - åœ¨ä¸»åº“å°†æ•°æ®åŒæ­¥ç»™ä»Žåº“çš„è¿‡ç¨‹ä¸­ï¼Œ==ä¸»åº“ä¸ä¼šè¢«é˜»å¡žï¼Œä»ç„¶å¯ä»¥æ­£å¸¸æŽ¥æ”¶è¯·æ±‚==ã€‚
  >
  > 	- ä¸ºäº†==ä¿è¯ä¸»ä»Žåº“çš„æ•°æ®ä¸€è‡´æ€§==ï¼Œä¸»åº“ä¼šåœ¨å†…å­˜ä¸­ç”¨ä¸“é—¨çš„ ==replication buffer==ï¼Œè®°å½• ==RDB æ–‡ä»¶ç”ŸæˆåŽæ”¶åˆ°çš„æ‰€æœ‰å†™æ“ä½œ==ã€‚å½“ä¸»åº“å®Œæˆ RDB æ–‡ä»¶å‘é€åŽï¼Œå°±ä¼šæŠŠæ­¤æ—¶ replication buffer ä¸­çš„ä¿®æ”¹æ“ä½œå‘ç»™ä»Žåº“

3. ==ä¸»ä»Žçº§è”æ¨¡å¼åˆ†æ‹…å…¨é‡å¤åˆ¶æ—¶çš„ä¸»åº“åŽ‹åŠ›ï¼ˆåŸºäºŽé•¿è¿žæŽ¥çš„å‘½ä»¤ä¼ æ’­ï¼‰==

	> - å¯ä»¥==é€šè¿‡â€œä¸» â€“ ä»Ž â€“ ä»Žâ€æ¨¡å¼å°†ä¸»åº“ç”Ÿæˆ RDB å’Œä¼ è¾“ RDB çš„åŽ‹åŠ›ï¼Œä»¥çº§è”çš„æ–¹å¼åˆ†æ•£åˆ°ä»Žåº“ä¸Š==ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/403c2ab725dca8d44439f8994959af45.jpg)
	> - é€šè¿‡â€œä¸»-ä»Ž-ä»Žâ€çš„æ–¹å¼ï¼Œ==ä¸»åº“ä¸éœ€è¦å¯¹æ‰€æœ‰ä»Žåº“==è¿›è¡Œ==RDBç”Ÿæˆå’ŒRDBä¼ è¾“==è¿™ä¸¤ä¸ªå¯èƒ½å¼•èµ·ä¸»åº“é˜»å¡žçš„æ“ä½œï¼Œè€Œæ˜¯==åªéœ€è¦å¯¹â€œä¸€çº§ä»Žåº“â€è¿›è¡Œè¿™ä¸¤ä¸ªæ“ä½œ==ï¼Œç„¶åŽ==ç”±è¿™äº›ä»Žåº“åœ¨å‘å…¶å®ƒä»Žåº“==è¿›è¡Œç›¸åŒçš„æ“ä½œã€‚è¿™æ ·==å¤§å¤§å‡å°‘äº†ä¸»åº“åŽ‹åŠ›==ã€‚
	> - ==ä¸»ä»Žè”çº§çš„é£Žé™©==ï¼šæœ€å¸¸è§çš„å°±æ˜¯==ç½‘ç»œæ–­è¿žæˆ–é˜»å¡ž==ã€‚å¦‚æžœç½‘ç»œæ–­è¿žï¼Œä¸»ä»Žåº“ä¹‹é—´å°±æ— æ³•è¿›è¡Œå‘½ä»¤ä¼ æ’­äº†ï¼Œ==ä»Žåº“çš„æ•°æ®è‡ªç„¶ä¹Ÿå°±æ²¡åŠžæ³•å’Œä¸»åº“ä¿æŒä¸€è‡´äº†==ï¼Œå®¢æˆ·ç«¯å°±å¯èƒ½==ä»Žä»Žåº“è¯»åˆ°æ—§æ•°æ®==ã€‚

4. ==ä¸»ä»Žåº“é—´ç½‘ç»œæ–­äº†æ€Žä¹ˆåŠžï¼ˆå¢žé‡å¤åˆ¶ï¼‰==ï¼Ÿ

	> - ==å¢žé‡å¤åˆ¶==æ—¶ï¼Œä¸»ä»Žåº“ä¹‹é—´å…·ä½“æ˜¯æ€Žä¹ˆä¿æŒåŒæ­¥çš„å‘¢ï¼Ÿè¿™é‡Œçš„å¥¥å¦™å°±åœ¨äºŽ ==repl_backlog_buffer== è¿™ä¸ªç¼“å†²åŒºã€‚==repl_backlog_buffer æ˜¯ä¸€ä¸ªçŽ¯å½¢ç¼“å†²åŒº==ï¼Œ==ä¸»åº“ä¼šè®°å½•è‡ªå·±å†™åˆ°çš„ä½ç½®ï¼Œä»Žåº“åˆ™ä¼šè®°å½•è‡ªå·±å·²ç»è¯»åˆ°çš„ä½ç½®==ã€‚
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/13f26570a1b90549e6171ea24554b737.jpg)
	>
	> - ä¸»ä»Žåº“çš„==è¿žæŽ¥æ¢å¤ä¹‹åŽ==ï¼Œ==ä»Žåº“æŠŠè‡ªå·±å½“å‰çš„ slave_repl_offset å‘ç»™ä¸»åº“==ï¼Œæ­¤æ—¶ï¼Œä¸»åº“åªç”¨æŠŠ ==master_repl_offset å’Œ slave_repl_offset ä¹‹é—´çš„å‘½ä»¤æ“ä½œ==åŒæ­¥ç»™ä»Žåº“ã€‚
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/20e233bd30c3dacb0221yy0c77780b16.jpg)
	>
	> - ==å¦‚æžœä»Žåº“çš„è¯»å–é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ä»Žåº“è¿˜æœªè¯»å–çš„æ“ä½œè¢«ä¸»åº“æ–°å†™çš„æ“ä½œè¦†ç›–äº†ï¼Œè¿™ä¼šå¯¼è‡´ä¸»ä»Žåº“é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼ˆä¸ä¸€è‡´å°±ä¼šå¯¼è‡´ä¸»ä»Žé‡æ–°è¿›è¡Œå…¨é‡å¤åˆ¶ï¼‰==ã€‚
	>
	> 	- è°ƒæ•´ ==repl_backlog_size== è¿™ä¸ªå‚æ•°
	> 	- å¯ä»¥è€ƒè™‘ä½¿ç”¨==åˆ‡ç‰‡é›†ç¾¤æ¥åˆ†æ‹…å•ä¸ªä¸»åº“çš„è¯·æ±‚åŽ‹åŠ›==

5. ==å°ç»“==ï¼š

	> - ä¸»ä»ŽåŒæ­¥æœ‰ä¸‰ç§æ¨¡å¼ï¼š==å…¨é‡å¤åˆ¶ã€åŸºäºŽé•¿è¿žæŽ¥çš„å‘½ä»¤ä¼ æ’­ï¼Œä»¥åŠå¢žé‡å¤åˆ¶==ã€‚
	> - ==ä¸»åº“æ•…éšœäº†ä»Žåº“è¯¥æ€Žä¹ˆåŠž==ï¼Œæ•°æ®è¿˜èƒ½ä¿æŒä¸€è‡´å—ï¼ŒRedis è¿˜èƒ½æ­£å¸¸æä¾›æœåŠ¡å—ï¼Ÿ

---



### 8.å“¨å…µæœºåˆ¶ï¼šä¸»åº“æŒ‚äº†ï¼Œå¦‚ä½•ä¸é—´æ–­æœåŠ¡ï¼ŸðŸŒŸðŸŒŸðŸŒŸ

1. ==å“¨å…µ==å…¶å®žå°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ ==Redis è¿›ç¨‹==ï¼Œ==ä¸»ä»Žåº“å®žä¾‹è¿è¡Œçš„åŒæ—¶ï¼Œå®ƒä¹Ÿåœ¨è¿==è¡Œã€‚å“¨å…µä¸»è¦è´Ÿè´£çš„å°±æ˜¯ä¸‰ä¸ªä»»åŠ¡ï¼š==ç›‘æŽ§ã€é€‰æ‹©ä¸»åº“ å’Œé€šçŸ¥==ã€‚

2. åœ¨ Redis ä¸»ä»Žé›†ç¾¤ä¸­ï¼Œ==å“¨å…µæœºåˆ¶æ˜¯å®žçŽ°ä¸»ä»Žåº“è‡ªåŠ¨åˆ‡æ¢çš„å…³é”®æœºåˆ¶==ã€‚

3. ==å“¨å…µæœºåˆ¶çš„åŸºæœ¬æµç¨‹==

	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/efcfa517d0f09d057be7da32a84cf2a1.jpg)
	> - åœ¨ç›‘æŽ§ä»»åŠ¡ä¸­ï¼Œå“¨å…µéœ€è¦==åˆ¤æ–­ä¸»åº“æ˜¯å¦å¤„äºŽä¸‹çº¿çŠ¶æ€==ï¼›
	> - åœ¨é€‰ä¸»ä»»åŠ¡ä¸­ï¼Œå“¨å…µä¹Ÿè¦å†³å®š==é€‰æ‹©å“ªä¸ªä»Žåº“å®žä¾‹ä½œä¸ºä¸»åº“==ã€‚

4. ==ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿==

	> - å“¨å…µè¿›ç¨‹ä¼š==ä½¿ç”¨ PING å‘½ä»¤æ£€æµ‹å®ƒè‡ªå·±å’Œä¸»ã€ä»Žåº“çš„ç½‘ç»œè¿žæŽ¥æƒ…å†µ==ï¼Œå‘çŽ°==ä¸»åº“æˆ–ä»Žåº“å¯¹ PING å‘½ä»¤çš„å“åº”è¶…æ—¶äº†==ï¼Œé‚£ä¹ˆï¼Œå“¨å…µå°±ä¼šå…ˆæŠŠå®ƒæ ‡è®°ä¸ºâ€œ==ä¸»è§‚ä¸‹çº¿==â€ã€‚
	> - ==è¯¯åˆ¤==ä¸€èˆ¬ä¼šå‘ç”Ÿåœ¨==é›†ç¾¤ç½‘ç»œåŽ‹åŠ›è¾ƒå¤§==ã€==ç½‘ç»œæ‹¥å¡ž==ï¼Œæˆ–è€…æ˜¯==ä¸»åº“æœ¬èº«åŽ‹åŠ›è¾ƒå¤§==çš„æƒ…å†µä¸‹ã€‚
	> - å“¨å…µæœºåˆ¶==é€šå¸¸ä¼šé‡‡ç”¨å¤šå®žä¾‹ç»„æˆçš„é›†ç¾¤æ¨¡å¼è¿›è¡Œéƒ¨ç½²ï¼Œè¿™ä¹Ÿè¢«ç§°ä¸ºå“¨å…µé›†ç¾¤==ã€‚
	> - åœ¨åˆ¤æ–­ä¸»åº“æ˜¯å¦ä¸‹çº¿æ—¶ï¼Œä¸èƒ½ç”±ä¸€ä¸ªå“¨å…µè¯´äº†ç®—ï¼Œåªæœ‰==å¤§å¤šæ•°çš„å“¨å…µå®žä¾‹ï¼Œéƒ½åˆ¤æ–­ä¸»åº“å·²ç»â€œä¸»è§‚ä¸‹çº¿â€äº†ï¼ˆå°‘æ•°æœä»Žå¤šæ•°ï¼‰==ï¼Œä¸»åº“æ‰ä¼šè¢«æ ‡è®°ä¸ºâ€œ==å®¢è§‚ä¸‹çº¿==â€ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/1945703abf16ee14e2f7559873e4e60d.jpg)

5. ==å¦‚ä½•é€‰å®šæ–°ä¸»åº“==ï¼Ÿ

	> - ==ç­›é€‰ + æ‰“åˆ†==
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/f2e9b8830db46d959daa6a39fbf4a14c.jpg)
	>
	> - ==ç­›é€‰==ï¼š
	>
	> 	- è¦å…ˆä¿è¯æ‰€é€‰çš„ä»Žåº“ä»ç„¶==åœ¨çº¿è¿è¡Œ==ã€‚
	> 	- è¿˜è¦åˆ¤æ–­å®ƒä¹‹å‰çš„==ç½‘ç»œè¿žæŽ¥çŠ¶æ€==ã€‚é…ç½®é¡¹ ==down-after-milliseconds * 10==ã€‚down-after-milliseconds æ˜¯æˆ‘ä»¬è®¤å®š==ä¸»ä»Žåº“æ–­è¿žçš„æœ€å¤§è¿žæŽ¥è¶…æ—¶æ—¶é—´==ï¼Œå‘ç”Ÿ==æ–­è¿žçš„æ¬¡æ•°è¶…è¿‡äº† 10 æ¬¡==ï¼Œå°±è¯´æ˜Žè¿™ä¸ª==ä»Žåº“çš„ç½‘ç»œçŠ¶å†µä¸å¥½==ã€‚
	>
	> - ==æ‰“åˆ†==ï¼š
	>
	> 	1. ==ä¼˜å…ˆçº§æœ€é«˜çš„ä»Žåº“å¾—åˆ†é«˜==ã€‚
	> 		- ==slave-priority== é…ç½®é¡¹ã€‚
	> 	2. ==å’Œæ—§ä¸»åº“åŒæ­¥ç¨‹åº¦æœ€æŽ¥è¿‘çš„ä»Žåº“å¾—åˆ†é«˜==ã€‚
	> 		- ==å¦‚ä½•åˆ¤æ–­==ä»Žåº“å’Œæ—§ä¸»åº“é—´çš„==åŒæ­¥è¿›åº¦==å‘¢ï¼Ÿ==ä»Žåº“çš„ slave_repl_offset æœ€æŽ¥è¿‘master_repl_offset==ï¼Œé‚£ä¹ˆå®ƒçš„å¾—åˆ†å°±æœ€é«˜ï¼Œå¯ä»¥ä½œä¸ºæ–°ä¸»åº“ã€‚
	> 		- ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/626yy88853a2d15b5196b922367140df.jpg)
	> 	3. ==ID å·å°çš„ä»Žåº“å¾—åˆ†é«˜==ã€‚
	> 		- ==åœ¨ä¼˜å…ˆçº§å’Œå¤åˆ¶è¿›åº¦éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒID å·æœ€å°çš„ä»Žåº“å¾—åˆ†æœ€é«˜ï¼Œä¼šè¢«é€‰ä¸ºæ–°ä¸»åº“==
	>
	> - å“¨å…µä¼šæŒ‰ç…§==åœ¨çº¿çŠ¶æ€==ã€==ç½‘ç»œçŠ¶æ€==ï¼Œ==ç­›é€‰==è¿‡æ»¤æŽ‰ä¸€éƒ¨åˆ†==ä¸ç¬¦åˆè¦æ±‚çš„ä»Žåº“==ï¼Œç„¶åŽï¼Œä¾æ¬¡æŒ‰ç…§==ä¼˜å…ˆçº§==ã€==å¤åˆ¶è¿›åº¦==ã€==ID å·å¤§å°==å†å¯¹å‰©ä½™çš„ä»Žåº“è¿›è¡Œæ‰“åˆ†ï¼Œåªè¦æœ‰å¾—åˆ†æœ€é«˜çš„ä»Žåº“å‡ºçŽ°ï¼Œå°±æŠŠå®ƒé€‰ä¸ºæ–°ä¸»åº“ã€‚

---



### 9.å“¨å…µé›†ç¾¤ï¼šå“¨å…µæŒ‚äº†ï¼Œä¸»ä»Žåº“è¿˜èƒ½åˆ‡æ¢å—ï¼ŸðŸŒŸðŸŒŸðŸŒŸ

1. ==åŸºäºŽ publish/subscribe æœºåˆ¶çš„å“¨å…µé›†ç¾¤ç»„æˆ==

	> - ==å“¨å…µå®žä¾‹ä¹‹é—´==å¯ä»¥==ç›¸äº’å‘çŽ°==ï¼Œè¦å½’åŠŸäºŽ Redis æä¾›çš„ pub/sub æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯==å‘å¸ƒ / è®¢é˜…æœºåˆ¶==ã€‚
	> - ==å“¨å…µåªè¦å’Œä¸»åº“å»ºç«‹èµ·äº†è¿žæŽ¥ï¼Œå°±å¯ä»¥åœ¨ä¸»åº“ä¸Šå‘å¸ƒæ¶ˆæ¯äº†==ï¼Œæ¯”å¦‚è¯´==å‘å¸ƒå®ƒè‡ªå·±çš„è¿žæŽ¥ä¿¡æ¯==ï¼ˆIP å’Œç«¯å£ï¼‰ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥ä»Žä¸»åº“ä¸Š==è®¢é˜…æ¶ˆæ¯ï¼ŒèŽ·å¾—å…¶ä»–å“¨å…µå‘å¸ƒçš„è¿žæŽ¥ä¿¡æ¯==ã€‚å½“å¤šä¸ªå“¨å…µå®žä¾‹éƒ½åœ¨ä¸»åº“ä¸Šåšäº†å‘å¸ƒå’Œè®¢é˜…æ“ä½œåŽï¼Œ==å®ƒä»¬ä¹‹é—´å°±èƒ½çŸ¥é“å½¼æ­¤çš„ IP åœ°å€å’Œç«¯å£==ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/ca42698128aa4c8a374efbc575ea22b1.jpg)
	> - ==å“¨å…µæ˜¯å¦‚ä½•çŸ¥é“ä»Žåº“çš„ IP åœ°å€å’Œç«¯å£çš„å‘¢ï¼Ÿ==
	> 	- ==å“¨å…µå‘ä¸»åº“å‘é€ INFO å‘½ä»¤==æ¥å®Œæˆçš„ã€‚ä¸»åº“æŽ¥å—åˆ°è¿™ä¸ªå‘½ä»¤åŽï¼Œå°±ä¼š==æŠŠä»Žåº“åˆ—è¡¨è¿”å›žç»™å“¨å…µ==ã€‚
	> 	- å“¨å…µå°±å¯ä»¥æ ¹æ®ä»Žåº“åˆ—è¡¨ä¸­çš„è¿žæŽ¥ä¿¡æ¯ï¼Œ==å’Œæ¯ä¸ªä»Žåº“å»ºç«‹è¿žæŽ¥==ï¼Œè¿›è¡Œç›‘æŽ§å’Œé€šçŸ¥ã€‚
	> 	- ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/88fdc68eb94c44efbdf7357260091de0.jpg)

2. ==åŸºäºŽ pub/sub æœºåˆ¶çš„å®¢æˆ·ç«¯äº‹ä»¶é€šçŸ¥==

	> - å“¨å…µå°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹å®šæ¨¡å¼ä¸‹çš„ ==Redis å®žä¾‹==ï¼Œæ‰€ä»¥ï¼Œ==æ¯ä¸ªå“¨å…µå®žä¾‹ä¹Ÿæä¾› pub/sub æœºåˆ¶==ï¼Œ==å®¢æˆ·ç«¯å¯ä»¥ä»Žå“¨å…µè®¢é˜…æ¶ˆæ¯==ã€‚
	>
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/4e9665694a9565abbce1a63cf111f725.jpg)
	>
	> - å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ¥è®¢é˜…â€œæ‰€æœ‰å®žä¾‹è¿›å…¥å®¢è§‚ä¸‹çº¿çŠ¶æ€çš„äº‹ä»¶â€ï¼š
	>
	> 	```java
	> 	SUBSCRIBE +odown
	> 	```
	>
	> 	å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè®¢é˜…æ‰€æœ‰çš„äº‹ä»¶ï¼š
	>
	> 	```java
	> 	PSUBSCRIBE  *
	> 	```

3. ==ç”±å“ªä¸ªå“¨å…µæ‰§è¡Œä¸»ä»Žåˆ‡æ¢==ï¼Ÿ

	> - ä»»ä½•ä¸€ä¸ªå®žä¾‹åªè¦è‡ªèº«åˆ¤æ–­ä¸»åº“â€œä¸»è§‚ä¸‹çº¿â€åŽï¼Œå°±ä¼š==ç»™å…¶ä»–å®žä¾‹å‘é€ is-master-down-by-addr å‘½ä»¤==ã€‚æŽ¥ç€ï¼Œå…¶ä»–å®žä¾‹ä¼šæ ¹æ®è‡ªå·±å’Œä¸»åº“çš„è¿žæŽ¥æƒ…å†µï¼Œåšå‡º Y æˆ– N çš„å“åº”ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/e0832d432c14c98066a94e0ef86af384.jpg)
	> - ==æ‰€éœ€çš„èµžæˆç¥¨æ•°==æ˜¯é€šè¿‡==å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹==è®¾å®šçš„ã€‚
	> - è¿™ä¸ªå“¨å…µå°±å¯ä»¥å†==ç»™å…¶ä»–å“¨å…µå‘é€å‘½ä»¤ï¼Œè¡¨æ˜Žå¸Œæœ›ç”±è‡ªå·±æ¥æ‰§è¡Œä¸»ä»Žåˆ‡æ¢==ï¼Œå¹¶è®©æ‰€æœ‰å…¶ä»–å“¨å…µè¿›è¡ŒæŠ•ç¥¨ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/5f6ceeb9337e158cc759e23c0f375fd9.jpg)
	> - å¦‚æžœ S3 æ²¡æœ‰æ‹¿åˆ° 2 ç¥¨ Yï¼Œé‚£ä¹ˆ==è¿™è½®æŠ•ç¥¨å°±ä¸ä¼šäº§ç”Ÿ Leader==ã€‚å“¨å…µé›†ç¾¤ä¼š==ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆä¹Ÿå°±æ˜¯å“¨å…µæ•…éšœè½¬ç§»è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå†é‡æ–°é€‰ä¸¾==ã€‚è¿™æ˜¯å› ä¸ºï¼Œå“¨å…µé›†ç¾¤èƒ½å¤Ÿè¿›è¡Œ==æˆåŠŸæŠ•ç¥¨ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºŽé€‰ä¸¾å‘½ä»¤çš„æ­£å¸¸ç½‘ç»œä¼ æ’­==ã€‚å¦‚æžœ==ç½‘ç»œåŽ‹åŠ›è¾ƒå¤§æˆ–æœ‰çŸ­æ—¶å µå¡žï¼Œå°±å¯èƒ½å¯¼è‡´æ²¡æœ‰ä¸€ä¸ªå“¨å…µèƒ½æ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµžæˆç¥¨==ã€‚æ‰€ä»¥ï¼Œç­‰åˆ°==ç½‘ç»œæ‹¥å¡žå¥½è½¬ä¹‹åŽï¼Œå†è¿›è¡ŒæŠ•ç¥¨é€‰ä¸¾ï¼ŒæˆåŠŸçš„æ¦‚çŽ‡å°±ä¼šå¢žåŠ ==ã€‚
	> - å¦‚æžœ==å“¨å…µé›†ç¾¤åªæœ‰ 2 ä¸ªå®žä¾‹==ï¼Œæ­¤æ—¶ï¼Œä¸€ä¸ªå“¨å…µè¦æƒ³æˆä¸º ==Leaderï¼Œå¿…é¡»èŽ·å¾— 2 ç¥¨ï¼Œè€Œä¸æ˜¯ 1 ç¥¨==ã€‚æ‰€ä»¥ï¼Œå¦‚æžœï¼ˆ==2ä¸ªä¹‹ä¸­ï¼‰æœ‰ä¸ªå“¨å…µæŒ‚æŽ‰äº†==ï¼Œé‚£ä¹ˆï¼Œæ­¤æ—¶çš„é›†ç¾¤æ˜¯==æ— æ³•è¿›è¡Œä¸»ä»Žåº“åˆ‡æ¢==çš„ã€‚å› æ­¤ï¼Œé€šå¸¸æˆ‘ä»¬==è‡³å°‘ä¼šé…ç½® 3 ä¸ªå“¨å…µå®žä¾‹==ã€‚

---



### 10.åˆ‡ç‰‡é›†ç¾¤ï¼šæ•°æ®å¢žå¤šäº†ï¼Œæ˜¯è¯¥åŠ å†…å­˜è¿˜æ˜¯åŠ å®žä¾‹ï¼ŸðŸŒŸðŸŒŸðŸŒŸ

1. åˆ‡ç‰‡é›†ç¾¤ï¼Œä¹Ÿå«åˆ†ç‰‡é›†ç¾¤ï¼Œå°±æ˜¯æŒ‡==å¯åŠ¨å¤šä¸ª Redis å®žä¾‹ç»„æˆä¸€ä¸ªé›†ç¾¤==ï¼Œç„¶åŽæŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼ŒæŠŠæ”¶åˆ°çš„æ•°æ®åˆ’åˆ†æˆå¤šä»½ï¼Œæ¯ä¸€ä»½ç”¨ä¸€ä¸ªå®žä¾‹æ¥ä¿å­˜ã€‚

	> ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/793251ca784yyf6ac37fe46389094b26.jpg)

2. ==çºµå‘ä¼¸å±• vs æ¨ªå‘ä¼¸å±•==

	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/7a512fec7eba789c6d098b834929701a.jpg)
	> - å½“ä½¿ç”¨ RDB å¯¹æ•°æ®è¿›è¡Œ==æŒä¹…åŒ–æ—¶==ï¼Œå¦‚æžœ==æ•°æ®é‡å¢žåŠ ï¼Œéœ€è¦çš„å†…å­˜ä¹Ÿä¼šå¢žåŠ ==ï¼Œä¸»çº¿ç¨‹ ==fork å­è¿›ç¨‹æ—¶å°±å¯èƒ½ä¼šé˜»å¡ž==ã€‚

3. ==æ•°æ®åˆ‡ç‰‡å’Œå®žä¾‹çš„å¯¹åº”åˆ†å¸ƒå…³ç³»==

	> - ==Redis Cluster æ–¹æ¡ˆé‡‡ç”¨å“ˆå¸Œæ§½==ï¼ˆHash Slotï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä¼šç›´æŽ¥ç§°ä¹‹ä¸º ==Slot==ï¼‰ï¼Œæ¥å¤„ç†==æ•°æ®å’Œå®žä¾‹==ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚
	> - åœ¨ Redis Cluster æ–¹æ¡ˆä¸­ï¼Œ==ä¸€ä¸ªåˆ‡ç‰‡é›†ç¾¤å…±æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½==ï¼Œè¿™äº›å“ˆå¸Œæ§½ç±»ä¼¼äºŽæ•°æ®åˆ†åŒºï¼Œæ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šæ ¹æ®å®ƒçš„ keyï¼Œè¢«æ˜ å°„åˆ°ä¸€ä¸ªå“ˆå¸Œæ§½ä¸­ã€‚
	> - å¦‚æžœ==é›†ç¾¤ä¸­æœ‰ N ä¸ªå®žä¾‹==ï¼Œé‚£ä¹ˆï¼Œ==æ¯ä¸ªå®žä¾‹ä¸Šçš„æ§½ä¸ªæ•°==ä¸º ==16384/N== ä¸ªã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/7d070c8b19730b308bfaabbe82c2f1ab.jpg)

4. ==å®¢æˆ·ç«¯å¦‚ä½•å®šä½æ•°æ®ï¼Ÿ==

	> - ==Redis å®žä¾‹ä¼šæŠŠè‡ªå·±çš„å“ˆå¸Œæ§½ä¿¡æ¯å‘ç»™å’Œå®ƒç›¸è¿žæŽ¥çš„å…¶å®ƒå®žä¾‹==ï¼Œæ¥å®Œæˆ==å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯çš„æ‰©æ•£==ï¼ŒäºŽæ˜¯ï¼Œ==æ¯ä¸ªå®žä¾‹å°±æœ‰æ‰€æœ‰å“ˆå¸Œæ§½çš„æ˜ å°„å…³ç³»==äº†ã€‚
	> - å®¢æˆ·ç«¯åœ¨è®¿é—®==ä»»ä½•ä¸€ä¸ªRediså®žä¾‹==æ—¶ï¼Œéƒ½å¯ä»¥å¾—åˆ°==æ‰€æœ‰å“ˆå¸Œæ§½çš„åˆ†é…æƒ…å†µ==ã€‚

5. ==å®žä¾‹å’Œå“ˆå¸Œæ§½çš„å¯¹åº”å…³ç³»æ”¹å˜==åŽï¼Œé€šè¿‡ ==é‡å®šå‘==ï¼Œ==å®¢æˆ·ç«¯è®¿é—®æŒæœ‰èµ„æºçš„å®žä¾‹==

	> - å½“å®¢æˆ·ç«¯æŠŠä¸€ä¸ªé”®å€¼å¯¹çš„æ“ä½œ==è¯·æ±‚å‘ç»™ä¸€ä¸ªå®žä¾‹==æ—¶ï¼Œå¦‚æžœè¿™ä¸ªå®žä¾‹ä¸Šå¹¶==æ²¡æœ‰è¿™ä¸ªé”®å€¼å¯¹æ˜ å°„çš„å“ˆå¸Œæ§½==ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªå®žä¾‹å°±ä¼š==ç»™å®¢æˆ·ç«¯è¿”å›žä¸‹é¢çš„ MOVED å‘½ä»¤å“åº”ç»“æžœ==ï¼ŒåŒ…å«äº†æ–°å®žä¾‹çš„è®¿é—®åœ°å€ã€‚
	>
	> 	```java
	> 	GET hello:key
	> 	(error) MOVED 13320 172.16.19.5:6379
	> 	```
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/350abedefcdbc39d6a8a8f1874eb0809.jpg)

6. ==ä¸ºä»€ä¹ˆ Redis ä¸ç›´æŽ¥ç”¨ä¸€ä¸ªè¡¨ï¼ŒæŠŠé”®å€¼å¯¹å’Œå®žä¾‹çš„å¯¹åº”å…³ç³»è®°å½•ä¸‹æ¥ï¼Ÿ==

	> - ä¸€æ—¦é”®å€¼å¯¹å’Œå®žä¾‹çš„å¯¹åº”å…³ç³»å‘ç”Ÿäº†å˜åŒ–ï¼ˆä¾‹å¦‚å®žä¾‹æœ‰å¢žå‡æˆ–è€…æ•°æ®é‡æ–°åˆ†å¸ƒï¼‰ï¼Œå°±è¦==ä¿®æ”¹è¡¨==ã€‚å¦‚æžœæ˜¯==å•çº¿ç¨‹==æ“ä½œè¡¨ï¼Œé‚£ä¹ˆæ‰€æœ‰æ“ä½œéƒ½è¦==ä¸²è¡Œæ‰§è¡Œ==ï¼Œ==æ€§èƒ½æ…¢==ï¼›å¦‚æžœæ˜¯==å¤šçº¿ç¨‹==æ“ä½œè¡¨ï¼Œå°±æ¶‰åŠåˆ°==åŠ é”å¼€é”€==ã€‚æ­¤å¤–ï¼Œå¦‚æžœ==æ•°æ®é‡éžå¸¸å¤§==ï¼Œéœ€è¦çš„==é¢å¤–å­˜å‚¨ç©ºé—´==ä¹Ÿä¼šå¢žåŠ ã€‚
	> - åŸºäºŽå“ˆå¸Œæ§½è®¡ç®—æ—¶ï¼Œè™½ç„¶ä¹Ÿè¦è®°å½•å“ˆå¸Œæ§½å’Œå®žä¾‹çš„å¯¹åº”å…³ç³»ï¼Œä½†æ˜¯==å“ˆå¸Œæ§½çš„ä¸ªæ•°è¦æ¯”é”®å€¼å¯¹çš„ä¸ªæ•°å°‘å¾ˆå¤š==ï¼Œæ— è®ºæ˜¯ä¿®æ”¹å“ˆå¸Œæ§½å’Œå®žä¾‹reçš„å¯¹åº”å…³ç³»ï¼Œè¿˜æ˜¯ä½¿ç”¨é¢å¤–ç©ºé—´å­˜å‚¨å“ˆå¸Œæ§½å’Œå®žä¾‹çš„å¯¹åº”å…³ç³»ï¼Œéƒ½==æ¯”ç›´æŽ¥è®°å½•é”®å€¼å¯¹å’Œå®žä¾‹çš„å…³ç³»çš„å¼€é”€å°å¾—å¤š==ã€‚

---



### 12.â€œä¸‡é‡‘æ²¹â€çš„Stringï¼Œä¸ºä»€ä¹ˆä¸å¥½ç”¨äº†ï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. String ç±»åž‹å¹¶ä¸æ˜¯é€‚ç”¨äºŽæ‰€æœ‰åœºåˆçš„ï¼Œå®ƒæœ‰ä¸€ä¸ªæ˜Žæ˜¾çš„çŸ­æ¿ï¼Œå°±æ˜¯==å®ƒä¿å­˜æ•°æ®æ—¶æ‰€æ¶ˆè€—çš„å†…å­˜ç©ºé—´è¾ƒå¤š==ã€‚

2. ==ä¸ºä»€ä¹ˆ String ç±»åž‹å†…å­˜å¼€é”€å¤§==ï¼Ÿ

	> - é™¤äº†è®°å½•å®žé™…æ•°æ®ï¼Œ==String ç±»åž‹è¿˜éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´è®°å½•æ•°æ®é•¿åº¦ã€ç©ºé—´ä½¿ç”¨ç­‰ä¿¡æ¯==ï¼Œè¿™äº›ä¿¡æ¯ä¹Ÿå«ä½œå…ƒæ•°æ®ã€‚å½“å®žé™…ä¿å­˜çš„æ•°æ®è¾ƒå°æ—¶ï¼Œå…ƒæ•°æ®çš„ç©ºé—´å¼€é”€å°±æ˜¾å¾—æ¯”è¾ƒå¤§äº†ã€‚
	>
	> 	ä¸‹å›¾ä¸º==ç®€å•åŠ¨æ€å­—ç¬¦ä¸²==ï¼ˆSimple Dynamic Stringï¼Œ==SDS==ï¼‰ç»“æž„ä½“
	>
	> 	<img src="https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/37c6a8d5abd65906368e7c4a6b938657.jpg" alt="img" style="zoom: 25%;" />
	>
	> - Redis çš„æ•°æ®ç±»åž‹æœ‰å¾ˆå¤šï¼Œè€Œä¸”ï¼Œ==ä¸åŒæ•°æ®ç±»åž‹éƒ½æœ‰äº›ç›¸åŒçš„å…ƒæ•°æ®è¦è®°å½•==ï¼ˆæ¯”å¦‚==æœ€åŽä¸€æ¬¡è®¿é—®çš„æ—¶é—´ã€è¢«å¼•ç”¨çš„æ¬¡æ•°==ç­‰ï¼‰ï¼Œæ‰€ä»¥ï¼Œ==Redis ä¼šç”¨ä¸€ä¸ª RedisObject ç»“æž„ä½“æ¥ç»Ÿä¸€è®°å½•è¿™äº›å…ƒæ•°æ®==ï¼ŒåŒæ—¶==æŒ‡å‘å®žé™…æ•°æ®==ã€‚
	>
	> 	<img src="https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/3409948e9d3e8aa5cd7cafb9b66c2857.jpg" alt="img" style="zoom:25%;" />
	>
	> - Redis è¿˜å¯¹ ==Long ç±»åž‹æ•´æ•°==å’Œ ==SDS çš„å†…å­˜å¸ƒå±€==çš„==ä¼˜åŒ–==
	>
	> 	1. å½“ä¿å­˜çš„æ˜¯ Long ç±»åž‹æ•´æ•°æ—¶ï¼ŒRedisObject ä¸­çš„==æŒ‡é’ˆå°±ç›´æŽ¥èµ‹å€¼ä¸ºæ•´æ•°æ•°æ®äº†ï¼ˆéƒ½æ˜¯8å­—èŠ‚ï¼‰==ï¼Œè¿™æ ·å°±ä¸ç”¨é¢å¤–çš„æŒ‡é’ˆå†æŒ‡å‘æ•´æ•°äº†ï¼ŒèŠ‚çœäº†æŒ‡é’ˆçš„ç©ºé—´å¼€é”€ã€‚
	>
	> 	2. å½“ä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²æ•°æ®ï¼Œå¹¶ä¸”==å­—ç¬¦ä¸²å°äºŽç­‰äºŽ 44 å­—èŠ‚==æ—¶ï¼ŒRedisObject ä¸­çš„==å…ƒæ•°æ®ã€æŒ‡é’ˆå’Œ SDS æ˜¯ä¸€å—è¿žç»­çš„å†…å­˜åŒºåŸŸ==ï¼Œè¿™æ ·å°±å¯ä»¥==é¿å…å†…å­˜ç¢Žç‰‡==ã€‚
	>
	> 		![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/ce83d1346c9642fdbbf5ffbe701bfbe3.jpg)

3. ==ä¸ºä»€ä¹ˆString ç±»åž‹å´ç”¨äº† 64 å­—èŠ‚==ï¼Ÿ

	> - 10 ä½æ•°çš„å›¾ç‰‡ ID å’Œå›¾ç‰‡å­˜å‚¨å¯¹è±¡ ID æ˜¯ ==Long ç±»åž‹æ•´æ•°==ï¼Œæ‰€ä»¥å¯ä»¥ç›´æŽ¥ç”¨ int ç¼–ç çš„ RedisObject ä¿å­˜ã€‚æ¯ä¸ª int ç¼–ç çš„ RedisObject ==å…ƒæ•°æ®éƒ¨åˆ†å  8 å­—èŠ‚==ï¼Œ==æŒ‡é’ˆéƒ¨åˆ†è¢«ç›´æŽ¥èµ‹å€¼ä¸º 8 å­—èŠ‚çš„æ•´æ•°==ã€‚æ­¤æ—¶ï¼Œæ¯==ä¸ª ID ä¼šä½¿ç”¨ 16 å­—èŠ‚ï¼ŒåŠ èµ·æ¥ä¸€å…±æ˜¯ 32 å­—èŠ‚==ã€‚å¦å¤–çš„ 32 å­—èŠ‚åŽ»å“ªå„¿äº†å‘¢ï¼Ÿ
	>
	> - Redis ä¼šä½¿ç”¨ä¸€ä¸ª==å…¨å±€å“ˆå¸Œè¡¨ä¿å­˜æ‰€æœ‰é”®å€¼å¯¹==ï¼Œ==å“ˆå¸Œè¡¨çš„æ¯ä¸€é¡¹æ˜¯ä¸€ä¸ª dictEntry çš„ç»“æž„ä½“==ï¼Œç”¨æ¥==æŒ‡å‘ä¸€ä¸ªé”®å€¼å¯¹==ã€‚dictEntry ç»“æž„ä¸­æœ‰ä¸‰ä¸ª 8 å­—èŠ‚çš„æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ ==keyã€value ä»¥åŠä¸‹ä¸€ä¸ª dictEntryï¼Œä¸‰ä¸ªæŒ‡é’ˆå…± 24 å­—èŠ‚==ã€‚
	>
	> 	<img src="https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/b6cbc5161388fdf4c9b49f3802ef53e7.jpg" alt="img" style="zoom:25%;" />
	>
	> - è¿™ä¸‰ä¸ªæŒ‡é’ˆåªæœ‰ ==24 å­—èŠ‚ï¼Œä¸ºä»€ä¹ˆä¼šå ç”¨äº† 32 å­—èŠ‚==å‘¢ï¼Ÿ
	>
	> 	- ==å¦‚æžœä½ ç”³è¯· 24 å­—èŠ‚ç©ºé—´ï¼Œjemalloc åˆ™ä¼šåˆ†é… 32 å­—èŠ‚ï¼ˆæ‰¾æœ€æŽ¥è¿‘çš„å¤§äºŽå®ƒçš„2çš„å¹‚æ¬¡ï¼‰==ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘ä»¬åˆšåˆšè¯´çš„åœºæ™¯é‡Œï¼ŒdictEntry ç»“æž„å°±å ç”¨äº† 32 å­—èŠ‚ã€‚

4. ==ç”¨ä»€ä¹ˆæ•°æ®ç»“æž„å¯ä»¥èŠ‚çœå†…å­˜==ï¼Ÿ

	> - åŽ‹ç¼©åˆ—è¡¨
	>
	> 	![å¾®ä¿¡æˆªå›¾_20240420222829](Redis.assets/å¾®ä¿¡æˆªå›¾_20240420222829.png)
	>
	> - æ¯ä¸ª entry çš„å…ƒæ•°æ®åŒ…æ‹¬ä¸‹é¢å‡ éƒ¨åˆ†ã€‚
	>
	> 	- prev_lenï¼Œè¡¨ç¤ºå‰ä¸€ä¸ª entry çš„é•¿åº¦ã€‚==prev_len æœ‰ä¸¤ç§å–å€¼æƒ…å†µï¼š1 å­—èŠ‚æˆ– 5 å­—èŠ‚==ã€‚==å–å€¼ 1 å­—èŠ‚æ—¶ï¼Œè¡¨ç¤ºä¸Šä¸€ä¸ª entry çš„é•¿åº¦å°äºŽ 254 å­—èŠ‚==ï¼Œå¦åˆ™ï¼Œå°±å–å€¼ä¸º 5 å­—èŠ‚ã€‚
	> 	- lenï¼šè¡¨ç¤ºè‡ªèº«é•¿åº¦ï¼Œ4 å­—èŠ‚ï¼›
	> 	- encodingï¼šè¡¨ç¤ºç¼–ç æ–¹å¼ï¼Œ1 å­—èŠ‚ï¼›
	> 	- contentï¼šä¿å­˜å®žé™…æ•°æ®ã€‚
	>
	> - è¿™æ ·åšçš„æœ€å¤§å¥½å¤„å°±æ˜¯èŠ‚çœäº† dictEntry çš„å¼€é”€ã€‚å½“ä½ ==ç”¨ String ç±»åž‹æ—¶ï¼Œä¸€ä¸ªé”®å€¼å¯¹å°±æœ‰ä¸€ä¸ª dictEntryï¼Œè¦ç”¨ 32 å­—èŠ‚ç©ºé—´==ã€‚ä½†é‡‡ç”¨é›†åˆç±»åž‹æ—¶ï¼Œä¸€ä¸ª key å°±å¯¹åº”ä¸€ä¸ªé›†åˆçš„æ•°æ®ï¼Œ==èƒ½ä¿å­˜çš„æ•°æ®å¤šäº†å¾ˆå¤šï¼Œä½†ä¹Ÿåªç”¨äº†ä¸€ä¸ª dictEntryï¼Œè¿™æ ·å°±èŠ‚çœäº†å†…å­˜==ã€‚

5. ==å¦‚ä½•ç”¨é›†åˆç±»åž‹ä¿å­˜å•å€¼çš„é”®å€¼å¯¹==ï¼Ÿ

	> - åœ¨ä¿å­˜å•å€¼çš„é”®å€¼å¯¹æ—¶ï¼Œå¯ä»¥é‡‡ç”¨åŸºäºŽ ==Hash ç±»åž‹çš„äºŒçº§ç¼–ç æ–¹æ³•==ã€‚
	> - ä»¥å›¾ç‰‡ ID 1101000060 å’Œå›¾ç‰‡å­˜å‚¨å¯¹è±¡ ID 3302000080 ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå›¾ç‰‡ ID çš„==å‰ 7 ä½ï¼ˆ1101000ï¼‰ä½œä¸º Hash ç±»åž‹çš„é”®==ï¼ŒæŠŠå›¾ç‰‡ ID çš„==æœ€åŽ 3 ä½ï¼ˆ060ï¼‰å’Œå›¾ç‰‡å­˜å‚¨å¯¹è±¡ ID åˆ†åˆ«ä½œä¸º Hash ç±»åž‹å€¼ä¸­çš„ key å’Œ value==ã€‚

6. ==åŽ‹ç¼©åˆ—è¡¨çš„ä½¿ç”¨é™åˆ¶==

	> - hash-max-ziplist-entriesï¼šè¡¨ç¤ºç”¨åŽ‹ç¼©åˆ—è¡¨ä¿å­˜æ—¶å“ˆå¸Œé›†åˆä¸­çš„æœ€å¤§å…ƒç´ ä¸ªæ•°ã€‚
	> - hash-max-ziplist-valueï¼šè¡¨ç¤ºç”¨åŽ‹ç¼©åˆ—è¡¨ä¿å­˜æ—¶å“ˆå¸Œé›†åˆä¸­å•ä¸ªå…ƒç´ çš„æœ€å¤§é•¿åº¦ã€‚
	>
	> Hash é›†åˆä¸­å†™å…¥çš„==å…ƒç´ ä¸ªæ•°è¶…è¿‡äº† hash-max-ziplist-entries==ï¼Œæˆ–è€…å†™å…¥çš„==å•ä¸ªå…ƒç´ å¤§å°è¶…è¿‡äº† hash-max-ziplist-value==ï¼ŒRedis å°±ä¼šè‡ªåŠ¨æŠŠ Hash ç±»åž‹çš„å®žçŽ°ç»“æž„==ç”±åŽ‹ç¼©åˆ—è¡¨è½¬ä¸ºå“ˆå¸Œè¡¨==ã€‚

7. å°ç»“ï¼šåœ¨ä¿å­˜çš„==é”®å€¼å¯¹æœ¬èº«å ç”¨çš„å†…å­˜ç©ºé—´ä¸å¤§==æ—¶ï¼ˆä¾‹å¦‚è¿™èŠ‚è¯¾é‡Œæåˆ°çš„çš„å›¾ç‰‡ ID å’Œå›¾ç‰‡å­˜å‚¨å¯¹è±¡ IDï¼‰ï¼ŒString ç±»åž‹çš„==å…ƒæ•°æ®å¼€é”€å°±å æ®ä¸»å¯¼==äº†ï¼Œè¿™é‡Œé¢==åŒ…æ‹¬äº† RedisObject ç»“æž„ã€SDS ç»“æž„ã€dictEntry ç»“æž„==çš„å†…å­˜å¼€é”€ã€‚

---



### 13.æœ‰ä¸€äº¿ä¸ªkeysè¦ç»Ÿè®¡ï¼Œåº”è¯¥ç”¨å“ªç§é›†åˆï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. ==èšåˆç»Ÿè®¡==

	> - æˆ‘ä»¬å¯ä»¥ç”¨==ä¸€ä¸ªé›†åˆï¼ˆSetï¼‰è®°å½•æ‰€æœ‰ç™»å½•è¿‡ App çš„ç”¨æˆ· ID==ï¼ŒåŒæ—¶ï¼Œç”¨==å¦ä¸€ä¸ªé›†åˆè®°å½•æ¯ä¸€å¤©ç™»å½•è¿‡ App çš„ç”¨æˆ· ID==ã€‚ç„¶åŽï¼Œå†å¯¹è¿™ä¸¤ä¸ªé›†åˆåš==èšåˆè¿ç®—ï¼ˆå¹¶ã€äº¤ã€å·®é›†ï¼‰==ã€‚

2. ==æŽ’åºç»Ÿè®¡==

	> - å½“éœ€è¦è¿›è¡Œ==æŽ’åºç»Ÿè®¡==æ—¶ï¼Œ==List ä¸­çš„å…ƒç´ è™½ç„¶æœ‰åºï¼Œä½†æ˜¯ä¸€æ—¦æœ‰æ–°å…ƒç´ æ’å…¥ï¼ŒåŽŸæ¥çš„å…ƒç´ åœ¨ List ä¸­çš„ä½ç½®å°±ä¼šç§»åŠ¨==ï¼Œé‚£ä¹ˆï¼Œ==æŒ‰ä½ç½®è¯»å–çš„æŽ’åºç»“æžœå¯èƒ½å°±ä¸å‡†ç¡®==äº†ã€‚è€Œ ==Sorted Set æœ¬èº«æ˜¯æŒ‰ç…§é›†åˆå…ƒç´ çš„æƒé‡æŽ’åº==ï¼Œå¯ä»¥==å‡†ç¡®åœ°æŒ‰åºèŽ·å–ç»“æžœ==ï¼Œæ‰€ä»¥å»ºè®®ä½ ä¼˜å…ˆä½¿ç”¨å®ƒã€‚

3. ==äºŒå€¼çŠ¶æ€ç»Ÿè®¡==

	> - åœ¨ç»Ÿè®¡ 1 äº¿ä¸ªç”¨æˆ·è¿žç»­ 10 å¤©çš„ç­¾åˆ°æƒ…å†µæ—¶ï¼Œä½ å¯ä»¥æŠŠæ¯å¤©çš„æ—¥æœŸä½œä¸º keyï¼Œ==æ¯ä¸ª key å¯¹åº”ä¸€ä¸ª 1 äº¿ä½çš„ Bitmap==ï¼Œ==æ¯ä¸€ä¸ª bit å¯¹åº”ä¸€ä¸ªç”¨æˆ·å½“å¤©çš„ç­¾åˆ°æƒ…å†µ==ã€‚

4. ==åŸºæ•°ç»Ÿè®¡==

	> - ==HyperLogLog æ˜¯ä¸€ç§ç”¨äºŽç»Ÿè®¡åŸºæ•°çš„æ•°æ®é›†åˆç±»åž‹==ï¼Œå®ƒçš„æœ€å¤§ä¼˜åŠ¿å°±åœ¨äºŽï¼Œå½“é›†åˆå…ƒç´ æ•°é‡éžå¸¸å¤šæ—¶ï¼Œ==å®ƒè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”è¿˜å¾ˆå°==ã€‚
	> - åœ¨ Redis ä¸­ï¼Œæ¯ä¸ª HyperLogLog åªéœ€è¦èŠ±è´¹ ==12 KB å†…å­˜==ï¼Œå°±å¯ä»¥è®¡ç®—æŽ¥è¿‘ ==2^64 ä¸ªå…ƒç´ çš„åŸºæ•°==ã€‚
	> - HyperLogLog çš„ç»Ÿè®¡è§„åˆ™æ˜¯==åŸºäºŽæ¦‚çŽ‡å®Œæˆçš„==ï¼Œæ‰€ä»¥å®ƒç»™å‡ºçš„ç»Ÿè®¡ç»“æžœæ˜¯æœ‰ä¸€å®šè¯¯å·®çš„ï¼Œæ ‡å‡†è¯¯ç®—çŽ‡æ˜¯ ==0.81%==ã€‚

5. ==å‡ ç§æ•°æ®ç»“æž„çš„å¯¹æ¯”å›¾==

	> ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/c0bb35d0d91a62ef4ca1bd939a9b136e.jpg)

---



### 16.æ¶ˆæ¯é˜Ÿåˆ—çš„è€ƒéªŒï¼šRedisæœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. ==æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯å­˜å–éœ€æ±‚==

	> - ==æ¶ˆæ¯é˜Ÿåˆ—å¿…é¡»è¦æ»¡è¶³ä¸‰ä¸ªéœ€æ±‚ï¼Œåˆ†åˆ«æ˜¯æ¶ˆæ¯ä¿åºã€å¤„ç†é‡å¤çš„æ¶ˆæ¯å’Œä¿è¯æ¶ˆæ¯å¯é æ€§==ã€‚
	> 	- ==æ¶ˆæ¯ä¿åº==ï¼šä¸€æ—¦å‡ºçŽ°è¿™ç§æ¶ˆæ¯è¢«ä¹±åºå¤„ç†çš„æƒ…å†µï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡é€»è¾‘è¢«é”™è¯¯æ‰§è¡Œï¼Œä»Žè€Œç»™ä¸šåŠ¡æ–¹é€ æˆæŸå¤±ã€‚
	> 	- ==å¤„ç†é‡å¤çš„æ¶ˆæ¯==ï¼šæœ‰æ—¶ä¼šå› ä¸º==ç½‘ç»œå µå¡žè€Œå‡ºçŽ°æ¶ˆæ¯é‡ä¼ ==çš„æƒ…å†µã€‚
	> 	- ==ä¿è¯æ¶ˆæ¯å¯é æ€§==ï¼šå¯èƒ½å‡ºçŽ°å› ä¸º==æ•…éšœæˆ–å®•æœºå¯¼è‡´æ¶ˆæ¯æ²¡æœ‰å¤„ç†å®Œæˆ==çš„æƒ…å†µã€‚

2. ==åŸºäºŽ List çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ==

	> - Redis æä¾›äº† BRPOP å‘½ä»¤ã€‚==BRPOP å‘½ä»¤ä¹Ÿç§°ä¸ºé˜»å¡žå¼è¯»å–==ï¼Œå®¢æˆ·ç«¯åœ¨==æ²¡æœ‰è¯»åˆ°é˜Ÿåˆ—æ•°æ®æ—¶ï¼Œè‡ªåŠ¨é˜»å¡ž==ï¼Œç›´åˆ°æœ‰æ–°çš„æ•°æ®å†™å…¥é˜Ÿåˆ—ï¼Œå†å¼€å§‹è¯»å–æ–°æ•°æ®ã€‚é¿å…äº†==æ¶ˆè´¹è€…ç¨‹åºè‡ªå·±ä¸åœåœ°è°ƒç”¨ RPOP å‘½ä»¤==ï¼Œ==èŠ‚çœ CPU å¼€é”€==ã€‚
	>
	> - ==è§£å†³é‡å¤æ¶ˆæ¯çš„æ–¹æ³•==ï¼š
	>
	> 	- ä¸€æ–¹é¢ï¼Œ==æ¶ˆæ¯é˜Ÿåˆ—è¦èƒ½ç»™æ¯ä¸€ä¸ªæ¶ˆæ¯æä¾›å…¨å±€å”¯ä¸€çš„ ID å·==ï¼›å¦ä¸€æ–¹é¢ï¼Œ==æ¶ˆè´¹è€…ç¨‹åºè¦æŠŠå·²ç»å¤„ç†è¿‡çš„æ¶ˆæ¯çš„ ID å·è®°å½•ä¸‹æ¥==ã€‚å½“æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯åŽï¼Œæ¶ˆè´¹è€…ç¨‹åºå°±å¯ä»¥==å¯¹æ¯”æ”¶åˆ°çš„æ¶ˆæ¯ ID å’Œè®°å½•çš„å·²å¤„ç†è¿‡çš„æ¶ˆæ¯ ID==ï¼Œæ¥åˆ¤æ–­å½“å‰æ”¶åˆ°çš„æ¶ˆæ¯æœ‰æ²¡æœ‰ç»è¿‡å¤„ç†ã€‚
	>
	> - ==List æœ¬èº«æ˜¯ä¸ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯ç”Ÿæˆ ID å·==çš„ï¼Œæ‰€ä»¥ï¼Œæ¶ˆæ¯çš„å…¨å±€å”¯ä¸€ ID å·å°±==éœ€è¦ç”Ÿäº§è€…ç¨‹åºåœ¨å‘é€æ¶ˆæ¯å‰è‡ªè¡Œç”Ÿæˆ==ã€‚
	>
	> 	```java
	> 	LPUSH mq "101030001:stock:5"
	> 	(integer) 1
	> 	```
	>
	> - ==ä¿è¯æ¶ˆæ¯å¯é æ€§çš„æ–¹æ³•==ï¼š
	>
	> 	- ä¸ºäº†ç•™å­˜æ¶ˆæ¯ï¼ŒList ç±»åž‹æä¾›äº† ==BRPOPLPUSH å‘½ä»¤==ï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯è®©æ¶ˆè´¹è€…ç¨‹åºä»Žä¸€ä¸ª List ä¸­è¯»å–æ¶ˆæ¯ï¼Œ==åŒæ—¶ï¼ŒRedis ä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯å†æ’å…¥åˆ°å¦ä¸€ä¸ª Listï¼ˆå¯ä»¥å«ä½œå¤‡ä»½ Listï¼‰ç•™å­˜==ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¦‚æžœæ¶ˆè´¹è€…ç¨‹åºè¯»äº†æ¶ˆæ¯ä½†æ²¡èƒ½æ­£å¸¸å¤„ç†ï¼Œç­‰å®ƒ==é‡å¯åŽï¼Œå°±å¯ä»¥ä»Žå¤‡ä»½ List ä¸­é‡æ–°è¯»å–æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†==äº†ã€‚
	> 	- ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/5045395da08317b546aab7eb698d013d.jpg)
	>
	> - ==ç”Ÿäº§è€…æ¶ˆæ¯å‘é€å¾ˆå¿«ï¼Œè€Œæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¿™å°±å¯¼è‡´ List ä¸­çš„æ¶ˆæ¯è¶Šç§¯è¶Šå¤šï¼Œç»™ Redis çš„å†…å­˜å¸¦æ¥å¾ˆå¤§åŽ‹åŠ›==ã€‚

3. ==åŸºäºŽ Streams çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ==

	> - Streams åŒæ ·èƒ½å¤Ÿæ»¡è¶³æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰å¤§éœ€æ±‚ï¼Œå®ƒè¿˜æ”¯æŒ==æ¶ˆè´¹ç»„ï¼ˆå¤šä¸ªæ¶ˆè´¹è€…ï¼‰å½¢å¼çš„æ¶ˆæ¯è¯»å–==ã€‚
	>
	> - Streams æä¾›çš„==æ¶ˆæ¯é˜Ÿåˆ—æ“ä½œå‘½ä»¤==ï¼š
	>
	> 	1. ==XADD==ï¼šæ’å…¥æ¶ˆæ¯ï¼Œä¿è¯æœ‰åºï¼Œå¯ä»¥==è‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€ ID==ï¼›
	>
	> 		> - æ¶ˆæ¯é˜Ÿåˆ—åç§°åŽé¢çš„ *ï¼Œè¡¨ç¤ºè®© Redis ä¸ºæ’å…¥çš„æ•°æ®è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ ID
	> 		>
	> 		> - ```shell
	> 		> 	XADD mqstream * repo 5
	> 		> 	"1599203861727-0"
	> 		> 	```
	>
	> 	2. ==XREAD==ï¼šç”¨äºŽè¯»å–æ¶ˆæ¯ï¼Œå¯ä»¥==æŒ‰ ID è¯»å–æ•°æ®==ï¼›
	>
	> 		> - æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œ==ä»Ž ID å·ä¸º 1599203861727-0 çš„æ¶ˆæ¯å¼€å§‹ï¼Œè¯»å–åŽç»­çš„æ‰€æœ‰æ¶ˆæ¯==ï¼ˆç¤ºä¾‹ä¸­ä¸€å…± 3 æ¡ï¼‰ã€‚
	> 		>
	> 		> - ```shell
	> 		> 	XREAD BLOCK 10000 STREAMS  mqstream 1599203861727-0
	> 		> 	1) 1) "mqstream"
	> 		> 	   2) 1) 1) "1599274912765-0"
	> 		> 	         2) 1) "repo"
	> 		> 	            2) "3"
	> 		> 	      2) 1) "1599274925823-0"
	> 		> 	         2) 1) "repo"
	> 		> 	            2) "2"
	> 		> 	      3) 1) "1599274927910-0"
	> 		> 	         2) 1) "repo"
	> 		> 	            2) "1"
	> 		> 	```
	> 		>
	> 		> - æˆ‘ä»¬è®¾ç½®äº† block 10000 çš„é…ç½®é¡¹ï¼Œ10000 çš„å•ä½æ˜¯æ¯«ç§’ï¼Œè¡¨æ˜Ž ==XREAD åœ¨è¯»å–æœ€æ–°æ¶ˆæ¯æ—¶ï¼Œå¦‚æžœæ²¡æœ‰æ¶ˆæ¯åˆ°æ¥ï¼ŒXREAD å°†é˜»å¡ž 10000 æ¯«ç§’==ï¼ˆå³ 10 ç§’ï¼‰ï¼Œç„¶åŽå†è¿”å›žã€‚
	>
	> 	3. ==XREADGROUP==ï¼šæŒ‰==æ¶ˆè´¹ç»„å½¢å¼è¯»å–æ¶ˆæ¯==ï¼›
	>
	> 		> - æˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º group1 çš„æ¶ˆè´¹ç»„ï¼Œè¿™ä¸ªæ¶ˆè´¹ç»„æ¶ˆè´¹çš„æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ mqstreamã€‚
	> 		>
	> 		> - ```shell
	> 		> 	XGROUP create mqstream group1 0
	> 		> 	OK
	> 		> 	```
	> 		>
	> 		> - è®© group1 æ¶ˆè´¹ç»„é‡Œçš„æ¶ˆè´¹è€… consumer1 ä»Ž mqstream ä¸­è¯»å–æ‰€æœ‰æ¶ˆæ¯ï¼Œå…¶ä¸­ï¼Œå‘½ä»¤æœ€åŽçš„å‚æ•°â€œ>â€ï¼Œè¡¨ç¤ºä»Žç¬¬ä¸€æ¡å°šæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯å¼€å§‹è¯»å–ã€‚
	> 		>
	> 		> - 
	> 		>
	> 		> - ```shell
	> 		> 	XREADGROUP group group1 consumer1 streams mqstream >
	> 		> 	1) 1) "mqstream"
	> 		> 	   2) 1) 1) "1599203861727-0"
	> 		> 	         2) 1) "repo"
	> 		> 	            2) "5"
	> 		> 	      2) 1) "1599274912765-0"
	> 		> 	         2) 1) "repo"
	> 		> 	            2) "3"
	> 		> 	      3) 1) "1599274925823-0"
	> 		> 	         2) 1) "repo"
	> 		> 	            2) "2"
	> 		> 	      4) 1) "1599274927910-0"
	> 		> 	         2) 1) "repo"
	> 		> 	            2) "1"
	> 		> 	```
	>
	> 	4. ==XPENDING== å’Œ ==XACK==ï¼š==XPENDING å‘½ä»¤==å¯ä»¥ç”¨æ¥æŸ¥è¯¢æ¯ä¸ªæ¶ˆè´¹ç»„å†…æ‰€æœ‰æ¶ˆè´¹è€…==å·²è¯»å–ä½†å°šæœªç¡®è®¤çš„æ¶ˆæ¯==ï¼Œè€Œ XACK å‘½ä»¤ç”¨äºŽ==å‘æ¶ˆæ¯é˜Ÿåˆ—ç¡®è®¤æ¶ˆæ¯å¤„ç†å·²å®Œæˆ==ã€‚
	>
	> 		> - ä¸ºäº†ä¿è¯æ¶ˆè´¹è€…åœ¨==å‘ç”Ÿæ•…éšœæˆ–å®•æœºå†æ¬¡é‡å¯åŽï¼Œä»ç„¶å¯ä»¥è¯»å–æœªå¤„ç†å®Œçš„æ¶ˆæ¯==ï¼ŒStreams ä¼šè‡ªåŠ¨ä½¿ç”¨==å†…éƒ¨é˜Ÿåˆ—ï¼ˆä¹Ÿç§°ä¸º PENDING Listï¼‰ç•™å­˜æ¶ˆè´¹ç»„é‡Œæ¯ä¸ªæ¶ˆè´¹è€…è¯»å–çš„æ¶ˆæ¯==ï¼Œ==ç›´åˆ°æ¶ˆè´¹è€…ä½¿ç”¨ XACK å‘½ä»¤é€šçŸ¥ Streamsâ€œæ¶ˆæ¯å·²ç»å¤„ç†å®Œæˆâ€==ã€‚
	> 		> - å¦‚æžœæ¶ˆè´¹è€…æ²¡æœ‰æˆåŠŸå¤„ç†æ¶ˆæ¯ï¼Œå°±ä¸ä¼šç»™ Streams å‘é€ XACK å‘½ä»¤ï¼Œæ¶ˆæ¯ä»ç„¶ä¼šç•™å­˜ã€‚æ­¤æ—¶ï¼Œæ¶ˆè´¹è€…å¯åœ¨==é‡å¯åŽï¼Œç”¨ XPENDING å‘½ä»¤æŸ¥çœ‹å·²è¯»å–ã€ä½†å°šæœªç¡®è®¤å¤„ç†å®Œæˆçš„æ¶ˆæ¯==ã€‚

4. ==å°ç»“==ï¼š

	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/b2d6581e43f573da6218e790bb8c6814.jpg)
	> - Redis æ˜¯ä¸€ä¸ªéžå¸¸==è½»é‡çº§==çš„é”®å€¼æ•°æ®åº“ï¼Œ==éƒ¨ç½²ä¸€ä¸ª Redis å®žä¾‹å°±æ˜¯å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹==ï¼Œéƒ¨ç½² Redis é›†ç¾¤ï¼Œä¹Ÿå°±æ˜¯éƒ¨ç½²å¤šä¸ª Redis å®žä¾‹ã€‚è€Œ ==Kafkaã€RabbitMQ éƒ¨ç½²æ—¶ï¼Œæ¶‰åŠé¢å¤–çš„ç»„ä»¶==ï¼Œä¾‹==å¦‚ Kafka çš„è¿è¡Œå°±éœ€è¦å†éƒ¨ç½² ZooKeeper==ã€‚
	
5. Redis åŸºäºŽå­—å…¸å’Œé“¾è¡¨æ•°æ®ç»“æž„ï¼Œå®žçŽ°äº†==å‘å¸ƒå’Œè®¢é˜…åŠŸèƒ½==ï¼Œå®žçŽ°äº†==ä¸€ä¸ªæ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä½¿ç”¨==ã€‚

---



### 17.å¼‚æ­¥æœºåˆ¶ï¼šå¦‚ä½•é¿å…å•çº¿ç¨‹æ¨¡åž‹çš„é˜»å¡žï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. ==Redis å®žä¾‹æœ‰å“ªäº›é˜»å¡žç‚¹==ï¼Ÿ

	> - ==å®¢æˆ·ç«¯==ï¼šç½‘ç»œ IOï¼Œé”®å€¼å¯¹å¢žåˆ æ”¹æŸ¥æ“ä½œï¼Œæ•°æ®åº“æ“ä½œï¼›
	> - ==ç£ç›˜==ï¼šç”Ÿæˆ RDB å¿«ç…§ï¼Œè®°å½• AOF æ—¥å¿—ï¼ŒAOF æ—¥å¿—é‡å†™ï¼›
	> - ==ä¸»ä»ŽèŠ‚ç‚¹==ï¼šä¸»åº“ç”Ÿæˆã€ä¼ è¾“ RDB æ–‡ä»¶ï¼Œä»Žåº“æŽ¥æ”¶ RDB æ–‡ä»¶ã€æ¸…ç©ºæ•°æ®åº“ã€åŠ è½½ RDB æ–‡ä»¶ï¼›
	> - ==åˆ‡ç‰‡é›†ç¾¤å®žä¾‹==ï¼šå‘å…¶ä»–å®žä¾‹ä¼ è¾“å“ˆå¸Œæ§½ä¿¡æ¯ï¼Œæ•°æ®è¿ç§»ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/6ce8abb76b3464afe1c4cb3bbe426922.jpg)

2. ==å’Œå®¢æˆ·ç«¯äº¤äº’æ—¶çš„é˜»å¡žç‚¹==

	> 1. Redis ä½¿ç”¨äº† ==IO å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œé¿å…äº†ä¸»çº¿ç¨‹ä¸€ç›´å¤„åœ¨ç­‰å¾…ç½‘ç»œè¿žæŽ¥æˆ–è¯·æ±‚åˆ°æ¥çš„çŠ¶æ€==ï¼Œæ‰€ä»¥ï¼Œ==ç½‘ç»œ IO ä¸æ˜¯å¯¼è‡´ Redis é˜»å¡žçš„å› ç´ ==ã€‚
	> 2. ==å¤æ‚åº¦é«˜çš„å¢žåˆ æ”¹æŸ¥æ“ä½œ==è‚¯å®šä¼š==é˜»å¡ž Redis==ã€‚æ ‡å‡†å°±æ˜¯çœ‹æ“ä½œçš„==å¤æ‚åº¦æ˜¯å¦ä¸º O(N)==ã€‚
	> 	- Redis çš„==ç¬¬ä¸€ä¸ªé˜»å¡žç‚¹ï¼šé›†åˆå…¨é‡æŸ¥è¯¢å’Œèšåˆæ“ä½œï¼ˆå¹¶ã€äº¤ã€å·®é›†ï¼‰==ã€‚
	>
	> 3. é›†åˆè‡ªèº«çš„==åˆ é™¤æ“ä½œ==åŒæ ·ä¹Ÿæœ‰æ½œåœ¨çš„==é˜»å¡žé£Žé™©==ã€‚
	>
	> 	- ==åˆ é™¤æ“ä½œçš„æœ¬è´¨==æ˜¯è¦==é‡Šæ”¾é”®å€¼å¯¹å ç”¨çš„å†…å­˜ç©ºé—´==ã€‚åœ¨åº”ç”¨ç¨‹åº==é‡Šæ”¾å†…å­˜æ—¶==ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦æŠŠ==é‡Šæ”¾æŽ‰çš„å†…å­˜å—æ’å…¥ä¸€ä¸ªç©ºé—²å†…å­˜å—çš„é“¾è¡¨==ï¼Œä»¥ä¾¿åŽç»­è¿›è¡Œç®¡ç†å’Œå†åˆ†é…ã€‚==è¿™ä¸ªè¿‡ç¨‹æœ¬èº«éœ€è¦ä¸€å®šæ—¶é—´==ï¼Œè€Œä¸”==ä¼šé˜»å¡žå½“å‰é‡Šæ”¾å†…å­˜çš„åº”ç”¨ç¨‹åº==ã€‚
	>
	> 	- ==bigkey åˆ é™¤æ“ä½œå°±æ˜¯ Redis çš„ç¬¬äºŒä¸ªé˜»å¡žç‚¹==ã€‚
	>
	> 	- ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/94bc8cf9yy5c34a6445434a15b1e9653.jpg)
	>
	> 4. æ—¢ç„¶ bigkey åˆ é™¤éƒ½æ˜¯é˜»å¡žç‚¹ï¼Œé‚£ä¹ˆæ˜¾ç„¶ï¼š==Redis çš„ç¬¬ä¸‰ä¸ªé˜»å¡žç‚¹ï¼šæ¸…ç©ºæ•°æ®åº“==ã€‚

3. ==å’Œç£ç›˜äº¤äº’æ—¶çš„é˜»å¡žç‚¹==

	> - ä¸€ä¸ªåŒæ­¥å†™ç£ç›˜çš„æ“ä½œçš„è€—æ—¶å¤§çº¦æ˜¯ ==1ï½ž2ms==ï¼Œå¦‚æžœæœ‰==å¤§é‡çš„å†™æ“ä½œéœ€è¦è®°å½•åœ¨ AOF æ—¥å¿—ä¸­==ï¼Œå¹¶==åŒæ­¥å†™å›žçš„è¯ï¼Œå°±ä¼šé˜»å¡žä¸»çº¿ç¨‹==äº†ã€‚è¿™å°±å¾—åˆ°äº† ==Redis çš„ç¬¬å››ä¸ªé˜»å¡žç‚¹äº†ï¼šAOF æ—¥å¿—åŒæ­¥å†™ï¼ˆAOF é‡å†™çš„æ—¶å€™ä½¿ç”¨å­è¿›ç¨‹ï¼Œä½†æ˜¯å†™å…¥ç£ç›˜çš„æ˜¯å¦æ˜¯ä¸»çº¿ç¨‹åŒæ­¥å†™çš„ï¼‰==ã€‚

4. ==ä¸»ä»ŽèŠ‚ç‚¹äº¤äº’æ—¶çš„é˜»å¡žç‚¹==

	> - ==ä»Žåº“åŠ è½½ RDB æ–‡ä»¶å°±æˆä¸ºäº† Redis çš„ç¬¬äº”ä¸ªé˜»å¡žç‚¹==ã€‚

5. ==åˆ‡ç‰‡é›†ç¾¤å®žä¾‹äº¤äº’æ—¶çš„é˜»å¡žç‚¹==

	> - å¦‚æžœä½ ä½¿ç”¨äº† ==Redis Cluster æ–¹æ¡ˆ==ï¼Œè€Œä¸”åŒæ—¶æ­£å¥½è¿ç§»çš„æ˜¯ ==bigkey== çš„è¯ï¼Œå°±ä¼š==é€ æˆä¸»çº¿ç¨‹çš„é˜»å¡ž==ï¼Œå› ä¸º ==Redis Cluster ä½¿ç”¨äº†åŒæ­¥è¿ç§»==ã€‚
	> - å½“==æ²¡æœ‰ bigkey== æ—¶ï¼Œ==åˆ‡ç‰‡é›†ç¾¤çš„å„å®žä¾‹åœ¨è¿›è¡Œäº¤äº’æ—¶ä¸ä¼šé˜»å¡žä¸»çº¿ç¨‹==ï¼Œå°±å¯ä»¥äº†ã€‚

6. ==äº”ä¸ªé˜»å¡žç‚¹==

	> - é›†åˆ==å…¨é‡æŸ¥è¯¢==å’Œ==èšåˆæ“ä½œ==ï¼›
	> - ==bigkey åˆ é™¤==ï¼›
	> - ==æ¸…ç©ºæ•°æ®åº“==ï¼›
	> - ==AOF== æ—¥å¿—==åŒæ­¥å†™å¦‚ç£ç›˜==ï¼›
	> - ==ä»Žåº“åŠ è½½ RDB== æ–‡ä»¶ã€‚
	> - ä¸ºäº†é¿å…é˜»å¡žå¼æ“ä½œï¼ŒRedis æä¾›äº†==å¼‚æ­¥çº¿ç¨‹æœºåˆ¶==ã€‚Redis ä¼šå¯åŠ¨ä¸€äº›==å­çº¿ç¨‹==ï¼Œç„¶åŽæŠŠä¸€äº›ä»»åŠ¡äº¤ç»™è¿™äº›å­çº¿ç¨‹ï¼Œè®©å®ƒä»¬åœ¨==åŽå°å®Œæˆ==ï¼Œè€Œä¸å†ç”±ä¸»çº¿ç¨‹æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚

7. ==å“ªäº›é˜»å¡žç‚¹å¯ä»¥å¼‚æ­¥æ‰§è¡Œ==ï¼Ÿ

	> - å¦‚æžœä¸€ä¸ªæ“ä½œèƒ½è¢«å¼‚æ­¥æ‰§è¡Œï¼Œå°±æ„å‘³ç€ï¼Œ==å®ƒå¹¶ä¸æ˜¯ Redis ä¸»çº¿ç¨‹çš„å…³é”®è·¯å¾„ä¸Šçš„æ“ä½œ==ã€‚
	> - æ‰€è°“==å…³é”®è·¯å¾„çš„æ“ä½œ==ï¼Œå°±æ˜¯==å®¢æˆ·ç«¯ç­‰å¾…æœåŠ¡ç«¯è¿”å›žæ“ä½œç»“æžœ==çš„æ“ä½œã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/f196035e3d2ba65257b211ed436b0b61.jpg)
	> - åˆ†æžï¼š
	> 	- Redis çš„ç¬¬ä¸€ä¸ªé˜»å¡žç‚¹â€œ==é›†åˆå…¨é‡æŸ¥è¯¢å’Œèšåˆæ“ä½œâ€éƒ½æ¶‰åŠåˆ°äº†è¯»æ“ä½œ==ï¼Œæ‰€ä»¥ï¼Œå®ƒä»¬æ˜¯==ä¸èƒ½è¿›è¡Œå¼‚æ­¥æ“ä½œ==äº†ã€‚
	> 	- ==ç¬¬äºŒä¸ªé˜»å¡žç‚¹â€œbigkey åˆ é™¤â€==ï¼Œå’Œ==ç¬¬ä¸‰ä¸ªé˜»å¡žç‚¹â€œæ¸…ç©ºæ•°æ®åº“â€==ï¼Œéƒ½æ˜¯å¯¹æ•°æ®åšåˆ é™¤ï¼Œå¹¶==ä¸åœ¨å…³é”®è·¯å¾„ä¸Š==ã€‚å› æ­¤ï¼Œæˆ‘ä»¬==å¯ä»¥ä½¿ç”¨åŽå°å­çº¿ç¨‹==æ¥å¼‚æ­¥æ‰§è¡Œåˆ é™¤æ“ä½œã€‚
	> 	- ==ç¬¬å››ä¸ªé˜»å¡žç‚¹â€œAOF æ—¥å¿—åŒæ­¥å†™â€==ï¼Œä¹Ÿå¯ä»¥==å¯åŠ¨ä¸€ä¸ªå­çº¿ç¨‹æ¥æ‰§è¡Œ AOF æ—¥å¿—çš„åŒæ­¥å†™==ï¼Œè€Œä¸ç”¨è®©ä¸»çº¿ç¨‹ç­‰å¾… AOF æ—¥å¿—çš„å†™å®Œæˆã€‚
	> 	- â€œ==ä»Žåº“åŠ è½½ RDB æ–‡ä»¶==â€è¿™ä¸ªé˜»å¡žç‚¹ã€‚ä»Žåº“è¦æƒ³==å¯¹å®¢æˆ·ç«¯æä¾›æ•°æ®å­˜å–æœåŠ¡==ï¼Œå°±==å¿…é¡»æŠŠ RDB æ–‡ä»¶åŠ è½½å®Œæˆï¼ˆå¦‚æžœä½¿ç”¨å­è¿›ç¨‹åœ¨åŽå°è¯»å– RDB çš„è¯ï¼Œå¯èƒ½è¿˜æ²¡è¯»å®Œå°±æ”¶åˆ°è¯·æ±‚ï¼Œæ— æ³•è¿”å›žæ­£ç¡®ç»“æžœäº†ï¼‰==ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿå±žäºŽå…³é”®è·¯å¾„ä¸Šçš„æ“ä½œï¼Œæˆ‘ä»¬å¿…é¡»è®©ä»Žåº“çš„ä¸»çº¿ç¨‹æ¥æ‰§è¡Œã€‚

8. ==å¼‚æ­¥çš„å­çº¿ç¨‹æœºåˆ¶==

	> - ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ ==pthread_create å‡½æ•°åˆ›å»º 3 ä¸ªå­çº¿ç¨‹==ï¼Œåˆ†åˆ«ç”±å®ƒä»¬è´Ÿè´£ AOF æ—¥å¿—å†™æ“ä½œã€é”®å€¼å¯¹åˆ é™¤ä»¥åŠæ–‡ä»¶å…³é—­çš„å¼‚æ­¥æ‰§è¡Œã€‚
	>
	> - ==æ“ä½œè¯¦æƒ…==ï¼š
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/ae004728bfe6d3771c7424e4161e7969.jpg)
	>
	> - ==å¼‚æ­¥çš„é”®å€¼å¯¹åˆ é™¤å’Œæ•°æ®åº“æ¸…ç©ºæ“ä½œæ˜¯ Redis 4.0 åŽæä¾›çš„åŠŸèƒ½==ï¼ŒRedis ä¹Ÿæä¾›äº†æ–°çš„å‘½ä»¤æ¥æ‰§è¡Œè¿™ä¸¤ä¸ªæ“ä½œã€‚
	>
	> 	- ==é”®å€¼å¯¹åˆ é™¤==ï¼šå½“ä½ çš„é›†åˆç±»åž‹ä¸­æœ‰å¤§é‡å…ƒç´ ï¼ˆä¾‹å¦‚æœ‰ç™¾ä¸‡çº§åˆ«æˆ–åƒä¸‡çº§åˆ«å…ƒç´ ï¼‰éœ€è¦åˆ é™¤æ—¶ï¼Œæˆ‘å»ºè®®ä½ ä½¿ç”¨ ==UNLINK== å‘½ä»¤ã€‚
	> 	- ==æ¸…ç©ºæ•°æ®åº“==ï¼šå¯ä»¥åœ¨ ==FLUSHDB å’Œ FLUSHALL å‘½ä»¤åŽåŠ ä¸Š ASYNC é€‰é¡¹==ï¼Œè¿™æ ·å°±å¯ä»¥==è®©åŽå°å­çº¿ç¨‹å¼‚æ­¥åœ°æ¸…ç©ºæ•°æ®åº“==ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
	>
	> 	```java
	> 	FLUSHDB ASYNC
	> 	FLUSHALL AYSNC
	> 	```

9. ==Redis çš„å†™æ“ä½œï¼ˆä¾‹å¦‚ SETã€HSETã€SADD ç­‰ï¼‰æ˜¯åœ¨å…³é”®è·¯å¾„ä¸Šå—ï¼Ÿ==

	> - Redis è®°å½•çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œå› æ­¤==åœ¨å†…å­˜ä¸­è¿›è¡Œçš„å†™æ“ä½œåœ¨å…³é”®è·¯å¾„ä¸Š==ã€‚

----



### 18.ä¸ºä»€ä¹ˆCPUç»“æž„ä¹Ÿä¼šå½±å“Redisçš„æ€§èƒ½ï¼ŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ

1. ==ä¸»æµçš„ CPU æž¶æž„==

	> - ç‰©ç†æ ¸çš„==ç§æœ‰ç¼“å­˜==æ˜¯æŒ‡==ç¼“å­˜ç©ºé—´åªèƒ½è¢«å½“å‰çš„è¿™ä¸ªç‰©ç†æ ¸ä½¿ç”¨==ï¼Œå…¶ä»–çš„ç‰©ç†æ ¸æ— æ³•å¯¹è¿™ä¸ªæ ¸çš„ç¼“å­˜ç©ºé—´è¿›è¡Œæ•°æ®å­˜å–ã€‚
	>
	> - <img src="https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/c2d620c012a82e825570df631a7fbc3a.jpg" alt="img" style="zoom: 25%;" />
	>
	> - å½“æ•°æ®æˆ–æŒ‡ä»¤==ä¿å­˜åœ¨ L1ã€L2 ç¼“å­˜==æ—¶ï¼Œç‰©ç†æ ¸è®¿é—®å®ƒä»¬çš„==å»¶è¿Ÿä¸è¶…è¿‡ 10 çº³ç§’==ã€‚è¿™äº› L1 å’Œ L2 ç¼“å­˜çš„å¤§å°å—é™äºŽå¤„ç†å™¨çš„åˆ¶é€ æŠ€æœ¯ï¼Œä¸€èˆ¬==åªæœ‰ KB çº§åˆ«==ï¼Œ==å­˜ä¸ä¸‹å¤ªå¤šçš„æ•°æ®==ã€‚
	>
	> - ä¸åŒçš„==ç‰©ç†æ ¸è¿˜ä¼šå…±äº«ä¸€ä¸ªå…±åŒçš„ä¸‰çº§ç¼“å­˜==ï¼ˆLevel 3 cacheï¼Œç®€ç§°ä¸º L3 cacheï¼‰ã€‚L3 ç¼“å­˜èƒ½å¤Ÿä½¿ç”¨çš„å­˜å‚¨èµ„æºæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ä¸€èˆ¬æ¯”è¾ƒå¤§ï¼Œèƒ½è¾¾åˆ°==å‡  MB åˆ°å‡ å MB==ï¼Œè¿™å°±èƒ½è®©åº”ç”¨ç¨‹åºç¼“å­˜æ›´å¤šçš„æ•°æ®ã€‚å½“ ==L1ã€L2 ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ç¼“å­˜æ—¶==ï¼Œå¯ä»¥==è®¿é—® L3==ï¼Œå°½å¯èƒ½==é¿å…è®¿é—®å†…å­˜==ã€‚
	>
	> - çŽ°åœ¨ä¸»æµçš„ CPU å¤„ç†å™¨ä¸­ï¼Œ==æ¯ä¸ªç‰©ç†æ ¸é€šå¸¸éƒ½ä¼šè¿è¡Œä¸¤ä¸ªè¶…çº¿ç¨‹==ï¼Œä¹Ÿå«ä½œ==é€»è¾‘æ ¸==ã€‚åŒä¸€ä¸ªç‰©ç†æ ¸çš„==é€»è¾‘æ ¸ä¼šå…±äº«ä½¿ç”¨ L1ã€L2 ç¼“å­˜==ã€‚
	>
	> - ==å• CPU æž¶æž„==ï¼š
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/d9689a38cbe67c3008d8ba99663c2f09.jpg)
	>
	> - ==å¤š CPU Socket NUMA æ¡†æž¶==ï¼š
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/5ceb2ab6f61c064284c8f8811431bc3d.jpg)
	>
	> - ==åœ¨å¤š CPU æž¶æž„ä¸Šï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸åŒçš„å¤„ç†å™¨ä¸Šè¿è¡Œ==ã€‚
	>
	> - å¦‚æžœåº”ç”¨ç¨‹åºå…ˆåœ¨ä¸€ä¸ª Socket ä¸Šè¿è¡Œï¼Œå¹¶ä¸”==æŠŠæ•°æ®ä¿å­˜åˆ°äº†å†…å­˜==ï¼Œç„¶åŽè¢«==è°ƒåº¦åˆ°å¦ä¸€ä¸ª Socket ä¸Šè¿è¡Œ==ï¼Œæ­¤æ—¶ï¼Œåº”ç”¨ç¨‹åºå†è¿›è¡Œå†…å­˜è®¿é—®æ—¶ï¼Œå°±éœ€è¦==è®¿é—®ä¹‹å‰ Socket ä¸Šè¿žæŽ¥çš„å†…å­˜==ï¼Œè¿™ç§è®¿é—®å±žäºŽ==è¿œç«¯å†…å­˜è®¿é—®ã€‚å’Œè®¿é—® Socket ç›´æŽ¥è¿žæŽ¥çš„å†…å­˜ç›¸æ¯”ï¼Œè¿œç«¯å†…å­˜è®¿é—®ä¼šå¢žåŠ åº”ç”¨ç¨‹åºçš„å»¶è¿Ÿ==ã€‚

2. ==CPU å¤šæ ¸å¯¹ Redis æ€§èƒ½çš„å½±å“==

	> - Redis ä¸»çº¿ç¨‹çš„è¿è¡Œæ—¶ä¿¡æ¯éœ€è¦è¢«==é‡æ–°åŠ è½½åˆ° CPU çš„å¦ä¸€ä¸ªç‰©ç†æ ¸==ä¸Šï¼Œè€Œä¸”æ­¤æ—¶ï¼Œ==CPU çš„å¦ä¸€ä¸ªç‰©ç†æ ¸ä¸Šçš„ L1ã€L2 ç¼“å­˜ä¸­ï¼Œå¹¶æ²¡æœ‰ Redis å®žä¾‹ä¹‹å‰è¿è¡Œæ—¶é¢‘ç¹è®¿é—®çš„æŒ‡ä»¤å’Œæ•°æ®==ï¼Œæ‰€ä»¥ï¼Œè¿™äº›æŒ‡ä»¤å’Œæ•°æ®éƒ½éœ€è¦==é‡æ–°ä»Ž L3 ç¼“å­˜ï¼Œç”šè‡³æ˜¯å†…å­˜ä¸­åŠ è½½==ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/eb72b9f58052d6a6023d3e1dac522157.jpg)
	> - åœ¨ CPU å¤šæ ¸çš„çŽ¯å¢ƒä¸‹ï¼Œé€šè¿‡==ç»‘å®š Redis å®žä¾‹å’Œ CPU æ ¸ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½Ž Redis çš„å°¾å»¶è¿Ÿ==ã€‚

3. ==CPU çš„ NUMA æž¶æž„å¯¹ Redis æ€§èƒ½çš„å½±å“==

	> - ==ç½‘ç»œä¸­æ–­ç¨‹åº==çš„æ•°æ®äº¤äº’ï¼š
	>
	> 	![å¾®ä¿¡æˆªå›¾_20240422200159](Redis.assets/å¾®ä¿¡æˆªå›¾_20240422200159.png)
	>
	> - ==å¦‚æžœç½‘ç»œä¸­æ–­å¤„ç†ç¨‹åºå’Œ Redis å®žä¾‹å„è‡ªæ‰€ç»‘çš„ CPU æ ¸ä¸åœ¨åŒä¸€ä¸ª CPU Socket ä¸Šï¼Œé‚£ä¹ˆï¼ŒRedis å®žä¾‹è¯»å–ç½‘ç»œæ•°æ®æ—¶ï¼Œå°±éœ€è¦è·¨ CPU Socket è®¿é—®å†…å­˜ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šèŠ±è´¹è¾ƒå¤šæ—¶é—´==ã€‚
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/30cd42yy86debc0eb6e7c5b069533ab0.jpg)
	>
	> - ä¸ºäº†==é¿å… Redis è·¨ CPU Socket è®¿é—®ç½‘ç»œæ•°æ®==ï¼Œæˆ‘ä»¬æœ€å¥½==æŠŠç½‘ç»œä¸­æ–­ç¨‹åºå’Œ Redis å®žä¾‹ç»‘åœ¨åŒä¸€ä¸ª CPU Socket ä¸Š==ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒRedis å®žä¾‹å°±å¯ä»¥==ç›´æŽ¥ä»Žæœ¬åœ°å†…å­˜è¯»å–ç½‘ç»œæ•°æ®==äº†ã€‚
	>
	> 	![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/41f02b2afb08ec54249680e8cac30179.jpg)

4. ==ç»‘æ ¸çš„é£Žé™©å’Œè§£å†³æ–¹æ¡ˆ==

	> - ==é£Žé™©==ï¼šæŠŠ Redis å®žä¾‹ç»‘åˆ°ä¸€ä¸ª CPU é€»è¾‘æ ¸ä¸Šæ—¶ï¼Œå°±ä¼šå¯¼è‡´==å­è¿›ç¨‹ã€åŽå°çº¿ç¨‹å’Œ Redis ä¸»çº¿ç¨‹ç«žäº‰ CPU èµ„æº==ï¼Œä¸€æ—¦å­è¿›ç¨‹æˆ–åŽå°çº¿ç¨‹å ç”¨ CPU æ—¶ï¼Œ==ä¸»çº¿ç¨‹å°±ä¼šè¢«é˜»å¡ž==ï¼Œå¯¼è‡´ Redis è¯·æ±‚å»¶è¿Ÿå¢žåŠ ã€‚
	> - ==ç¼“è§£æ–¹æ³•ä¸€==ï¼š==ä¸€ä¸ª Redis å®žä¾‹å¯¹åº”ç»‘ä¸€ä¸ªç‰©ç†æ ¸==
	> 	- æˆ‘ä»¬==ä¸è¦æŠŠä¸€ä¸ªå®žä¾‹å’Œä¸€ä¸ªé€»è¾‘æ ¸ç»‘å®š==ï¼Œè€Œ==è¦å’Œä¸€ä¸ªç‰©ç†æ ¸ç»‘å®š==ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ==æŠŠä¸€ä¸ªç‰©ç†æ ¸çš„ 2 ä¸ªé€»è¾‘æ ¸éƒ½ç”¨ä¸Š==ã€‚
	> - ==ç¼“è§£æ–¹æ³•äºŒ==ï¼š==ä¼˜åŒ– Redis æºç ==
	> 	- ==ä¿®æ”¹ Redis æºç ï¼ŒæŠŠå­è¿›ç¨‹å’ŒåŽå°çº¿ç¨‹ç»‘åˆ°ä¸åŒçš„ CPU æ ¸==ä¸Šã€‚

5. åœ¨ä¸€å°æœ‰ä¸¤ä¸ª CPU Socketï¼ˆæ¯ä¸ª Socket 8 ä¸ªç‰©ç†æ ¸ï¼‰çš„æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬éƒ¨ç½²äº†ä¸€ä¸ªæœ‰ç€ ==8 ä¸ªå®žä¾‹çš„ Redis åˆ‡ç‰‡é›†ç¾¤==ï¼ˆ8 ä¸ªå®žä¾‹éƒ½ä¸ºä¸»èŠ‚ç‚¹ï¼Œæ²¡æœ‰ä¸»å¤‡å…³ç³»ï¼‰ï¼ŒçŽ°åœ¨æœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š

	1. åœ¨åŒä¸€ä¸ª CPU Socket ä¸Šè¿è¡Œ 8 ä¸ªå®žä¾‹ï¼Œå¹¶å’Œ 8 ä¸ª CPU æ ¸ç»‘å®šï¼›
	2. åœ¨ä¸¤ä¸ª CPU Socket ä¸Šå„è¿è¡Œ 4 ä¸ªå®žä¾‹ï¼Œå¹¶å’Œç›¸åº” Socket ä¸Šçš„æ ¸ç»‘å®šã€‚

	å¦‚æžœä¸è€ƒè™‘ç½‘ç»œæ•°æ®è¯»å–çš„å½±å“ï¼Œä½ ä¼šé€‰æ‹©å“ªä¸ªæ–¹æ¡ˆå‘¢ï¼Ÿ

	> - ä½¿ç”¨==ç¬¬äºŒä¸ªæ–¹æ¡ˆ==ï¼Œä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŽŸå› ã€‚
	>
	> 	1. åŒä¸€ä¸ª CPU Socket ä¸Šçš„è¿›ç¨‹ï¼Œä¼šå…±äº« L3 ç¼“å­˜ã€‚å¦‚æžœæŠŠ 8 ä¸ªå®žä¾‹éƒ½éƒ¨ç½²åœ¨åŒä¸€ä¸ª Socket ä¸Šï¼Œå®ƒä»¬ä¼š==ç«žäº‰ L3 ç¼“å­˜==ï¼Œè¿™å°±ä¼š==å¯¼è‡´å®ƒä»¬çš„ L3 ç¼“å­˜å‘½ä¸­çŽ‡é™ä½Ž==ï¼Œå½±å“è®¿é—®æ€§èƒ½ã€‚
	> 	2. åŒä¸€ä¸ª CPU Socket ä¸Šçš„è¿›ç¨‹ï¼Œä¼šä½¿ç”¨åŒä¸€ä¸ª Socket ä¸Šçš„å†…å­˜ç©ºé—´ã€‚8 ä¸ªå®žä¾‹==å…±äº«åŒä¸€ä¸ª Socket ä¸Šçš„å†…å­˜ç©ºé—´ï¼Œè‚¯å®šä¼šç«žäº‰å†…å­˜èµ„æº==ã€‚å¦‚æžœæœ‰å®žä¾‹ä¿å­˜çš„æ•°æ®é‡å¤§ï¼Œå…¶ä»–å®žä¾‹èƒ½ç”¨åˆ°çš„å†…å­˜ç©ºé—´å¯èƒ½å°±ä¸å¤Ÿäº†ï¼Œæ­¤æ—¶ï¼Œ==å…¶ä»–å®žä¾‹å°±ä¼šè·¨ Socket ç”³è¯·å†…å­˜ï¼Œè¿›è€Œé€ æˆè·¨ Socket è®¿é—®å†…å­˜ï¼Œ==é€ æˆå®žä¾‹çš„æ€§èƒ½é™ä½Žã€‚
	>
	> 	å¦å¤–ï¼Œåœ¨==åˆ‡ç‰‡é›†ç¾¤ä¸­==ï¼Œ==ä¸åŒå®žä¾‹é—´é€šè¿‡ç½‘ç»œ==è¿›è¡Œ==æ¶ˆæ¯é€šä¿¡å’Œæ•°æ®è¿ç§»==ï¼Œå¹¶==ä¸ä¼šä½¿ç”¨å…±äº«å†…å­˜ç©ºé—´è¿›è¡Œè·¨å®žä¾‹çš„æ•°æ®è®¿é—®==ã€‚æ‰€ä»¥ï¼Œå³ä½¿==æŠŠä¸åŒçš„å®žä¾‹éƒ¨ç½²åˆ°ä¸åŒçš„ Socket ä¸Š==ï¼Œå®ƒä»¬ä¹‹é—´ä¹Ÿ==ä¸ä¼šå‘ç”Ÿè·¨ Socket å†…å­˜çš„è®¿é—®==ï¼Œ==ä¸ä¼šå—è·¨ Socket å†…å­˜è®¿é—®çš„è´Ÿé¢å½±å“==ã€‚

----



### 21.åˆ é™¤æ•°æ®åŽï¼Œä¸ºä»€ä¹ˆå†…å­˜å ç”¨çŽ‡è¿˜æ˜¯å¾ˆé«˜ï¼Ÿâ­ï¸â­ï¸â­ï¸

1. åšäº†==æ•°æ®åˆ é™¤==ï¼Œæ•°æ®é‡å·²ç»ä¸å¤§äº†ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ top å‘½ä»¤æŸ¥çœ‹æ—¶ï¼Œ==è¿˜ä¼šå‘çŽ° Redis å ç”¨äº†å¾ˆå¤šå†…å­˜==å‘¢ï¼Ÿ

	> å½“æ•°æ®åˆ é™¤åŽï¼Œ==Redis é‡Šæ”¾çš„å†…å­˜ç©ºé—´ä¼šç”±å†…å­˜åˆ†é…å™¨ç®¡ç†==ï¼Œå¹¶==ä¸ä¼šç«‹å³è¿”å›žç»™æ“ä½œç³»ç»Ÿ==ã€‚æ‰€ä»¥ï¼Œæ“ä½œç³»ç»Ÿ==ä»ç„¶ä¼šè®°å½•ç€ç»™ Redis åˆ†é…äº†å¤§é‡å†…å­˜==ã€‚

2. ==å†…å­˜ç¢Žç‰‡å¦‚ä½•å½¢æˆçš„ï¼Ÿ==

	> - ==å†…å› ï¼šå†…å­˜åˆ†é…å™¨çš„åˆ†é…ç­–ç•¥==
	> 	- å†…å­˜åˆ†é…å™¨==ä¸€èˆ¬æŒ‰å›ºå®šå¤§å°æ¥åˆ†é…å†…å­˜==ï¼Œè€Œ==ä¸å®Œå…¨æŒ‰ç…§åº”ç”¨ç¨‹åºç”³è¯·çš„å†…å­˜ç©ºé—´å¤§å°==åˆ†é…ã€‚
	> 	- ä¾‹å¦‚ï¼ŒRedis ç”³è¯·ä¸€ä¸ª 20 å­—èŠ‚çš„ç©ºé—´ä¿å­˜æ•°æ®ï¼Œjemalloc å°±ä¼šåˆ†é… 32 å­—èŠ‚
	> - ==å¤–å› ï¼šé”®å€¼å¯¹å¤§å°ä¸ä¸€æ ·å’Œåˆ æ”¹æ“ä½œ==

3. ==å¦‚ä½•åˆ¤æ–­æ˜¯å¦æœ‰å†…å­˜ç¢Žç‰‡==ï¼Ÿ

	> - Redis æ˜¯å†…å­˜æ•°æ®åº“ï¼Œ==å†…å­˜åˆ©ç”¨çŽ‡çš„é«˜ä½Žç›´æŽ¥å…³ç³»åˆ° Redis è¿è¡Œæ•ˆçŽ‡çš„é«˜ä½Ž==ã€‚
	>
	> - ```java
	> 	INFO memory
	> 	# Memory
	> 	used_memory:1073741736
	> 	used_memory_human:1024.00M
	> 	used_memory_rss:1997159792
	> 	used_memory_rss_human:1.86G
	> 	â€¦
	> 	mem_fragmentation_ratio:1.86
	> 	```
	>
	> - ==å†…å­˜ç¢Žç‰‡çŽ‡==ï¼šä¾‹å¦‚ï¼ŒRedis ç”³è¯·ä½¿ç”¨äº† 100 å­—èŠ‚ï¼ˆused_memoryï¼‰ï¼Œæ“ä½œç³»ç»Ÿå®žé™…åˆ†é…äº† 128 å­—èŠ‚ï¼ˆused_memory_rssï¼‰ï¼Œæ­¤æ—¶ï¼Œmem_fragmentation_ratio å°±æ˜¯ 1.28ã€‚
	>
	> 	```shell
	> 	mem_fragmentation_ratio = used_memory_rss/ used_memory
	> 	```
	>
	> - ==mem_fragmentation_ratio å¤§äºŽ 1.5== ã€‚è¿™è¡¨æ˜Žå†…å­˜ç¢Žç‰‡çŽ‡å·²ç»è¶…è¿‡äº† 50%ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡‡å–ä¸€äº›æŽªæ–½æ¥é™ä½Žå†…å­˜ç¢Žç‰‡çŽ‡äº†ã€‚

4. ==å¦‚ä½•æ¸…ç†å†…å­˜ç¢Žç‰‡==ï¼Ÿ

	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/6480b6af5b2423b271ef3fb59f555842.jpg)
	>
	> - Redis éœ€è¦å¯ç”¨è‡ªåŠ¨å†…å­˜ç¢Žç‰‡æ¸…ç†ï¼Œå¯ä»¥æŠŠ activedefrag é…ç½®é¡¹è®¾ç½®ä¸º yes
	>
	> 	```shell
	> 	config set activedefrag yes
	> 	```
	>
	> - ==å†…å­˜ç¢Žç‰‡è‡ªåŠ¨æ¸…ç†ä¼šå½±å“ Redis æœ¬èº«è¯·æ±‚å¤„ç†çš„æ€§èƒ½==ã€‚
	>
	> - ==å¼€å§‹æ¸…ç†çš„å¿…è¦æ¡ä»¶==ï¼š
	>
	> 	- active-defrag-ignore-bytes 100mbï¼šè¡¨ç¤ºå†…å­˜ç¢Žç‰‡çš„å­—èŠ‚æ•°è¾¾åˆ° 100MB æ—¶ï¼Œå¼€å§‹æ¸…ç†ï¼›
	> 	- active-defrag-threshold-lower 10ï¼šè¡¨ç¤ºå†…å­˜ç¢Žç‰‡ç©ºé—´å æ“ä½œç³»ç»Ÿåˆ†é…ç»™ Redis çš„æ€»ç©ºé—´æ¯”ä¾‹è¾¾åˆ° 10% æ—¶ï¼Œå¼€å§‹æ¸…ç†ã€‚
	>
	> - ==ä¸¤ä¸ªæŽ§åˆ¶ CPU èµ„æºçš„å‚æ•°==ï¼š
	>
	> 	- active-defrag-cycle-min 25ï¼š è¡¨ç¤ºè‡ªåŠ¨æ¸…ç†è¿‡ç¨‹æ‰€ç”¨ CPU æ—¶é—´çš„æ¯”ä¾‹ä¸ä½ŽäºŽ 25%ï¼Œä¿è¯æ¸…ç†èƒ½æ­£å¸¸å¼€å±•ï¼›
	> 	- active-defrag-cycle-max 75ï¼šè¡¨ç¤ºè‡ªåŠ¨æ¸…ç†è¿‡ç¨‹æ‰€ç”¨ CPU æ—¶é—´çš„æ¯”ä¾‹ä¸é«˜äºŽ 75%ï¼Œä¸€æ—¦è¶…è¿‡ï¼Œå°±åœæ­¢æ¸…ç†ï¼Œä»Žè€Œé¿å…åœ¨æ¸…ç†æ—¶ï¼Œå¤§é‡çš„å†…å­˜æ‹·è´é˜»å¡ž Redisï¼Œå¯¼è‡´å“åº”å»¶è¿Ÿå‡é«˜ã€‚

5. ==å°ç»“==ï¼š

	> - ==info memory== å‘½ä»¤æ˜¯ä¸€ä¸ªå¥½å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ ==æŸ¥çœ‹ç¢Žç‰‡çŽ‡çš„æƒ…å†µ==ï¼›
	> - ==ç¢Žç‰‡çŽ‡é˜ˆå€¼==æ˜¯ä¸€ä¸ªå¥½ç»éªŒï¼Œå¯ä»¥å¸®å¿™ä½ æœ‰æ•ˆåœ°==åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œç¢Žç‰‡æ¸…ç†==äº†ï¼›
	> - ==å†…å­˜ç¢Žç‰‡è‡ªåŠ¨æ¸…ç†==æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œå¯ä»¥==é¿å…å› ä¸ºç¢Žç‰‡å¯¼è‡´ Redis çš„å†…å­˜å®žé™…åˆ©ç”¨çŽ‡é™ä½Ž==ã€‚

6. å¦‚æžœ ==mem_fragmentation_ratio å°äºŽ 1==ï¼Œå°±è¡¨æ˜Žï¼Œæ“ä½œç³»ç»Ÿåˆ†é…ç»™ Redis çš„å†…å­˜ç©ºé—´å·²ç»å°äºŽ Redis æ‰€ç”³è¯·çš„ç©ºé—´å¤§å°äº†ï¼Œæ­¤æ—¶ï¼Œè¿è¡Œ Redis å®žä¾‹çš„æœåŠ¡å™¨ä¸Šçš„==å†…å­˜å·²ç»ä¸å¤Ÿç”¨äº†==ï¼Œ==å¯èƒ½å·²ç»å‘ç”Ÿ swap äº†==ã€‚è¿™æ ·ä¸€æ¥ï¼Œå› ä¸º ==Redis å®žä¾‹éœ€è¦åœ¨ç£ç›˜ä¸Šçš„ swap åˆ†åŒºä¸­è¯»å†™æ•°æ®==ï¼Œæ‰€ä»¥é€Ÿåº¦è¾ƒæ…¢ã€‚

----



### 23.ç¬¬11ï½ž21è®²è¯¾åŽæ€è€ƒé¢˜ç­”æ¡ˆåŠå¸¸è§é—®é¢˜ç­”ç–‘â­ï¸â­ï¸â­ï¸â­ï¸

1. ==é—®é¢˜ 1ï¼šå¦‚ä½•ä½¿ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—å’Œ latency monitor æŽ’æŸ¥æ‰§è¡Œæ…¢çš„æ“ä½œï¼Ÿ==

	> - åœ¨ä½¿ç”¨==æ…¢æŸ¥è¯¢æ—¥å¿—==å‰ï¼Œæˆ‘ä»¬éœ€è¦==è®¾ç½®ä¸¤ä¸ªå‚æ•°==ã€‚
	>
	> 	- ==slowlog-log-slower-than==ï¼šæ…¢æŸ¥è¯¢æ—¥å¿—å¯¹æ‰§è¡Œæ—¶é—´å¤§äºŽå¤šå°‘å¾®ç§’çš„å‘½ä»¤è¿›è¡Œè®°å½•ã€‚
	> 	- ==slowlog-max-len==ï¼šè¿™ä¸ªå‚æ•°è¡¨ç¤ºï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—æœ€å¤šèƒ½è®°å½•å¤šå°‘æ¡å‘½ä»¤è®°å½•ã€‚é»˜è®¤æ˜¯ 128ã€‚ä¸€èˆ¬å»ºè®®è®¾ç½®ä¸º 1000 å·¦å³ï¼Œè¿™æ ·æ—¢å¯ä»¥å¤šè®°å½•äº›æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œæ–¹ä¾¿æŽ’æŸ¥ï¼Œä¹Ÿå¯ä»¥é¿å…å†…å­˜å¼€é”€ã€‚
	>
	> - ```java
	> 	SLOWLOG GET 1
	> 	1) 1) (integer) 33           //æ¯æ¡æ—¥å¿—çš„å”¯ä¸€IDç¼–å·
	> 	   2) (integer) 1600990583   //å‘½ä»¤æ‰§è¡Œæ—¶çš„æ—¶é—´æˆ³
	> 	   3) (integer) 20906        //å‘½ä»¤æ‰§è¡Œçš„æ—¶é•¿ï¼Œå•ä½æ˜¯å¾®ç§’
	> 	   4) 1) "keys"               //å…·ä½“çš„æ‰§è¡Œå‘½ä»¤å’Œå‚æ•°
	> 	      2) "abc*"
	> 	   5) "127.0.0.1:54793"      //å®¢æˆ·ç«¯çš„IPå’Œç«¯å£å·
	> 	   6) ""                     //å®¢æˆ·ç«¯çš„åç§°ï¼Œæ­¤å¤„ä¸ºç©º
	> 	```
	>
	> - å¦‚æžœæˆ‘ä»¬æƒ³æŸ¥çœ‹æ›´å¤šçš„æ…¢æ—¥å¿—ï¼Œåªè¦æŠŠ SLOWLOG GET åŽé¢çš„æ•°å­—å‚æ•°æ”¹ä¸ºæƒ³æŸ¥çœ‹çš„æ—¥å¿—æ¡æ•°ã€‚
	>
	> - ä½¿ç”¨ ==latency monitorå·¥å…·==ï¼š
	>
	> - æˆ‘ä»¬å¯ä»¥æŠŠ latency monitor ç›‘æŽ§çš„å‘½ä»¤æ‰§è¡Œæ—¶é•¿é˜ˆå€¼è®¾ä¸º 1000 å¾®ç§’ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
	>
	> 	```java
	> 	config set latency-monitor-threshold 1000
	> 	```
	>
	> 	```java
	> 	latency latest
	> 	1) 1) "command"
	> 	   2) (integer) 1600991500    //å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´æˆ³
	> 	   3) (integer) 2500           //æœ€è¿‘çš„è¶…è¿‡é˜ˆå€¼çš„å»¶è¿Ÿ
	> 	   4) (integer) 10100          //æœ€å¤§çš„è¶…è¿‡é˜ˆå€¼çš„å»¶è¿Ÿ
	> 	```

2. ==é—®é¢˜ 2ï¼šå¦‚ä½•æŽ’æŸ¥ Redis çš„ bigkeyï¼Ÿ==

	> - ```java
	> 	./redis-cli --bigkeys
	> 													
	> 	-------- summary -------
	> 	Sampled 32 keys in the keyspace!
	> 	Total key length in bytes is 184 (avg len 5.75)
	> 													
	> 	//ç»Ÿè®¡æ¯ç§æ•°æ®ç±»åž‹ä¸­å…ƒç´ ä¸ªæ•°æœ€å¤šçš„bigkey
	> 	Biggest   list found 'product1' has 8 items
	> 	Biggest   hash found 'dtemp' has 5 fields
	> 	Biggest string found 'page2' has 28 bytes
	> 	Biggest stream found 'mqstream' has 4 entries
	> 	Biggest    set found 'userid' has 5 members
	> 	Biggest   zset found 'device:temperature' has 6 members
	> 													
	> 	//ç»Ÿè®¡æ¯ç§æ•°æ®ç±»åž‹çš„æ€»é”®å€¼ä¸ªæ•°ï¼Œå æ‰€æœ‰é”®å€¼ä¸ªæ•°çš„æ¯”ä¾‹ï¼Œä»¥åŠå¹³å‡å¤§å°
	> 	4 lists with 15 items (12.50% of keys, avg size 3.75)
	> 	5 hashs with 14 fields (15.62% of keys, avg size 2.80)
	> 	10 strings with 68 bytes (31.25% of keys, avg size 6.80)
	> 	1 streams with 4 entries (03.12% of keys, avg size 4.00)
	> 	7 sets with 19 members (21.88% of keys, avg size 2.71)
	> 	5 zsets with 17 members (15.62% of keys, avg size 3.40)
	> 	```
	>
	> - è¿™ä¸ªå·¥å…·æ˜¯é€šè¿‡==æ‰«ææ•°æ®åº“æ¥æŸ¥æ‰¾ bigkey çš„==ï¼Œæ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹ Redis å®žä¾‹çš„æ€§èƒ½äº§ç”Ÿå½±å“ã€‚å¦‚æžœä½ åœ¨ä½¿ç”¨ä¸»ä»Žé›†ç¾¤ï¼Œæˆ‘==å»ºè®®ä½ åœ¨ä»ŽèŠ‚ç‚¹ä¸Šæ‰§è¡Œè¯¥å‘½ä»¤==ã€‚
	>
	> - Redis è‡ªå¸¦çš„-\-bigkeys é€‰é¡¹æŽ’æŸ¥ bigkeyï¼Œæœ‰==ä¸¤ä¸ªä¸è¶³==çš„åœ°æ–¹ï¼š
	>
	> 	1. è¿™ä¸ªæ–¹æ³•==åªèƒ½è¿”å›žæ¯ç§ç±»åž‹ä¸­æœ€å¤§çš„é‚£ä¸ª bigkey==ï¼Œæ— æ³•å¾—åˆ°å¤§å°æŽ’åœ¨==å‰ N ä½==çš„ bigkeyï¼›
	> 	2. å¯¹äºŽé›†åˆç±»åž‹æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•==åªç»Ÿè®¡é›†åˆå…ƒç´ ä¸ªæ•°çš„å¤šå°‘==ï¼Œ==è€Œä¸æ˜¯å®žé™…å ç”¨çš„å†…å­˜é‡==ã€‚ä½†æ˜¯ï¼Œ==ä¸€ä¸ªé›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°å¤šï¼Œå¹¶ä¸ä¸€å®šå ç”¨çš„å†…å­˜å°±å¤š==ã€‚å› ä¸ºï¼Œæœ‰å¯èƒ½æ¯ä¸ªå…ƒç´ å ç”¨çš„å†…å­˜å¾ˆå°ï¼Œè¿™æ ·çš„è¯ï¼Œå³ä½¿å…ƒç´ ä¸ªæ•°æœ‰å¾ˆå¤šï¼Œæ€»å†…å­˜å¼€é”€ä¹Ÿä¸å¤§ã€‚

---



### 24.æ—è·¯ç¼“å­˜ï¼šRedisæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿâ­ï¸â­ï¸â­ï¸â­ï¸

1.  å¦‚æžœ Redis åšç¼“å­˜æ—¶å‡ºçŽ°äº†é—®é¢˜ï¼Œæ¯”å¦‚è¯´==ç¼“å­˜å¤±æ•ˆ==ï¼Œé‚£ä¹ˆï¼Œ==å¤§é‡è¯·æ±‚å°±ä¼šç›´æŽ¥ç§¯åŽ‹åˆ°æ•°æ®åº“å±‚==ï¼Œå¿…ç„¶ä¼šç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„åŽ‹åŠ›ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´æ•°æ®åº“å®•æœºæˆ–æ˜¯æ•…éšœã€‚

2. ==Redis ç¼“å­˜å¤„ç†è¯·æ±‚çš„ä¸¤ç§æƒ…å†µ==

	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/6b0b489ec0c1c5049c8df84d77fa243d.jpg)

3. ==Redis ä½œä¸ºæ—è·¯ç¼“å­˜çš„ä½¿ç”¨æ“ä½œ==

	> - Redis ç§°ä¸º==æ—è·¯ç¼“å­˜==ï¼š==è¯»å–ç¼“å­˜ã€è¯»å–æ•°æ®åº“å’Œæ›´æ–°ç¼“å­˜==çš„æ“ä½œ==éƒ½éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­æ¥å®Œæˆ==ã€‚
	> - æˆ‘ä»¬åœ¨==æž„å»ºè®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿæ—¶==ï¼Œå·²ç»==æŠŠ LLC å’Œ page cache æ”¾åœ¨äº†åº”ç”¨ç¨‹åºçš„æ•°æ®è®¿é—®è·¯å¾„==ä¸Šï¼Œåº”ç”¨ç¨‹åºè®¿é—®æ•°æ®æ—¶==ç›´æŽ¥å°±èƒ½ç”¨ä¸Šç¼“å­˜==ã€‚
	> - æˆ‘ä»¬éœ€è¦==åœ¨åº”ç”¨ç¨‹åºä¸­å¢žåŠ ä¸‰æ–¹é¢çš„ä»£ç ==ï¼š
	> 	- å½“åº”ç”¨ç¨‹åº==éœ€è¦è¯»å–æ•°æ®==æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»£ç ä¸­==æ˜¾å¼è°ƒç”¨ Redis çš„ GET æ“ä½œæŽ¥å£==ï¼Œè¿›è¡ŒæŸ¥è¯¢ï¼›
	> 	- å¦‚æžœ==ç¼“å­˜ç¼ºå¤±==äº†ï¼Œåº”ç”¨ç¨‹åºéœ€è¦å†==å’Œæ•°æ®åº“è¿žæŽ¥==ï¼Œä»Žæ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼›
	> 	- å½“ç¼“å­˜ä¸­çš„==æ•°æ®éœ€è¦æ›´æ–°==æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­==æ˜¾å¼åœ°è°ƒç”¨ SET æ“ä½œæŽ¥å£==ï¼ŒæŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç¼“å­˜ã€‚

4. ==ç¼“å­˜çš„ç±»åž‹==ï¼šåªè¯»ç¼“å­˜å’Œè¯»å†™ç¼“å­˜ã€‚

5. ==åªè¯»ç¼“å­˜==

	> - æ‰€æœ‰çš„æ•°æ®==å†™è¯·æ±‚==ï¼Œä¼š==ç›´æŽ¥å‘å¾€åŽç«¯çš„æ•°æ®åº“==ï¼Œåœ¨æ•°æ®åº“ä¸­å¢žåˆ æ”¹ã€‚å¯¹äºŽåˆ æ”¹çš„æ•°æ®æ¥è¯´ï¼Œå¦‚æžœ Redis å·²ç»ç¼“å­˜äº†ç›¸åº”çš„æ•°æ®ï¼Œåº”ç”¨==éœ€è¦æŠŠè¿™äº›ç¼“å­˜çš„æ•°æ®åˆ é™¤==ï¼ŒRedis ä¸­å°±æ²¡æœ‰è¿™äº›æ•°æ®äº†ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/464ea24a098c87b9d292cf61a2b2fecd.jpg)
	> - åªè¯»ç¼“å­˜ç›´æŽ¥åœ¨æ•°æ®åº“ä¸­æ›´æ–°æ•°æ®çš„==å¥½å¤„==æ˜¯ï¼Œæ‰€æœ‰==æœ€æ–°çš„æ•°æ®éƒ½åœ¨æ•°æ®åº“==ä¸­ï¼Œè€Œ==æ•°æ®åº“æ˜¯æä¾›æ•°æ®å¯é æ€§ä¿éšœ==çš„ï¼Œè¿™äº›æ•°æ®ä¸ä¼šæœ‰ä¸¢å¤±çš„é£Žé™©ã€‚

6. ==è¯»å†™ç¼“å­˜==

	> - ==æ‰€æœ‰çš„å†™è¯·æ±‚ä¹Ÿä¼šå‘é€åˆ°ç¼“å­˜==ï¼Œåœ¨==ç¼“å­˜ä¸­ç›´æŽ¥å¯¹æ•°æ®è¿›è¡Œå¢žåˆ æ”¹æ“ä½œ==ã€‚
	> - ä¸€æ—¦å‡ºçŽ°==æ–­ç”µæˆ–å®•æœº==ï¼Œå†…å­˜ä¸­çš„==æœ€æ–°æ•°æ®å¯èƒ½ä¼šä¸¢å¤±==ï¼Œç»™åº”ç”¨ä¸šåŠ¡å¸¦æ¥é£Žé™©ã€‚
	> - æˆ‘ä»¬ä¼šæœ‰==åŒæ­¥ç›´å†™==å’Œ==å¼‚æ­¥å†™å›ž==ä¸¤ç§ç­–ç•¥ã€‚å…¶ä¸­ï¼Œ==åŒæ­¥ç›´å†™ç­–ç•¥ä¼˜å…ˆä¿è¯æ•°æ®å¯é æ€§==ï¼Œè€Œ==å¼‚æ­¥å†™å›žç­–ç•¥ä¼˜å…ˆæä¾›å¿«é€Ÿå“åº”==ã€‚
	> - ==åŒæ­¥ç›´å†™==æ˜¯æŒ‡ï¼Œå†™è¯·æ±‚å‘ç»™ç¼“å­˜çš„åŒæ—¶ï¼Œ==ä¹Ÿä¼šå‘ç»™åŽç«¯æ•°æ®åº“è¿›è¡Œå¤„ç†==ï¼Œç­‰åˆ°==ç¼“å­˜å’Œæ•°æ®åº“éƒ½å†™å®Œæ•°æ®==ï¼Œ==æ‰ç»™å®¢æˆ·ç«¯è¿”å›ž==ã€‚è¿™æ ·ï¼Œå³ä½¿ç¼“å­˜å®•æœºæˆ–å‘ç”Ÿæ•…éšœï¼Œ==æœ€æ–°çš„æ•°æ®ä»ç„¶ä¿å­˜åœ¨æ•°æ®åº“ä¸­==ï¼Œè¿™å°±æä¾›äº†æ•°æ®å¯é æ€§ä¿è¯ã€‚
	> - ==å¼‚æ­¥å†™å›ž==ç­–ç•¥ï¼Œæ‰€æœ‰å†™è¯·æ±‚éƒ½==å…ˆåœ¨ç¼“å­˜ä¸­å¤„ç†==ã€‚ç­‰åˆ°è¿™äº›å¢žæ”¹çš„æ•°æ®è¦==è¢«ä»Žç¼“å­˜ä¸­æ·˜æ±°å‡ºæ¥æ—¶==ï¼Œç¼“å­˜å°†å®ƒä»¬==å†™å›žåŽç«¯æ•°æ®åº“==ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¤„ç†è¿™äº›æ•°æ®çš„æ“ä½œæ˜¯åœ¨ç¼“å­˜ä¸­è¿›è¡Œçš„ï¼Œå¾ˆå¿«å°±èƒ½å®Œæˆã€‚åªä¸è¿‡ï¼Œå¦‚æžœå‘ç”Ÿäº†æŽ‰ç”µï¼Œè€Œå®ƒä»¬è¿˜æ²¡æœ‰è¢«å†™å›žæ•°æ®åº“ï¼Œå°±ä¼šæœ‰==ä¸¢å¤±çš„é£Žé™©==äº†ã€‚
	> - ![img](https://shuaidi-picture-1257337429.cos.ap-guangzhou.myqcloud.com/img/009d055bb91d42c28b9316c649f87f66.jpg)

7. ==ç¼“å­˜çš„ä¸¤ä¸ªç‰¹å¾==ï¼Œåˆ†åˆ«æ˜¯åœ¨åˆ†å±‚ç³»ç»Ÿä¸­ï¼Œæ•°æ®æš‚å­˜åœ¨å¿«é€Ÿå­ç³»ç»Ÿä¸­æœ‰åŠ©äºŽåŠ é€Ÿè®¿é—®ï¼›ç¼“å­˜å®¹é‡æœ‰é™ï¼Œç¼“å­˜å†™æ»¡æ—¶ï¼Œæ•°æ®éœ€è¦è¢«æ·˜æ±°ã€‚è€Œ Redis å¤©ç„¶å°±å…·æœ‰==é«˜æ€§èƒ½è®¿é—®==å’Œ==æ•°æ®æ·˜æ±°æœºåˆ¶==ï¼Œæ­£å¥½ç¬¦åˆç¼“å­˜çš„è¿™ä¸¤ä¸ªç‰¹å¾çš„è¦æ±‚ï¼Œæ‰€ä»¥éžå¸¸é€‚åˆç”¨ä½œç¼“å­˜ã€‚

----



### 25.æ›¿æ¢ç­–ç•¥ï¼šç¼“å­˜æ»¡äº†æ€Žä¹ˆåŠžï¼Ÿâ­ï¸â­ï¸â­ï¸â­ï¸â­ï¸

1. ä¸¾ä¸ªæ —å­ï¼šåœ¨å•†å“ä¿ƒé”€æ—¶ï¼Œçƒ­é—¨å•†å“çš„ä¿¡æ¯å¯èƒ½åªå åˆ°æ€»å•†å“æ•°æ®ä¿¡æ¯é‡çš„ 5%ï¼Œè€Œè¿™äº›å•†å“ä¿¡æ¯æ‰¿è½½çš„å¯èƒ½æ˜¯è¶…è¿‡ 90% çš„è®¿é—®è¯·æ±‚ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬åªè¦ç¼“å­˜è¿™ 5% çš„æ•°æ®ï¼Œå°±èƒ½èŽ·å¾—å¾ˆå¥½çš„æ€§èƒ½æ”¶ç›Šã€‚

2. ==å»ºè®®æŠŠç¼“å­˜å®¹é‡è®¾ç½®ä¸ºæ€»æ•°æ®é‡çš„ 15% åˆ° 30%ï¼Œå…¼é¡¾è®¿é—®æ€§èƒ½å’Œå†…å­˜ç©ºé—´å¼€é”€==ã€‚

3. ==è®¾å®šç¼“å­˜çš„å¤§å°==ï¼š

	```bash
	CONFIG SET maxmemory 4gb
	```

4. ==Redis ç¼“å­˜æœ‰å“ªäº›æ·˜æ±°ç­–ç•¥==ï¼Ÿ

	> - ![img](Redis.assets/04bdd13b760016ec3b30f4b02e133df6.jpg)
	> -  volatile-randomã€volatile-ttlã€volatile-lru å’Œ volatile-lfu è¿™å››ç§æ·˜æ±°ç­–ç•¥ã€‚å®ƒä»¬ç­›é€‰çš„å€™é€‰æ•°æ®èŒƒå›´ï¼Œè¢«é™åˆ¶åœ¨==å·²ç»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼ˆåªæ·˜æ±°è®¾ç½®äº†EXPIREçš„é”®å€¼å¯¹ï¼‰==ä¸Šã€‚ä¹Ÿæ­£å› ä¸ºæ­¤ï¼Œ==å³ä½¿ç¼“å­˜æ²¡æœ‰å†™æ»¡ï¼Œè¿™äº›æ•°æ®å¦‚æžœè¿‡æœŸäº†ï¼Œä¹Ÿä¼šè¢«åˆ é™¤==ã€‚
	> - volatile-ttlã€volatile-randomã€volatile-lruã€volatile-lfu è¿™å››ç§ç­–ç•¥æ·˜æ±°çš„æ˜¯è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ï¼Œallkeys-lruã€allkeys-randomã€allkeys-lfu è¿™ä¸‰ç§æ·˜æ±°ç­–ç•¥çš„å¤‡é€‰æ·˜æ±°æ•°æ®èŒƒå›´ï¼Œå°±==æ‰©å¤§åˆ°äº†æ‰€æœ‰é”®å€¼å¯¹==ï¼Œ==æ— è®ºè¿™äº›é”®å€¼å¯¹æ˜¯å¦è®¾ç½®äº†è¿‡æœŸæ—¶é—´==ã€‚

5. ==Redis ä¸­ LRU ç®—æ³•çš„ä¼˜åŒ–==

	> - åœ¨ Redis ä¸­ï¼ŒLRU ç®—æ³•è¢«åšäº†ç®€åŒ–ï¼Œä»¥==å‡è½»æ•°æ®æ·˜æ±°å¯¹ç¼“å­˜æ€§èƒ½çš„å½±å“ï¼ˆå‡å°‘ä½¿ç”¨çš„é¢å¤–ç©ºé—´ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ï¼‰==ã€‚å…·ä½“æ¥è¯´ï¼ŒRedis é»˜è®¤ä¼š==è®°å½•æ¯ä¸ªæ•°æ®çš„æœ€è¿‘ä¸€æ¬¡è®¿é—®çš„æ—¶é—´æˆ³==ï¼ˆç”±==é”®å€¼å¯¹æ•°æ®ç»“æž„ RedisObject ä¸­çš„ lru å­—æ®µè®°å½•==ï¼‰ã€‚ç„¶åŽï¼ŒRedis åœ¨å†³å®šæ·˜æ±°çš„æ•°æ®æ—¶ï¼Œç¬¬ä¸€æ¬¡ä¼š==éšæœºé€‰å‡º N ä¸ªæ•°æ®ï¼ŒæŠŠå®ƒä»¬ä½œä¸ºä¸€ä¸ªå€™é€‰é›†åˆ==ã€‚æŽ¥ä¸‹æ¥ï¼ŒRedis ä¼šæ¯”è¾ƒè¿™ N ä¸ªæ•°æ®çš„ lru å­—æ®µï¼Œ==æŠŠ lru å­—æ®µå€¼æœ€å°çš„æ•°æ®ä»Žç¼“å­˜ä¸­æ·˜æ±°==å‡ºåŽ»ã€‚
	>
	> - æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¯ä»¥è®© Redis ==é€‰å‡º 100 ä¸ªæ•°æ®ä½œä¸ºå€™é€‰æ•°æ®é›†==ï¼š
	>
	> 	```bash
	> 	CONFIG SET maxmemory-samples 100
	> 	```
	>
	> - å½“éœ€è¦==å†æ¬¡æ·˜æ±°æ•°æ®æ—¶==ï¼ŒRedis éœ€è¦æŒ‘é€‰æ•°æ®è¿›å…¥ç¬¬ä¸€æ¬¡æ·˜æ±°æ—¶åˆ›å»ºçš„å€™é€‰é›†åˆã€‚è¿™å„¿çš„æŒ‘é€‰æ ‡å‡†æ˜¯ï¼šèƒ½è¿›å…¥å€™é€‰é›†åˆçš„æ•°æ®çš„ lru å­—æ®µå€¼å¿…é¡»å°äºŽå€™é€‰é›†åˆä¸­æœ€å°çš„ lru å€¼ã€‚
	
6. ==ä½¿ç”¨å»ºè®®==

      > - ==ä¼˜å…ˆä½¿ç”¨ allkeys-lru ç­–ç•¥==ã€‚è¿™æ ·ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ LRU è¿™ä¸€ç»å…¸ç¼“å­˜ç®—æ³•çš„ä¼˜åŠ¿ï¼ŒæŠŠæœ€è¿‘æœ€å¸¸è®¿é—®çš„æ•°æ®ç•™åœ¨ç¼“å­˜ä¸­ï¼Œæå‡åº”ç”¨çš„è®¿é—®æ€§èƒ½ã€‚
      > - å¦‚æžœä½ çš„ä¸šåŠ¡æ•°æ®ä¸­æœ‰æ˜Žæ˜¾çš„å†·çƒ­æ•°æ®åŒºåˆ†ï¼Œæˆ‘å»ºè®®ä½ ä½¿ç”¨ allkeys-lru ç­–ç•¥ã€‚å¦‚æžœä¸šåŠ¡åº”ç”¨ä¸­çš„æ•°æ®è®¿é—®é¢‘çŽ‡ç›¸å·®ä¸å¤§ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„å†·çƒ­æ•°æ®åŒºåˆ†ï¼Œå»ºè®®ä½¿ç”¨ allkeys-random ç­–ç•¥ï¼Œéšæœºé€‰æ‹©æ·˜æ±°çš„æ•°æ®å°±è¡Œã€‚
      > - ==å¦‚æžœä½ çš„ä¸šåŠ¡ä¸­æœ‰ç½®é¡¶çš„éœ€æ±‚==ï¼Œæ¯”å¦‚ç½®é¡¶æ–°é—»ã€ç½®é¡¶è§†é¢‘ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨ volatile-lru ç­–ç•¥ï¼ŒåŒæ—¶==ä¸ç»™è¿™äº›ç½®é¡¶æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´==ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›==éœ€è¦ç½®é¡¶çš„æ•°æ®ä¸€ç›´ä¸ä¼šè¢«åˆ é™¤ï¼Œè€Œå…¶ä»–æ•°æ®ä¼šåœ¨è¿‡æœŸæ—¶æ ¹æ® LRU è§„åˆ™è¿›è¡Œç­›é€‰==ã€‚

7. ==å¦‚ä½•å¤„ç†è¢«æ·˜æ±°çš„æ•°æ®==ï¼Ÿ

      > - ![img](Redis.assets/953e48912yy9515abf9db588d447cc5e.jpg)
      > - ==å¯¹äºŽ Redis æ¥è¯´ï¼Œå³ä½¿æ·˜æ±°çš„æ•°æ®æ˜¯è„æ•°æ®ï¼ŒRedis ä¹Ÿä¸ä¼šæŠŠå®ƒä»¬å†™å›žæ•°æ®åº“==ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ Redis ç¼“å­˜æ—¶ï¼Œå¦‚æžœæ•°æ®è¢«ä¿®æ”¹äº†ï¼Œéœ€è¦åœ¨æ•°æ®ä¿®æ”¹æ—¶å°±å°†å®ƒå†™å›žæ•°æ®åº“ã€‚==å¦åˆ™ï¼Œè¿™ä¸ªè„æ•°æ®è¢«æ·˜æ±°æ—¶ï¼Œä¼šè¢« Redis åˆ é™¤ï¼Œè€Œæ•°æ®åº“é‡Œä¹Ÿæ²¡æœ‰æœ€æ–°çš„æ•°æ®äº†==ã€‚

---



### 26.ç¼“å­˜å¼‚å¸¸ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•è§£å†³ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Ÿâ­ï¸â­ï¸â­ï¸â­ï¸â­ï¸

1. ==ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´æ˜¯å¦‚ä½•å‘ç”Ÿçš„==ï¼Ÿ

	> - å¯¹äºŽè¯»å†™ç¼“å­˜æ¥è¯´ï¼Œè¦æƒ³ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸­çš„æ•°æ®ä¸€è‡´ï¼Œå°±è¦é‡‡ç”¨åŒæ­¥ç›´å†™ç­–ç•¥ã€‚ä¸è¿‡ï¼Œ==æˆ‘ä»¬è¦åœ¨ä¸šåŠ¡åº”ç”¨ä¸­ä½¿ç”¨äº‹åŠ¡æœºåˆ¶ï¼Œæ¥ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ›´æ–°å…·æœ‰åŽŸå­æ€§==ã€‚
	>
	> - ä¸‹é¢è¯´è¯´==åªè¯»ç¼“å­˜==çš„æƒ…å†µï¼š
	>
	> - ==æ–°å¢žæ•°æ®ä¸ä¼šè§¦å‘ä¸ä¸€è‡´==ï¼Œä½†æ˜¯==åˆ æ”¹æ•°æ®ä¼šè§¦å‘æ•°æ®ä¸ä¸€è‡´==ã€‚
	>
	> - ![img](Redis.assets/15ae0147459ecc46436f35a0f3e5yydc.jpg)
	>
	> - å…³äºŽ==ä¿®æ”¹ç¼“å­˜å’Œæ›´æ–°æ•°æ®åº“çš„åŽŸå­æ€§çš„æŽ¢è®¨==ï¼š
	>
	> 	![img](Redis.assets/b305a6355c9da145e4d1f86d23f4f0ae.jpg)
	>
	> 	---
	>
	> 	![img](Redis.assets/767b4b2b1bafffd9a4b6368f05930a77.jpg)
	>
	> - ![img](Redis.assets/2c376b536aff9d14d8606499f401cdac.jpg)
	
2. ==å¦‚ä½•è§£å†³æ•°æ®ä¸ä¸€è‡´é—®é¢˜==ï¼Ÿ

      > - ==é‡è¯•æœºåˆ¶==ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥==æŠŠè¦åˆ é™¤çš„ç¼“å­˜å€¼æˆ–è€…æ˜¯è¦æ›´æ–°çš„æ•°æ®åº“å€¼æš‚å­˜åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­==ï¼ˆä¾‹å¦‚ä½¿ç”¨ Kafka æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€‚å½“åº”ç”¨==æ²¡æœ‰èƒ½å¤ŸæˆåŠŸåœ°åˆ é™¤ç¼“å­˜å€¼æˆ–è€…æ˜¯æ›´æ–°æ•°æ®åº“å€¼æ—¶==ï¼Œå¯ä»¥==ä»Žæ¶ˆæ¯é˜Ÿåˆ—ä¸­é‡æ–°è¯»å–è¿™äº›å€¼==ï¼Œç„¶åŽ==å†æ¬¡è¿›è¡Œ==åˆ é™¤æˆ–æ›´æ–°ã€‚
      > - ==å¦‚æžœèƒ½å¤ŸæˆåŠŸåœ°åˆ é™¤æˆ–æ›´æ–°ï¼Œæˆ‘ä»¬å°±è¦æŠŠè¿™äº›å€¼ä»Žæ¶ˆæ¯é˜Ÿåˆ—ä¸­åŽ»é™¤ï¼Œä»¥å…é‡å¤æ“ä½œ==ã€‚å¦‚æžœé‡è¯•==è¶…è¿‡çš„ä¸€å®šæ¬¡æ•°==ï¼Œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸï¼Œæˆ‘ä»¬å°±éœ€è¦==å‘ä¸šåŠ¡å±‚å‘é€æŠ¥é”™ä¿¡æ¯==äº†ã€‚
      > - ![img](Redis.assets/74a66b9ce185d7c5b53986fc522dfcab.jpg)

3. ==æƒ…å†µä¸€ï¼šå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“==ã€‚

      > - ![img](Redis.assets/857c2b5449d9a04de6fe93yy1e355c12.jpg)

4. ==å»¶è¿ŸåŒåˆ ==ï¼š

      > - ==åœ¨çº¿ç¨‹ A æ›´æ–°å®Œæ•°æ®åº“å€¼ä»¥åŽï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒå…ˆ sleep ä¸€å°æ®µæ—¶é—´ï¼Œå†è¿›è¡Œä¸€æ¬¡ç¼“å­˜åˆ é™¤æ“ä½œ==ã€‚
      >
      > - ä¹‹æ‰€ä»¥è¦åŠ ä¸Š sleep çš„è¿™æ®µæ—¶é—´ï¼Œå°±æ˜¯ä¸ºäº†==è®©çº¿ç¨‹ B èƒ½å¤Ÿå…ˆä»Žæ•°æ®åº“è¯»å–æ•°æ®ï¼Œå†æŠŠç¼ºå¤±çš„æ•°æ®å†™å…¥ç¼“å­˜ï¼Œç„¶åŽï¼Œçº¿ç¨‹ A å†è¿›è¡Œåˆ é™¤==ã€‚æ‰€ä»¥ï¼Œçº¿ç¨‹ A sleep çš„æ—¶é—´ï¼Œå°±éœ€è¦å¤§äºŽçº¿ç¨‹ B è¯»å–æ•°æ®å†å†™å…¥ç¼“å­˜çš„æ—¶é—´ã€‚
      >
      > - ```java
      > 	redis.delKey(X)
      > 	db.update(X)
      > 	Thread.sleep(N)
      > 	redis.delKey(X)
      > 	```

5. ==æƒ…å†µäºŒï¼šå…ˆæ›´æ–°æ•°æ®åº“å€¼ï¼Œå†åˆ é™¤ç¼“å­˜å€¼==ã€‚

      > - ![img](Redis.assets/a1c66ee114yyc9f37f2a35f21b46010b.jpg)

6. ==è§£å†³æ–¹æ³•==ï¼š

      > - åˆ é™¤ç¼“å­˜å€¼æˆ–æ›´æ–°æ•°æ®åº“==å¤±è´¥è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´==ï¼Œä½ å¯ä»¥ä½¿ç”¨==é‡è¯•æœºåˆ¶==ç¡®ä¿åˆ é™¤æˆ–æ›´æ–°æ“ä½œæˆåŠŸã€‚
      > - åˆ é™¤ç¼“å­˜å€¼ã€æ›´æ–°æ•°æ®åº“çš„è¿™ä¸¤æ­¥æ“ä½œä¸­ï¼Œæœ‰å…¶ä»–çº¿ç¨‹çš„==å¹¶å‘è¯»æ“ä½œï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹è¯»å–åˆ°æ—§å€¼==ï¼Œåº”å¯¹æ–¹æ¡ˆæ˜¯==å»¶è¿ŸåŒåˆ ==ã€‚

7. ==å°ç»“==ï¼š

      > - ![img](Redis.assets/11ae5e620c63de76448bc658fe6a496f.jpg)
      > - ==ä¼˜å…ˆä½¿ç”¨å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜çš„æ–¹æ³•==ï¼ŒåŽŸå› ä¸»è¦æœ‰ä¸¤ä¸ªï¼š
      > 	- å…ˆåˆ é™¤ç¼“å­˜å€¼å†æ›´æ–°æ•°æ®åº“ï¼Œæœ‰==å¯èƒ½å¯¼è‡´è¯·æ±‚å› ç¼“å­˜ç¼ºå¤±è€Œè®¿é—®æ•°æ®åº“==ï¼Œç»™==æ•°æ®åº“å¸¦æ¥åŽ‹åŠ›==ï¼›
      > 	- å¦‚æžœä¸šåŠ¡åº”ç”¨ä¸­è¯»å–æ•°æ®åº“å’Œå†™ç¼“å­˜çš„æ—¶é—´ä¸å¥½ä¼°ç®—ï¼Œé‚£ä¹ˆ==å»¶è¿ŸåŒåˆ ä¸­çš„ç­‰å¾…æ—¶é—´å°±ä¸å¥½è®¾ç½®==ã€‚
      > - å½“ä½¿ç”¨==å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜æ—¶==ï¼Œå¦‚æžœä¸šåŠ¡å±‚è¦æ±‚å¿…é¡»è¯»å–ä¸€è‡´çš„æ•°æ®ï¼Œå°±éœ€è¦åœ¨==æ›´æ–°æ•°æ®åº“æ—¶ï¼Œå…ˆåœ¨ Redis ç¼“å­˜å®¢æˆ·ç«¯æš‚å­˜å¹¶å‘è¯»è¯·æ±‚==ï¼Œç­‰==æ•°æ®åº“æ›´æ–°å®Œã€ç¼“å­˜å€¼åˆ é™¤åŽï¼Œå†è¯»å–æ•°æ®==ï¼Œä»Žè€Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

---



### 27.ç¼“å­˜å¼‚å¸¸ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€éš¾é¢˜ï¼Ÿâ­ï¸â­ï¸â­ï¸â­ï¸â­ï¸

1. ==ç¼“å­˜é›ªå´©==

	> - ç¼“å­˜é›ªå´©æ˜¯æŒ‡==å¤§é‡çš„åº”ç”¨è¯·æ±‚æ— æ³•åœ¨ Redis ç¼“å­˜ä¸­è¿›è¡Œå¤„ç†==ï¼Œç´§æŽ¥ç€ï¼Œåº”ç”¨å°†==å¤§é‡è¯·æ±‚å‘é€åˆ°æ•°æ®åº“å±‚ï¼Œå¯¼è‡´æ•°æ®åº“å±‚çš„åŽ‹åŠ›æ¿€å¢ž==ã€‚
	>
	> - ==ç¬¬ä¸€ä¸ªåŽŸå› ==ï¼š==ç¼“å­˜ä¸­æœ‰å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸ==ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚æ— æ³•å¾—åˆ°å¤„ç†ã€‚
	>
	> 	<img src="Redis.assets/74bb1aa4b2213e3ff29e2ee701e8f72e.jpg" alt="img" style="zoom: 25%;" />
	>
	> 	- ==è§£å†³æ–¹æ³•==ï¼š==æœåŠ¡é™çº§==ï¼š
	>
	> 		<img src="Redis.assets/4ab3be5ba24cf172879e6b2cff649ca8.jpg" alt="img" style="zoom: 40%;" />
	>
	> - ==ç¬¬äºŒä¸ªåŽŸå› ==ï¼š==Redis ç¼“å­˜å®žä¾‹å‘ç”Ÿæ•…éšœå®•æœºäº†ï¼Œæ— æ³•å¤„ç†è¯·æ±‚==ã€‚
	>
	> 	- ==è§£å†³æ–¹æ³•==ï¼š==æœåŠ¡ç†”æ–­==ï¼š
	>
	> 		<img src="Redis.assets/17d39f6233c3332161c588b42eccaeb5.jpg" alt="img" style="zoom: 40%;" />
	>
	> 		==æœåŠ¡ç†”æ–­è™½ç„¶å¯ä»¥ä¿è¯æ•°æ®åº“çš„æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯æš‚åœäº†æ•´ä¸ªç¼“å­˜ç³»ç»Ÿçš„è®¿é—®==ï¼Œå¯¹ä¸šåŠ¡åº”ç”¨çš„å½±å“èŒƒå›´å¤§ã€‚ä¸ºäº†å°½å¯èƒ½å‡å°‘è¿™ç§å½±å“ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œ==è¯·æ±‚é™æµ==ã€‚
	>
	> 	- ==è§£å†³æ–¹æ³•==ï¼š==è¯·æ±‚é™æµ==ï¼š
	>
	> 		==å³ç¼“å­˜é›ªå´©æ—¶é™æµå°†æ¯ç§’å…è®¸è®¿é—®çš„è¯·æ±‚æ•°ä»Ž10000é™è‡³1000==ï¼Œé¿å…æ•°æ®åº“åŽ‹åŠ›è¿‡å¤§ã€‚
	>
	> 		![img](Redis.assets/d5a0928e1d97cae2f4a4fb5b93e5c854.jpg)
	>
	> - ç¼“å­˜é›ªå´©çš„æ ¹æœ¬å¤„ç†æ–¹æ³•ï¼š==ä¸»ä»ŽèŠ‚ç‚¹æž„å»ºé«˜å¯é ç¼“å­˜é›†ç¾¤==ï¼š
	>
	> 	é€šè¿‡==ä¸»ä»ŽèŠ‚ç‚¹==çš„æ–¹å¼æž„å»º ==Redis ç¼“å­˜é«˜å¯é é›†ç¾¤==ã€‚å¦‚æžœ Redis ç¼“å­˜çš„ä¸»èŠ‚ç‚¹æ•…éšœå®•æœºäº†ï¼Œ==ä»ŽèŠ‚ç‚¹è¿˜å¯ä»¥åˆ‡æ¢æˆä¸ºä¸»èŠ‚ç‚¹==ï¼Œ==ç»§ç»­æä¾›ç¼“å­˜æœåŠ¡==ï¼Œé¿å…äº†ç”±äºŽç¼“å­˜å®žä¾‹å®•æœºè€Œå¯¼è‡´çš„ç¼“å­˜é›ªå´©é—®é¢˜ã€‚

2. ==ç¼“å­˜å‡»ç©¿==

	> - ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡ï¼Œé’ˆå¯¹==æŸä¸ªè®¿é—®éžå¸¸é¢‘ç¹çš„çƒ­ç‚¹æ•°æ®çš„è¯·æ±‚==ï¼Œ==æ— æ³•åœ¨ç¼“å­˜ä¸­è¿›è¡Œå¤„ç†==ï¼Œç´§æŽ¥ç€ï¼Œè®¿é—®è¯¥æ•°æ®çš„å¤§é‡è¯·æ±‚ï¼Œ==ä¸€ä¸‹å­éƒ½å‘é€åˆ°äº†åŽç«¯æ•°æ®åº“==ã€‚
	>
	> 	<img src="Redis.assets/d4c77da4yy7d6e34aca460642923ab4b.jpg" alt="img" style="zoom: 33%;" />
	>
	> - ç¼“å­˜å‡»ç©¿çš„æƒ…å†µï¼Œç»å¸¸å‘ç”Ÿåœ¨==çƒ­ç‚¹æ•°æ®è¿‡æœŸå¤±æ•ˆ==æ—¶ã€‚
	>
	> - æˆ‘ä»¬çš„è§£å†³æ–¹æ³•ä¹Ÿæ¯”è¾ƒç›´æŽ¥ï¼Œ==å¯¹äºŽè®¿é—®ç‰¹åˆ«é¢‘ç¹çš„çƒ­ç‚¹æ•°æ®ï¼Œæˆ‘ä»¬å°±ä¸è®¾ç½®è¿‡æœŸæ—¶é—´äº†==ã€‚

3. ==ç¼“å­˜ç©¿é€==

	> - ==ç¼“å­˜ç©¿é€æ˜¯æŒ‡è¦è®¿é—®çš„æ•°æ®æ—¢ä¸åœ¨ Redis ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­==ï¼Œå¯¼è‡´è¯·æ±‚åœ¨è®¿é—®ç¼“å­˜æ—¶ï¼Œå‘ç”Ÿç¼“å­˜ç¼ºå¤±ï¼Œå†åŽ»è®¿é—®æ•°æ®åº“æ—¶ï¼Œå‘çŽ°æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰è¦è®¿é—®çš„æ•°æ®ã€‚
	>
	> 	<img src="Redis.assets/46c49dd155665579c5204a66da8ffc2e.jpg" alt="img" style="zoom: 33%;" />
	>
	> - ==å‘ç”Ÿæƒ…å†µ==ï¼š
	>
	> 	- ä¸šåŠ¡å±‚è¯¯æ“ä½œï¼šç¼“å­˜ä¸­çš„æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®è¢«==è¯¯åˆ é™¤==äº†ï¼Œæ‰€ä»¥ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰æ•°æ®ï¼›
	> 	- ==æ¶æ„æ”»å‡»==ï¼šä¸“é—¨è®¿é—®æ•°æ®åº“ä¸­æ²¡æœ‰çš„æ•°æ®ã€‚
	>
	> - ==ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯ï¼Œç¼“å­˜ç©ºå€¼æˆ–ç¼ºçœå€¼==ã€‚å³æŠŠæ•°æ®åº“ç»™è¯·æ±‚è¿”å›žçš„ç©ºå€¼ç¼“å­˜åˆ°Redisï¼Œè¿™æ ·åœ¨Redisä¸Šå°±ç›´æŽ¥è¿”å›žç©ºå€¼äº†ï¼Œæ— éœ€è®¿é—®æ•°æ®åº“ã€‚
	>
	> - ==ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œé¿å…ä»Žæ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå‡è½»æ•°æ®åº“åŽ‹åŠ›==ã€‚
	>
	> 	![img](Redis.assets/98f7d32499e4386b40aebc3622aa7268.jpg)
	>
	> 	å½“éœ€è¦æŸ¥è¯¢æŸä¸ªæ•°æ®æ—¶ï¼Œ==å…ˆå¾—åˆ°è¿™ä¸ªæ•°æ®åœ¨ bit æ•°ç»„ä¸­å¯¹åº”çš„ N ä¸ªä½ç½®==ã€‚==åªè¦è¿™ N ä¸ª bit å€¼æœ‰ä¸€ä¸ªä¸ä¸º 1ï¼Œè¿™å°±è¡¨æ˜ŽæŸ¥è¯¢çš„æ•°æ®ä¸€å®šæ²¡æœ‰åœ¨æ•°æ®åº“ä¸­ä¿å­˜==ã€‚

4. ==å°ç»“==ï¼š

	> - ==ç¼“å­˜é›ªå´©æˆ–å‡»ç©¿==æ—¶ï¼Œä¸€æ—¦æ•°æ®åº“ä¸­çš„æ•°æ®è¢«==å†æ¬¡å†™å…¥åˆ°ç¼“å­˜==åŽï¼Œåº”ç”¨åˆå¯ä»¥åœ¨ç¼“å­˜ä¸­å¿«é€Ÿè®¿é—®æ•°æ®äº†ï¼›è€Œ==ç¼“å­˜ç©¿é€==å‘ç”Ÿæ—¶ï¼ŒRedis ç¼“å­˜å’Œæ•°æ®åº“ä¼šåŒæ—¶==æŒç»­==æ‰¿å—è¯·æ±‚åŽ‹åŠ›ã€‚
	> - ![img](Redis.assets/b5bd931239be18bef24b2ef36c70e9e1.jpg)

---



### 28.ç¼“å­˜è¢«æ±¡æŸ“äº†ï¼Œè¯¥æ€Žä¹ˆåŠžï¼Ÿâ­ï¸â­ï¸

1. åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œæœ‰äº›æ•°æ®è¢«==è®¿é—®çš„æ¬¡æ•°éžå¸¸å°‘ï¼Œç”šè‡³åªä¼šè¢«è®¿é—®ä¸€æ¬¡==ï¼Œå¦‚æžœè¿˜==ç»§ç»­ç•™å­˜åœ¨ç¼“å­˜ä¸­çš„è¯ï¼Œå°±åªä¼šç™½ç™½å ç”¨ç¼“å­˜ç©ºé—´==ã€‚è¿™ç§æƒ…å†µï¼Œå°±æ˜¯ç¼“å­˜æ±¡æŸ“ã€‚

2. å¦‚æžœè¿™æ—¶==æ•°æ®å æ»¡äº†ç¼“å­˜ç©ºé—´==ï¼Œæˆ‘ä»¬å†==å¾€ç¼“å­˜ä¸­å†™å…¥æ–°æ•°æ®==æ—¶ï¼Œå°±éœ€è¦==å…ˆæŠŠè¿™äº›æ•°æ®é€æ­¥æ·˜æ±°å‡ºç¼“å­˜ï¼Œè¿™å°±ä¼šå¼•å…¥é¢å¤–çš„æ“ä½œæ—¶é—´å¼€é”€==ï¼Œè¿›è€Œä¼šå½±å“åº”ç”¨çš„æ€§èƒ½ã€‚

3. ==LRU ç¼“å­˜ç­–ç•¥==

	> - åœ¨æ¯ä¸ªæ•°æ®å¯¹åº”çš„ ==RedisObject ç»“æž„ä½“ä¸­è®¾ç½®ä¸€ä¸ª lru å­—æ®µ==ï¼Œç”¨æ¥è®°å½•æ•°æ®çš„è®¿é—®æ—¶é—´æˆ³ã€‚åœ¨è¿›è¡Œæ•°æ®æ·˜æ±°æ—¶ï¼ŒLRU ç­–ç•¥ä¼šåœ¨å€™é€‰æ•°æ®é›†ä¸­æ·˜æ±°æŽ‰ lru å­—æ®µå€¼æœ€å°çš„æ•°æ®ã€‚
	> - ==åªçœ‹æ•°æ®çš„è®¿é—®æ—¶é—´ï¼Œä½¿ç”¨ LRU ç­–ç•¥åœ¨å¤„ç†æ‰«æå¼å•æ¬¡æŸ¥è¯¢æ“ä½œæ—¶ï¼Œæ— æ³•è§£å†³ç¼“å­˜æ±¡æŸ“==ã€‚
	> - ![img](Redis.assets/76909482d30097da81273f7bda18b275.jpg)

4. ==LFU ç¼“å­˜ç­–ç•¥çš„ä¼˜åŒ–==

	> - å½“ä½¿ç”¨ LFU ç­–ç•¥ç­›é€‰æ·˜æ±°æ•°æ®æ—¶ï¼Œ==é¦–å…ˆä¼šæ ¹æ®æ•°æ®çš„è®¿é—®æ¬¡æ•°è¿›è¡Œç­›é€‰==ã€‚
	>
	> - ==Redis åœ¨å®žçŽ° LFU ç­–ç•¥çš„æ—¶å€™ï¼Œåªæ˜¯æŠŠåŽŸæ¥ 24bit å¤§å°çš„ lru å­—æ®µï¼Œåˆè¿›ä¸€æ­¥æ‹†åˆ†æˆäº†ä¸¤éƒ¨åˆ†==ã€‚
	>
	> 	- ldt å€¼ï¼šlru å­—æ®µçš„å‰ 16bitï¼Œè¡¨ç¤ºæ•°æ®çš„è®¿é—®æ—¶é—´æˆ³ï¼›counter å€¼ï¼š
	> 	- lru å­—æ®µçš„åŽ 8bitï¼Œè¡¨ç¤ºæ•°æ®çš„è®¿é—®æ¬¡æ•°ã€‚
	>
	> - ==åœ¨å®žçŽ° LFU ç­–ç•¥æ—¶ï¼ŒRedis å¹¶æ²¡æœ‰é‡‡ç”¨æ•°æ®æ¯è¢«è®¿é—®ä¸€æ¬¡ï¼Œå°±ç»™å¯¹åº”çš„ counter å€¼åŠ  1 çš„è®¡æ•°è§„åˆ™ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ä¸€ä¸ªæ›´ä¼˜åŒ–çš„è®¡æ•°è§„åˆ™ï¼ˆä¸ç„¶æœ€å¤šçºªå½•255æ¬¡è®¿é—®äº†ï¼‰==ã€‚
	>
	> 	```c
	> 	double r = (double)rand()/RAND_MAX;
	> 	...
	> 	double p = 1.0/(baseval*server.lfu_log_factor+1);
	> 	if (r < p) counter++; 
	> 	```
	>
	> 	![img](Redis.assets/8eafa57112b01ba0yyf93034ca109f3e.jpg)
	>
	> - Redis åœ¨å®žçŽ° LFU ç­–ç•¥æ—¶ï¼Œè¿˜è®¾è®¡äº†ä¸€ä¸ª ==counter å€¼éšæ—¶é—´è¡°å‡çš„æœºåˆ¶==ï¼šLFU ç­–ç•¥ä¼šè®¡ç®—å½“å‰æ—¶é—´å’Œæ•°æ®æœ€è¿‘ä¸€æ¬¡è®¿é—®æ—¶é—´çš„å·®å€¼ï¼Œå¹¶æŠŠè¿™ä¸ªå·®å€¼æ¢ç®—æˆ==ä»¥åˆ†é’Ÿä¸ºå•ä½==ã€‚ç„¶åŽï¼ŒLFU ç­–ç•¥å†==æŠŠè¿™ä¸ªå·®å€¼é™¤ä»¥ lfu_decay_time å€¼==ï¼Œæ‰€å¾—çš„ç»“æžœ==å°±æ˜¯æ•°æ® counter è¦è¡°å‡çš„å€¼==ã€‚

---



### 29.Pikaï¼šå¦‚ä½•åŸºäºŽSSDå®žçŽ°å¤§å®¹é‡Redisï¼Ÿâ­ï¸â­ï¸â­ï¸â­ï¸

1. é—®é¢˜ï¼š==å¦‚ä½•ä½¿ç”¨Rediså­˜å‚¨å¤§é‡æ•°æ®==ï¼Ÿä½¿ç”¨==å›ºæ€ç¡¬ç›˜ï¼ˆSolid State Driveï¼ŒSSD==ï¼‰ã€‚å®ƒçš„æˆæœ¬å¾ˆä½Žï¼Œè€Œä¸”å®¹é‡å¤§ï¼Œè¯»å†™é€Ÿåº¦å¿«ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºŽ SSD æ¥å®žçŽ°å¤§å®¹é‡çš„ Redis å®žä¾‹ã€‚360 å…¬å¸ DBA å’ŒåŸºç¡€æž¶æž„ç»„è”åˆå¼€å‘çš„ ==Pikaé”®å€¼æ•°æ®åº“==ï¼Œæ­£å¥½å®žçŽ°äº†è¿™ä¸€éœ€æ±‚ã€‚

2. ==å¤§å†…å­˜ Redis å®žä¾‹çš„æ½œåœ¨é—®é¢˜==

	> - ==å†…å­˜å¿«ç…§ RDB ç”Ÿæˆå’Œæ¢å¤æ•ˆçŽ‡ä½Ž==ã€‚RDB æ–‡ä»¶å¢žå¤§ï¼ŒRDB æ–‡ä»¶ç”Ÿæˆæ—¶çš„ ==fork å­è¿›ç¨‹æ—¶é•¿å¢žåŠ ==ã€‚
	> - ==ä¸»ä»ŽèŠ‚ç‚¹å…¨é‡åŒæ­¥æ—¶é•¿å¢žåŠ ï¼ˆRDBæ–‡ä»¶å¢žå¤§ï¼‰ã€ç¼“å†²åŒºï¼ˆçŽ¯å½¢ç¼“å†²åŒºï¼‰æ˜“æº¢å‡º==ã€‚

3. ==Pika çš„æ•´ä½“æž¶æž„==

	> - <img src="Redis.assets/a1421b8dbca6bb1ee9b6c1be7a929ae7.jpg" alt="img" style="zoom:25%;" />
	>
	> - ==Pika çš„ç½‘ç»œæ¡†æž¶==æ˜¯å¯¹æ“ä½œç³»ç»Ÿåº•å±‚çš„ç½‘ç»œå‡½æ•°è¿›è¡Œäº†å°è£…ï¼Œè´Ÿè´£åº•å±‚ç½‘ç»œè¯·æ±‚çš„æŽ¥æ”¶å’Œå‘é€ã€‚
	>
	> - ==Pika çº¿ç¨‹æ¨¡å—==é‡‡ç”¨äº†å¤šçº¿ç¨‹æ¨¡åž‹æ¥å…·ä½“å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ¦‚å¿µå›¾å¦‚ä¸‹ï¼š
	>
	> 	![img](Redis.assets/4627f13848167cdaa3b30370d9b80a06.jpg)
	>
	> - ==Nemo æ¨¡å—==å¾ˆå®¹æ˜“ç†è§£ï¼Œå®ƒå®žçŽ°äº† ==Pika å’Œ Redis çš„æ•°æ®ç±»åž‹å…¼å®¹==ã€‚
	>
	> - Pika ä½¿ç”¨ ==binlog æœºåˆ¶è®°å½•å†™å‘½ä»¤==ï¼Œç”¨äºŽ==ä¸»ä»ŽèŠ‚ç‚¹çš„å‘½ä»¤åŒæ­¥==ã€‚
	>
	> - ==RocksDB æä¾›çš„åŸºäºŽ SSD ä¿å­˜æ•°æ®çš„åŠŸèƒ½==ã€‚

4. ==Pika å¦‚ä½•åŸºäºŽ SSD ä¿å­˜æ›´å¤šæ•°æ®==ï¼Ÿ

	> - RocksDB ==å†™å…¥æ•°æ®==çš„åŸºæœ¬æµç¨‹ï¼š
	>
	> 	![image-20240427203751019](Redis.assets/image-20240427203751019.png)
	>
	> 	==RocksDB ä¼šå…ˆç”¨ Memtable ç¼“å­˜æ•°æ®ï¼Œç¼“å­˜å†™æ»¡åŽå†å°†æ•°æ®å¿«é€Ÿå†™å…¥ SSD==ã€‚
	>
	> - RocksDB ==è¯»å–æ•°æ®==çš„åŸºæœ¬æµç¨‹ï¼š
	>
	> 	![img](Redis.assets/aa70655efbb767af499a83bd6521ee3b.jpg)
	>
	> - Pika åŸºäºŽ RocksDB ä¿å­˜äº†æ•°æ®æ–‡ä»¶ï¼Œ==ç›´æŽ¥è¯»å–æ•°æ®æ–‡ä»¶å°±èƒ½æ¢å¤==ï¼Œ==ä¸éœ€è¦å†é€šè¿‡å†…å­˜å¿«ç…§è¿›è¡Œæ¢å¤==äº†ã€‚è€Œä¸”ï¼Œ==Pika ä»Žåº“åœ¨è¿›è¡Œå…¨é‡åŒæ­¥æ—¶ï¼Œå¯ä»¥ç›´æŽ¥ä»Žä¸»åº“æ‹·è´æ•°æ®æ–‡ä»¶==ï¼Œ==ä¸éœ€è¦ä½¿ç”¨å†…å­˜å¿«ç…§==ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒPika å°±é¿å…äº†å¤§å†…å­˜å¿«ç…§ç”Ÿæˆæ•ˆçŽ‡ä½Žçš„é—®é¢˜ã€‚
	>
	> - Pika ä½¿ç”¨äº† ==binlog æœºåˆ¶å®žçŽ°å¢žé‡å‘½ä»¤åŒæ­¥==ï¼Œæ—¢èŠ‚çœäº†å†…å­˜ï¼Œè¿˜==é¿å…äº†ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜==ã€‚å½“==å…¨é‡åŒæ­¥ç»“æŸåŽ==ï¼Œä»Žåº“ä¼š==ä»Ž binlog ä¸­æŠŠå°šæœªåŒæ­¥çš„å‘½ä»¤è¯»å–è¿‡æ¥==ï¼Œè¿™æ ·å°±å’Œä¸»åº“çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚
	>
	> - ==binlog æ˜¯ä¿å­˜åœ¨ SSD ä¸Šçš„æ–‡ä»¶==ï¼Œæ–‡ä»¶å¤§å°ä¸åƒç¼“å†²åŒºï¼Œä¼šå—åˆ°å†…å­˜å®¹é‡çš„è¾ƒå¤šé™åˆ¶ã€‚

5. ==Pika å¦‚ä½•å®žçŽ° Redis æ•°æ®ç±»åž‹å…¼å®¹==ï¼Ÿ

	> - ==RocksDB åªæä¾›äº†å•å€¼çš„é”®å€¼å¯¹ç±»åž‹==ï¼ŒRocksDB é”®å€¼å¯¹ä¸­çš„å€¼å°±æ˜¯å•ä¸ªå€¼ï¼Œ==è€Œ Redis é”®å€¼å¯¹ä¸­çš„å€¼è¿˜å¯ä»¥æ˜¯é›†åˆç±»åž‹==ã€‚
	> - ä»¥ä¸‹ä¸º ==Nemo æ¨¡å—è§£å†³ Redis ä¸­é›†åˆç±»åž‹çš„æ–¹æ³•==ï¼š
	> - ![img](Redis.assets/066465f1a28b6f14a42c1fc3a3f73105.jpg)
	> - ![img](Redis.assets/aa20c1456526dbf3f7d30f9d865f0f71.jpg)
	> - ![img](Redis.assets/6378f7045393ae342632189a4ab601b9.jpg)
	> - ![img](Redis.assets/a0bc4d00a5d95e7fd2699945ff7a56a8.jpg)

6. ==Pika çš„å…¶ä»–ä¼˜åŠ¿ä¸Žä¸è¶³==

	> - Pika æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯==ä½¿ç”¨äº† SSD æ¥ä¿å­˜æ•°æ®==ï¼Œè¿™ä¸ªç‰¹ç‚¹èƒ½å¸¦æ¥çš„æœ€ç›´æŽ¥å¥½å¤„å°±æ˜¯ï¼Œ==Pika å•å®žä¾‹èƒ½ä¿å­˜æ›´å¤šçš„æ•°æ®==äº†ã€‚
	> - ==å®žä¾‹é‡å¯å¿«==ã€‚Pika çš„æ•°æ®åœ¨å†™å…¥æ•°æ®åº“æ—¶ï¼Œæ˜¯ä¼šä¿å­˜åˆ° SSD ä¸Šçš„ã€‚å½“ ==Pika å®žä¾‹é‡å¯æ—¶ï¼Œå¯ä»¥ç›´æŽ¥ä»Ž SSD ä¸Šçš„æ•°æ®æ–‡ä»¶ä¸­è¯»å–æ•°æ®==ï¼Œä¸éœ€è¦åƒ Redis ä¸€æ ·ï¼Œä»Ž RDB æ–‡ä»¶å…¨éƒ¨é‡æ–°åŠ è½½æ•°æ®æˆ–æ˜¯ä»Ž AOF æ–‡ä»¶ä¸­å…¨éƒ¨å›žæ”¾æ“ä½œã€‚
	> - ==ä¸»ä»Žåº“é‡æ–°æ‰§è¡Œå…¨é‡åŒæ­¥çš„é£Žé™©ä½Ž==ã€‚Pika é€šè¿‡ ==binlog æœºåˆ¶å®žçŽ°å†™å‘½ä»¤çš„å¢žé‡åŒæ­¥ï¼Œä¸å†å—å†…å­˜ç¼“å†²åŒºå¤§å°çš„é™åˆ¶==ï¼Œæ‰€ä»¥ï¼Œå³ä½¿åœ¨æ•°æ®é‡å¾ˆå¤§å¯¼è‡´ä¸»ä»Žåº“åŒæ­¥è€—æ—¶å¾ˆé•¿çš„æƒ…å†µä¸‹ï¼ŒPika ä¹Ÿä¸ç”¨æ‹…å¿ƒç¼“å†²åŒºæº¢å‡ºè€Œè§¦å‘çš„ä¸»ä»Žåº“é‡æ–°å…¨é‡åŒæ­¥ã€‚
	> - å½“æŠŠ==æ•°æ®ä¿å­˜åˆ° SSD ä¸ŠåŽï¼Œä¼šé™ä½Žæ•°æ®çš„è®¿é—®æ€§èƒ½==ã€‚è¿™æ˜¯å› ä¸ºï¼Œ==æ•°æ®æ“ä½œæ¯•ç«Ÿä¸èƒ½åœ¨å†…å­˜ä¸­ç›´æŽ¥æ‰§è¡Œäº†==ï¼Œè€Œæ˜¯è¦åœ¨åº•å±‚çš„ SSD ä¸­è¿›è¡Œå­˜å–ï¼Œè¿™è‚¯å®šä¼šå½±å“ï¼ŒPika çš„æ€§èƒ½ã€‚

---



### 30.æ— é”çš„åŽŸå­æ“ä½œï¼šRediså¦‚ä½•åº”å¯¹å¹¶å‘è®¿é—®ï¼Ÿâ­ï¸â­ï¸â­ï¸â­ï¸

1. ä¸ºäº†ä¿è¯==å¹¶å‘è®¿é—®çš„æ­£ç¡®æ€§==ï¼ŒRedis æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯==åŠ é”==å’Œ==åŽŸå­æ“ä½œ==ã€‚

2. ==åŠ é”æœ‰ä¸¤ä¸ªé—®é¢˜==ï¼šä¸€ä¸ªæ˜¯ï¼Œå¦‚æžœåŠ é”æ“ä½œå¤šï¼Œä¼š==é™ä½Žç³»ç»Ÿçš„å¹¶å‘è®¿é—®æ€§èƒ½==ï¼›ç¬¬äºŒä¸ªæ˜¯ï¼ŒRedis å®¢æˆ·ç«¯è¦åŠ é”æ—¶ï¼Œéœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Œè€Œ==åˆ†å¸ƒå¼é”å®žçŽ°å¤æ‚==ï¼Œ==éœ€è¦ç”¨é¢å¤–çš„å­˜å‚¨ç³»ç»Ÿ==æ¥æä¾›åŠ è§£é”æ“ä½œã€‚

3. ==åŽŸå­æ“ä½œ==æ˜¯æŒ‡==æ‰§è¡Œè¿‡ç¨‹ä¿æŒåŽŸå­æ€§==çš„æ“ä½œï¼Œè€Œä¸”åŽŸå­æ“ä½œæ‰§è¡Œæ—¶å¹¶ä¸éœ€è¦å†åŠ é”ï¼Œå®žçŽ°äº†==æ— é”æ“ä½œ==ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ—¢èƒ½ä¿è¯å¹¶å‘æŽ§åˆ¶ï¼Œè¿˜èƒ½==å‡å°‘å¯¹ç³»ç»Ÿå¹¶å‘æ€§èƒ½çš„å½±å“==ã€‚

4. ==å¹¶å‘è®¿é—®ä¸­éœ€è¦å¯¹ä»€ä¹ˆè¿›è¡ŒæŽ§åˆ¶==ï¼Ÿ

	> - ä¸€ä¸ª==å®¢æˆ·ç«¯å¯¹æ•°æ®çš„ä¿®æ”¹==åŒ…æ‹¬ï¼šâ€œ==è¯»å– â€“ ä¿®æ”¹ â€“ å†™å›ž==â€æ“ä½œï¼ˆRead-Modify-Writeï¼Œç®€ç§°ä¸º RMWï¼‰
	> - ![img](Redis.assets/dce821cd00c1937b4aab1f130424335c.jpg)
	> - å¯ä»¥ç”¨==é”æŠŠå¹¶è¡Œæ“ä½œå˜æˆä¸²è¡Œæ“ä½œ==ï¼Œ==ä¸²è¡Œ==æ“ä½œå°±å…·æœ‰==äº’æ–¥==æ€§ã€‚==åŠ é”ä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿå¹¶å‘æ€§èƒ½é™ä½Ž==ã€‚

5. ==Redis çš„ä¸¤ç§åŽŸå­æ“ä½œæ–¹æ³•==

	> - Redis çš„==åŽŸå­æ“ä½œ==é‡‡ç”¨äº†==ä¸¤ç§æ–¹æ³•==ï¼š
	>
	> 	1. æŠŠ==å¤šä¸ªæ“ä½œåœ¨ Redis ä¸­å®žçŽ°æˆä¸€ä¸ªæ“ä½œ==ï¼Œä¹Ÿå°±æ˜¯==å•å‘½ä»¤æ“ä½œ==ï¼›
	> 	2. æŠŠ==å¤šä¸ªæ“ä½œå†™åˆ°ä¸€ä¸ª Lua è„šæœ¬==ä¸­ï¼Œä»¥åŽŸå­æ€§æ–¹å¼==æ‰§è¡Œå•ä¸ª Lua è„šæœ¬==ã€‚
	>
	> - ==å•å‘½ä»¤æ“ä½œ==
	>
	> 	- Redis æä¾›äº† ==INCR/DECR å‘½ä»¤==ï¼Œ==æŠŠè¿™ä¸‰ä¸ªæ“ä½œè½¬å˜ä¸ºä¸€ä¸ªåŽŸå­æ“ä½œ==äº†ã€‚==INCR/DECR å‘½ä»¤å¯ä»¥å¯¹æ•°æ®è¿›è¡Œå¢žå€¼ / å‡å€¼æ“ä½œ==ï¼Œè€Œä¸”å®ƒä»¬æœ¬èº«å°±æ˜¯å•ä¸ªå‘½ä»¤æ“ä½œï¼Œ==Redis é‡‡ç”¨å•çº¿ç¨‹ä¸²è¡Œåœ¨æ‰§è¡Œå®ƒä»¬æ—¶ï¼Œæœ¬èº«å°±å…·æœ‰äº’æ–¥æ€§==ã€‚
	>
	> - ==Lua è„šæœ¬==
	>
	> 	- æˆ‘ä»¬è¦æ‰§è¡Œçš„æ“ä½œä¸æ˜¯ç®€å•åœ°å¢žå‡æ•°æ®ï¼Œè€Œæ˜¯æœ‰==æ›´åŠ å¤æ‚çš„åˆ¤æ–­é€»è¾‘æˆ–è€…æ˜¯å…¶ä»–æ“ä½œ==ã€‚
	>
	> 	- ==Redis ä¼šæŠŠæ•´ä¸ª Lua è„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œ==ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ‰“æ–­ï¼Œä»Žè€Œä¿è¯äº† Lua è„šæœ¬ä¸­æ“ä½œçš„åŽŸå­æ€§ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Redis çš„ ==EVAL å‘½ä»¤æ¥æ‰§è¡Œè„šæœ¬==ã€‚
	>
	> 		```bash
	> 		redis-cli --eval lua.script [args...] 
	> 		```

6. ==å°ç»“==ï¼š

	> - Redis æä¾›äº†==ä¸¤ç§åŽŸå­æ“ä½œçš„æ–¹æ³•==æ¥å®žçŽ°å¹¶å‘æŽ§åˆ¶ï¼Œåˆ†åˆ«æ˜¯==å•å‘½ä»¤æ“ä½œ==å’Œ ==Lua è„šæœ¬==ã€‚å› ä¸ºåŽŸå­æ“ä½œæœ¬èº«==ä¸ä¼šå¯¹å¤ªå¤šçš„èµ„æºé™åˆ¶è®¿é—®==ï¼Œå¯ä»¥ç»´æŒ==è¾ƒé«˜çš„ç³»ç»Ÿå¹¶å‘æ€§èƒ½==ã€‚
	> - å¦‚æžœ==æŠŠå¾ˆå¤šæ“ä½œéƒ½æ”¾åœ¨ Lua è„šæœ¬ä¸­åŽŸå­æ‰§è¡Œï¼Œä¼šå¯¼è‡´ Redis æ‰§è¡Œè„šæœ¬çš„æ—¶é—´å¢žåŠ ï¼ŒåŒæ ·ä¹Ÿä¼šé™ä½Ž Redis çš„å¹¶å‘æ€§èƒ½==ã€‚æ‰€ä»¥ï¼Œæˆ‘ç»™ä½ ä¸€ä¸ªå°å»ºè®®ï¼š==åœ¨ç¼–å†™ Lua è„šæœ¬æ—¶ï¼Œä½ è¦é¿å…æŠŠä¸éœ€è¦åšå¹¶å‘æŽ§åˆ¶çš„æ“ä½œå†™å…¥è„šæœ¬ä¸­ã€‚==

---



### 31.å¦‚ä½•ä½¿ç”¨Rediså®žçŽ°åˆ†å¸ƒå¼é”ï¼Ÿâ­ï¸â­ï¸â­ï¸â­ï¸â­ï¸

1. ==åˆ†å¸ƒå¼é”ä¿å­˜åœ¨ä¸€ä¸ªå…±äº«å­˜å‚¨ç³»ç»Ÿä¸­çš„==ï¼Œ==å¯ä»¥è¢«å¤šä¸ªå®¢æˆ·ç«¯å…±äº«è®¿é—®å’ŒèŽ·å–==ã€‚è€Œ==Redis æœ¬èº«å¯ä»¥è¢«å¤šä¸ªå®¢æˆ·ç«¯å…±äº«è®¿é—®ï¼Œæ­£å¥½å°±æ˜¯ä¸€ä¸ªå…±äº«å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜åˆ†å¸ƒå¼é”==ã€‚

2. ==å•æœºä¸Šçš„é”å’Œåˆ†å¸ƒå¼é”çš„è”ç³»ä¸ŽåŒºåˆ«==

	> - å’Œå•æœºä¸Šçš„é”ç±»ä¼¼ï¼Œåˆ†å¸ƒå¼é”åŒæ ·å¯ä»¥==ç”¨ä¸€ä¸ªå˜é‡æ¥å®žçŽ°ã€‚==å®¢æˆ·ç«¯åŠ é”å’Œé‡Šæ”¾é”çš„æ“ä½œé€»è¾‘ï¼Œä¹Ÿå’Œå•æœºä¸Šçš„åŠ é”å’Œé‡Šæ”¾é”æ“ä½œé€»è¾‘ä¸€è‡´ï¼š==åŠ é”æ—¶åŒæ ·éœ€è¦åˆ¤æ–­é”å˜é‡çš„å€¼ï¼Œæ ¹æ®é”å˜é‡å€¼æ¥åˆ¤æ–­èƒ½å¦åŠ é”æˆåŠŸï¼›é‡Šæ”¾é”æ—¶éœ€è¦æŠŠé”å˜é‡å€¼è®¾ç½®ä¸º 0ï¼Œè¡¨æ˜Žå®¢æˆ·ç«¯ä¸å†æŒæœ‰é”==ã€‚
	> - å’Œçº¿ç¨‹åœ¨å•æœºä¸Šæ“ä½œé”ä¸åŒçš„æ˜¯ï¼Œåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œ==é”å˜é‡éœ€è¦ç”±ä¸€ä¸ªå…±äº«å­˜å‚¨ç³»ç»Ÿæ¥ç»´æŠ¤==ï¼Œåªæœ‰è¿™æ ·ï¼Œå¤šä¸ªå®¢æˆ·ç«¯æ‰å¯ä»¥é€šè¿‡è®¿é—®å…±äº«å­˜å‚¨ç³»ç»Ÿæ¥è®¿é—®é”å˜é‡ã€‚ç›¸åº”çš„ï¼Œ==åŠ é”å’Œé‡Šæ”¾é”çš„æ“ä½œå°±å˜æˆäº†è¯»å–ã€åˆ¤æ–­å’Œè®¾ç½®å…±äº«å­˜å‚¨ç³»ç»Ÿä¸­çš„é”å˜é‡å€¼==ã€‚

3. ==åŸºäºŽå•ä¸ª Redis èŠ‚ç‚¹å®žçŽ°åˆ†å¸ƒå¼é”ä½œä¸ºåˆ†å¸ƒå¼é”==

	> - ==åŠ é”==å›¾ç¤ºï¼š
	>
	> 	![img](Redis.assets/1d18742c1e5fc88835ec27f1becfc145.jpg)
	>
	> - ==é‡Šæ”¾é”==å›¾ç¤ºï¼š
	>
	> 	![img](Redis.assets/c7c413b47d42f06f08fce92404f31e82.jpg)
	>
	> - ==åŠ é”å’Œé‡Šæ”¾é”çš„æ“ä½œéœ€è¦ä¿è¯åŽŸå­æ€§==ã€‚
	>
	> - æˆ‘ä»¬å°±å¯ä»¥ç”¨ ==SETNX å’Œ DEL å‘½ä»¤ç»„åˆæ¥å®žçŽ°åŠ é”å’Œé‡Šæ”¾é”æ“ä½œ==ã€‚ä½†è¿™å­˜åœ¨==ä¸¤ä¸ªé£Žé™©==ã€‚
	>
	> 	- å‡å¦‚æŸä¸ªå®¢æˆ·ç«¯åœ¨æ‰§è¡Œäº† SETNX å‘½ä»¤ã€åŠ é”ä¹‹åŽï¼Œç´§æŽ¥ç€å´åœ¨æ“ä½œå…±äº«æ•°æ®æ—¶å‘ç”Ÿäº†å¼‚å¸¸ï¼Œ==ç»“æžœä¸€ç›´æ²¡æœ‰æ‰§è¡Œæœ€åŽçš„ DEL å‘½ä»¤é‡Šæ”¾é”==ã€‚è§£å†³æ–¹æ³•æ˜¯ï¼Œ==ç»™é”å˜é‡è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´==ã€‚
	> 	- å¦‚æžœå®¢æˆ·ç«¯ A æ‰§è¡Œäº† SETNX å‘½ä»¤åŠ é”åŽï¼Œå‡è®¾==å®¢æˆ·ç«¯ B æ‰§è¡Œäº† DEL å‘½ä»¤é‡Šæ”¾é”==ï¼Œæ­¤æ—¶ï¼Œ==å®¢æˆ·ç«¯ A çš„é”å°±è¢«è¯¯é‡Šæ”¾äº†==ã€‚æˆ‘ä»¬éœ€è¦==èƒ½åŒºåˆ†æ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„é”æ“ä½œ==ã€‚è®©==æ¯ä¸ªå®¢æˆ·ç«¯ç»™é”å˜é‡è®¾ç½®ä¸€ä¸ªå”¯ä¸€å€¼==ï¼Œè¿™é‡Œçš„å”¯ä¸€å€¼å°±å¯ä»¥ç”¨æ¥==æ ‡è¯†å½“å‰æ“ä½œçš„å®¢æˆ·ç«¯==ã€‚åœ¨==é‡Šæ”¾é”æ“ä½œ==æ—¶ï¼Œ==å®¢æˆ·ç«¯éœ€è¦åˆ¤æ–­ï¼Œå½“å‰é”å˜é‡çš„å€¼æ˜¯å¦å’Œè‡ªå·±çš„å”¯ä¸€æ ‡è¯†ç›¸ç­‰==ã€‚
	>
	> - ```bash
	> 	# åŠ é”, unique_valueä½œä¸ºå®¢æˆ·ç«¯å”¯ä¸€æ€§çš„æ ‡è¯†ï¼Œè¿‡æœŸæ—¶é—´10ç§’ã€‚
	> 	SET lock_key unique_value NX PX 10000 
	> 	```
	>
	> - ```lua
	> 	//é‡Šæ”¾é” æ¯”è¾ƒunique_valueæ˜¯å¦ç›¸ç­‰ï¼Œé¿å…è¯¯é‡Šæ”¾
	> 	if redis.call("get",KEYS[1]) == ARGV[1] then
	> 	    return redis.call("del",KEYS[1])
	> 	else
	> 	    return 0
	> 	end
	> 	```
	>
	> - ```bash
	> 	redis-cli  --eval  unlock.script lock_key , unique_value # é‡Šæ”¾é”ä½¿ç”¨LuaåŽŸå­æ€§
	> 	```

4. ==åŸºäºŽå¤šä¸ª Redis èŠ‚ç‚¹å®žçŽ°é«˜å¯é çš„åˆ†å¸ƒå¼é”==

	> - Redlock ç®—æ³•çš„åŸºæœ¬æ€è·¯ï¼Œæ˜¯==è®©å®¢æˆ·ç«¯å’Œå¤šä¸ªç‹¬ç«‹çš„ Redis å®žä¾‹ä¾æ¬¡è¯·æ±‚åŠ é”==ï¼Œå¦‚æžœ==å®¢æˆ·ç«¯èƒ½å¤Ÿå’ŒåŠæ•°ä»¥ä¸Šçš„å®žä¾‹æˆåŠŸåœ°å®ŒæˆåŠ é”æ“ä½œ==ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯æˆåŠŸåœ°èŽ·å¾—åˆ†å¸ƒå¼é”äº†ï¼Œå¦åˆ™åŠ é”å¤±è´¥ã€‚
	>
	> - ==Redlock ç®—æ³•åŠ é”çš„æ‰§è¡Œæ­¥éª¤==ï¼š
	>
	> 	1. ==ç¬¬ä¸€æ­¥æ˜¯ï¼Œå®¢æˆ·ç«¯èŽ·å–å½“å‰æ—¶é—´ã€‚==
	> 	2. ==ç¬¬äºŒæ­¥æ˜¯ï¼Œå®¢æˆ·ç«¯æŒ‰é¡ºåºä¾æ¬¡å‘ N ä¸ª Redis å®žä¾‹æ‰§è¡ŒåŠ é”æ“ä½œã€‚==å¦‚æžœå®¢æˆ·ç«¯åœ¨å’Œä¸€ä¸ª Redis å®žä¾‹è¯·æ±‚åŠ é”æ—¶==è¶…æ—¶==ï¼Œé‚£ä¹ˆå°±å’Œä¸‹ä¸€ä¸ª Redis å®žä¾‹ç»§ç»­è¯·æ±‚åŠ é”ã€‚==åŠ é”æ“ä½œçš„è¶…æ—¶æ—¶é—´éœ€è¦è¿œè¿œåœ°å°äºŽé”çš„æœ‰æ•ˆæ—¶é—´ï¼Œä¸€èˆ¬ä¹Ÿå°±æ˜¯è®¾ç½®ä¸ºå‡ åæ¯«ç§’==ã€‚
	> 	3. ==ç¬¬ä¸‰æ­¥æ˜¯ï¼Œå®¢æˆ·ç«¯å®Œæˆäº†å’Œæ‰€æœ‰ Redis å®žä¾‹çš„åŠ é”æ“ä½œåŽï¼Œè®¡ç®—æ•´ä¸ªåŠ é”è¿‡ç¨‹çš„æ€»è€—æ—¶ã€‚==
	>
	> 	å®¢æˆ·ç«¯åªæœ‰åœ¨æ»¡è¶³ä¸‹é¢çš„è¿™ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œæ‰èƒ½è®¤ä¸ºæ˜¯åŠ é”æˆåŠŸã€‚
	>
	> 	- æ¡ä»¶ä¸€ï¼šå®¢æˆ·ç«¯ä»Ž==è¶…è¿‡åŠæ•°ï¼ˆå¤§äºŽç­‰äºŽ N/2+1ï¼‰çš„ Redis å®žä¾‹ä¸ŠæˆåŠŸèŽ·å–åˆ°äº†é”==ï¼›
	> 	- æ¡ä»¶äºŒï¼š==å®¢æˆ·ç«¯èŽ·å–é”çš„æ€»è€—æ—¶æ²¡æœ‰è¶…è¿‡é”çš„æœ‰æ•ˆæ—¶é—´==ã€‚
	>
	> - ==é‡Šæ”¾é”å°±ç›´æŽ¥å¯¹æ‰€æœ‰å®žä¾‹æ‰§è¡Œé‡Šæ”¾é”çš„Luaè„šæœ¬å³å¯==ã€‚

5. ==å°ç»“==ï¼š

	> - åŸºäºŽ==å•ä¸ª Redis å®žä¾‹==å®žçŽ°åˆ†å¸ƒå¼é”æ—¶ï¼Œå¯¹äºŽ==åŠ é”æ“ä½œ==ï¼Œæˆ‘ä»¬éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ã€‚
	> 	- åŠ é”åŒ…æ‹¬äº†è¯»å–é”å˜é‡ã€æ£€æŸ¥é”å˜é‡å€¼å’Œè®¾ç½®é”å˜é‡å€¼ä¸‰ä¸ªæ“ä½œï¼Œä½†éœ€è¦ä»¥==åŽŸå­æ“ä½œ==çš„æ–¹å¼å®Œæˆï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬==ä½¿ç”¨ SET å‘½ä»¤å¸¦ä¸Š NX é€‰é¡¹æ¥å®žçŽ°åŠ é”==ï¼›
	> 	- é”å˜é‡éœ€è¦==è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä»¥å…å®¢æˆ·ç«¯æ‹¿åˆ°é”åŽå‘ç”Ÿå¼‚å¸¸ï¼Œå¯¼è‡´é”ä¸€ç›´æ— æ³•é‡Šæ”¾==ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ SET å‘½ä»¤æ‰§è¡Œæ—¶åŠ ä¸Š ==EX/PX é€‰é¡¹==ï¼Œè®¾ç½®å…¶è¿‡æœŸæ—¶é—´ï¼›
	> 	- é”å˜é‡çš„å€¼éœ€è¦èƒ½==åŒºåˆ†æ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„åŠ é”æ“ä½œ==ï¼Œ==ä»¥å…åœ¨é‡Šæ”¾é”æ—¶ï¼Œå‡ºçŽ°è¯¯é‡Šæ”¾æ“ä½œ==ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ SET å‘½ä»¤è®¾ç½®é”å˜é‡å€¼æ—¶ï¼Œ==æ¯ä¸ªå®¢æˆ·ç«¯SETçš„VALUEæ˜¯ä¸€ä¸ªå”¯ä¸€å€¼ï¼Œç”¨äºŽæ ‡è¯†å®¢æˆ·ç«¯==ã€‚
	> - é‡Šæ”¾é”ä¹ŸåŒ…å«äº†è¯»å–é”å˜é‡å€¼ã€åˆ¤æ–­é”å˜é‡å€¼å’Œåˆ é™¤é”å˜é‡ä¸‰ä¸ªæ“ä½œï¼Œä¸è¿‡ï¼Œ==æˆ‘ä»¬æ— æ³•ä½¿ç”¨å•ä¸ªå‘½ä»¤æ¥å®žçŽ°==ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥==é‡‡ç”¨ Lua è„šæœ¬æ‰§è¡Œé‡Šæ”¾é”æ“ä½œ==ï¼Œ==é€šè¿‡ Redis åŽŸå­æ€§åœ°æ‰§è¡Œ Lua è„šæœ¬ï¼Œæ¥ä¿è¯é‡Šæ”¾é”æ“ä½œçš„åŽŸå­æ€§==ã€‚

---



